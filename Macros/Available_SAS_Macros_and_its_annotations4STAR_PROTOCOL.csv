Macro,Macro_categories,Annotation,Parameters,Submacros
random_import_cell_mtex,COVID19_GWAS_Analyzer,Randomly select user designated number of cells on column-wide from a compressed single-cell gene expression matrix and import the subset data into a sas dataset and keep the selected column names as a sas dataset called 'header'.,"macro random_import_cell_mtex(
/*Funcational annotation: this macro is suitable for columns more than 1 million, which is relative faster than other similar macros;
For subsetting smaller % of columns, the macro seems to be not better than the macro random_import_cell_mtex4smalldsd!*/
gzfile=,/*the fullpath to compressed or plain file, such as gz, txt, zip, and others.*/
max_colnum= ,/*Default is empty for using the total number of numeric columns in the file;
provide a smaller number than the total number of numberic columns to only import first number of numeric columns;*/
totrandom_cols=100000,
random_seed=2718,
outdsd=subset_cell_exp,
rowname_len=100, /*The length of the 1st rowname length*/
V_max_len=8, /*The length for all numeric cell expression value*/
deletefile=0, /*Delete input gzfile*/
extra_cmd4infile= /*extra filters for infile*/
);",ImportFileHeadersFromZIP Sampling
Boxplots4GenesInGTExV8,COVID19_GWAS_Analyzer,Download GTEx V8 RNAseq data and make boxplots for target genes' FPKM by sex or not by sex.,"Boxplots4GenesInGTExV8( genes=MAP3K19 R3HDM1, dsdout=exp, bysex=1, UseGeneratedDsd=0, PreviousDsd=tgt, Lib4PreviousDsd=GTEx, WhereFilters4Boxplot=%str(), boxplot_width=1200, boxplot_height=1000 );",ImportFileHeadersFromZIP FileOrDirExist GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath mkfmt4grps_by_var randombetween ntokens rank4grps ucsc_cell_matrix2wideformatdsd get_numeric_table_vars_length
Boxplots4GenesInGTExV8ByAA,COVID19_GWAS_Analyzer,"Download GTEx V8 RNAseq data and make boxplots for target genes' FPKM by ancestry, such as African American and European American.","Boxplots4GenesInGTExV8ByAA( genes=MAP3K19 R3HDM1 CXCR4 DARS LCT UBXN4 MCM6 ZRANB3 RAB3GAP1 CCNT2 ACMSD TMEM163, dsdout=exp, UseGeneratedDsd=0, PreviousDsd=tgt, Lib4PreviousDsd=GTEx, WhereFilters4Boxplot=%str(), boxplot_width=800, boxplot_height=1000 );",ImportFileHeadersFromZIP FileOrDirExist GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath mkfmt4grps_by_var randombetween ntokens rank4grps ucsc_cell_matrix2wideformatdsd get_numeric_table_vars_length
Boxplots4GenesInGTExV8ByGrps,COVID19_GWAS_Analyzer,"Download GTEx V8 RNAseq data and make boxplots for target genes' FPKM by multiple groups, including ancestry and sex, such as African American and European American.","Boxplots4GenesInGTExV8ByGrps( genes=MAP3K19 R3HDM1 CXCR4, dsdout=exp, bygrps=sex AA, /*by AA population and sex or either of them!*/ UseGeneratedDsd=0, PreviousDsd=tgt, /*This is a fixed dsd used by the proc sgpanel*/ Lib4PreviousDsd=GTEx, WhereFilters4Boxplot=%str(),/*such as cluster in (""Lung"" ""Spleen"" ""Whole Blood""); Note these items are case sensitive!*/ boxplot_width=1200, boxplot_height=1000, draw_exp_heatmap=1, /*Also draw exp heatmap*/ columns=1, /*Draw boxplots in the number of columns asign value >1 if drawing multiple genes column-wide!*/ uniscale_type=all, /*make the axis the same for ALL, column (column-wide), or row (row-wide)*/ yaxis_max_value= /*set the max value for the y axis, which will be set for all lattice panels If left empty, the macro will get the closer largest integer as the max y value;*/ );",ImportFileHeadersFromZIP FileOrDirExist GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath mkfmt4grps_by_var randombetween ntokens rank4grps ucsc_cell_matrix2wideformatdsd get_numeric_table_vars_length
CaculateMulteQTLs_in_GTEx,COVID19_GWAS_Analyzer,Calculate cis- or trans-eQTL for multiple SNPs via GTEx API.,"CaculateMulteQTLs_in_GTEx( query_snps=rs17425819 rs7850484, gene=JAK2, genoexp_outdsd=genos_and_exps,/*output dataset name in long format for genotype and gene expression across different tissues*/ eQTLSumOutdsd=AssocSummary, rgx4tissues=, /*optional regular expression to select specific tissues for haplotype association; such as (lung|liver) */ filter4geno= %str(where geno^=-1), /*put conditional filters for geno; Need to set collect_geno4snps as 1 to be effective!*/ perform_glm=0, /*Provide value 1 to conduct proc glm for eQTL analysis; To perform proc glm for eqtl analysis, it is needed to assign value 1 for collect_geno4snps; Note: this is not necessary, because GTEx API does not provide PCA, so proc glm will not be able to repeat the same eQTL association p value as that from GTEx; */ create_eqtl_boxplots=0,/*Provide value 1 to make boxplot for each SNP; When setting this parameter as 1, the parameter collect_geno4snps will automatically be set as 1, too!*/ collect_geno4snps=0, /*Provide value 1 to aggregate geno for SNPs across tissues*/ heatmap_xvar=tissue,/*either SNP or tissue can be used to as x dimension group in heatmap*/ heatmap_yvar=SNP,/*either SNP or tissue can be used to as x dimension group in heatmap*/ heatmap_height=,/*eQTL heatmap height; if empty, defaut value by total number of tissue will be used*/ heatmap_width=,/*eQTL heatmap width; if empty, default value by total number of SNPs will be used*/ heatmap_fmt=png, /*make svg or png heatmap*/ boxplotpanel_width=, boxplotpanel_height=, tissue_eqtl_p_cutoff=1, /*To save space for heatmap and boxplot, it is better to only focus on tissues with eQTL p lt than the cutoff*/ boxplot_colnum=6 /*this parameter decide how many tissues would be plotted in each row*/ );",QueryGTEx4GeneID ntokens boxplotbygrp heatmap4longformatdsd getdsdvarsfmt long2wide4multigrpsSameTypeVars get_num_or_char_vars4dsd match_elements_in_macro_list
Caculate_eQTL_in_GTEx,COVID19_GWAS_Analyzer,"Calcuate cis- or trans-eQTL for single SNP via GTEx API, which is replaced by the macro CaculateMulteQTLs_in_GTEx.","Caculate_eQTL_in_GTEx( /*Please use CaculateMulteQTLs_in_GTEx to replace this macro*/ query_snp=rs13057307, gene=Apobec3a, genoexp_outdsd=genoexp, eQTLSumOutdsd=AssocSummary, filter4geno= /*provide sas where or if condition to filter genotype data such as %str(where geno^=0;) */ );",QueryGTEx4GeneID ntokens
DiffTwoCorrelatedGWAS,COVID19_GWAS_Analyzer,"Perform differential effect size analysis for SNPs from two GWASs that are correlated due to sample overlap; this macro is deprecated, and please use the macro DiffTwoGWAS.","DiffTwoCorrelatedGWAS(/*Note: only common SNPs will be kept*/ gwas1dsd=, gwas2dsd=, nctrl=,/*Number of samples for the common grp between gwas1 and gwas2*/ ngwas1=,/*Total sample size for gwas1*/ ngwas2=,/*Total sample size for gwas2*/ gwas1chr_var=, gwas1pos_var=, snp_varname=rsid, beta_varname=beta, se_varname=se, p_varname=P, gwasout=out, stdize_zscore=1 /*Stardize zscore by mean and scaled with std, which will make the qqplot more reasonable*/ );",Lambda_From_P Import_Space_Separated_File QQplot zscroe2p
DiffTwoGWAS,COVID19_GWAS_Analyzer,Perform differential effect size analysis for SNPs from two GWASs that have sample overlap or no overlap.,"DiffTwoGWAS(/*Note: only common SNPs will be kept; also requires to have two allele vars common to both GWASs: such as allele1 and allele2 in both GWAS; duplicate snps in each GWAS will be excluded*/ gwas1dsd=, gwas2dsd=, gwas1chr_var=, gwas1pos_var=,/*gwas1 chr and position variable names should be the same as that of the other GWAS*/ snp_varname=rsid,/*Marker id variable name for the two GWASs*/ beta_varname=beta,/*Beta variable name for the two GWASs*/ se_varname=se,/*standard error variable name should be the same for two GWASs*/ p_varname=P, /*P variable name from both two GWASs should be the same!*/ gwasout=out, stdize_zscore=1, /*Stardize zscore by mean and scaled with std, which will make the qqplot more reasonable*/ mk_manhattan_qqplots4twoGWASs=1, gwas1_tot=, gwas2_tot=, /*When the total number of samples from the two gwass are provided, it will use sample size to adjust the variance estimation: sqrt( 2*(gwas1_tot-1)*se1^2/(total_of_two_gwas-2) + 2*(gwas2_tot-1)*se2^2/(total_of_two_gwas-2) ) This is called pooled variance; */ allele1var=allele1, allele2var=allele2 );",Lambda_From_P Import_Space_Separated_File QQplot print_text_as_title zscroe2p
GRASP_COVID_Hosp_GWAS_Comparison,COVID19_GWAS_Analyzer,Perform differential effect size analysis for any two hospitalizaiton COVID-19 GWASs from GRASP database.,"GRASP_COVID_Hosp_GWAS_Comparison( gwas1=https://grasp.nhlbi.nih.gov/downloads/COVID19GWAS/10202020/COVID19_HGI_B1_ALL_20201020.b37.txt.gz, gwas2=https://grasp.nhlbi.nih.gov/downloads/COVID19GWAS/10202020/COVID19_HGI_B2_ALL_leave_23andme_20201020.b37.txt.gz, outdir=%sysfunc(pathname(HOME)), /*SAS GWAS data sets, GWAS1, GWAS2, and GWAS1_vs_2 will be output into the dir*/ mk_manhattan_qqplots4twoGWASs=0, /*Generate GWAS manhattan and qq plots*/ maf_cutoff=0.01 /*MAF cutoff of SNPs from both GWASs*/ );",DiffTwoGWAS Lambda_From_P Import_Space_Separated_File QQplot print_text_as_title zscroe2p get_HGI_covid_gwas_from_grasp ImportHGICovidGWASFromZIP GetZIPContents chr_format_exchanger del_file_with_fullpath UncompressGZWith7ZInWindows Run_7Zip chdir direxist dwn_http_file get_top_signal_within_dist local_gwas_hits_and_nearby_sigs ntokens totobsindsd
GTEX_SexBasedDiffGeneHeatmap,COVID19_GWAS_Analyzer,create heatmap for sex-biased genes based on GTEx data.,"GTEX_SexBasedDiffGeneHeatmap(GTEx_sex_gz_file,gtf_dsd,st,end,chr,vars4sortheatmap);",ImportFileHeadersFromZIP FileOrDirExist GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath getdsdvarsfmt heatmap4longformatdsd mkfmt4grpsindsd mkfmt4grps_by_var randombetween
GTEx_Hap_eQTL_Analyzer,COVID19_GWAS_Analyzer,Phase GTEx SNPs and conduct haplotype level cis-eQTL analysis.,"GTEx_Hap_eQTL_Analyzer( SNPs4Haplotype=rs7872943 rs1887428 rs1887429 rs59679286 rs5938437 rs10974914 rs1576271, plink_prunned_snp_file=H:\D_Queens\SASGWASDatabase\Important_Analysis_Codes\PExFInS_SAS\Databases\1KG_Phase3\JAK2_up_down_1Mb.prune.in, /*Plink generated prune in file containing SNP rsids*/ genesymbol=JAK2,/*Target gene for haplotype eQTL analysis*/ GTEx_tissue_rgx=blood, /*regular expression without wrapping us in two forward slashes to match target GTEx tissue for eQTL analysis at haplotype level*/ exp_hap_outdsd=exp_hap_out, max_num_snps4PCA=500, /*Largest number of SNPs used for PCA analysis*/ drop_PCAs_and_its_snps=1 /*To simplify the final output dsd, drop SNPs used to generate these PCAs and the final PCAs*/ );",
GTEx_eQTL_genes_scatterplot,COVID19_GWAS_Analyzer,Query cis-eQTLs of genes in GTEx database and make cis-eQTL scatter plots.,"GTEx_eQTL_genes_scatterplot( genes=Apobec3a Apobec3b, hg38_gtf_dsd=FM.GTF_HG38, eqtldsdout=tgtgenewidedsd, min_pos= ,/*restrict the start position in hg38 of local Manhattan plot; If it is empty, default value would be the minimum start position;*/ max_pos= ,/*restrict the end position in hg38 of local Manhattan plot; If it is empty, default value is the maximum end position*/ colormodel= cxFAFBFE cx667FA2 cxD05B5B /*If empty, default color model of blue grey red; supply different color combinations to draw different heatmap, such as yellow blue green red; */ );",PlotGeneTrackWithoutScatterplot QueryGTExeQTLs4Genesymbol QueryGTExeQTLs4MultEnsemblGenes ntokens SNP_Local_Manhattan_With_GTF VarnamesInDsd clustergram4longformatdsd heatmap4longformatdsd getdsdvarsfmt long2wide4multigrpsSameTypeVars get_num_or_char_vars4dsd
Gene_Local_Manhattan_With_GTF,COVID19_GWAS_Analyzer,Generate local Manhattan plot for query gene.,"Gene_Local_Manhattan_With_GTF(/*As this use other subs, it is not uncommon that some global vars would be in the same name, such as macro vars chr and i, thus, to avoid of crash, chr_var is used instead of macro var chr in this macro; Note: this macro will use the gene name to query GTF and GWAS, and then make local Manhattan plot with the top SNP at the center around the query gene!*/ gwas_dsd=, gwas_chr_var=chr,/*GTF uses numeric chr notation; ensure the type of chr is consistent with input gwas dsd*/ gwas_AssocPVars=pval1 pval2, Gene_IDs=CD55 JAK2, dist2Gene=50000,/*in bp; left or right size distant to each target Gene for the Manhattan plot*/ SNP_Var_GWAS=SNP, Pos_Var_GWAS=pos, gtf_dsd=FM.GTF_HG19, Gene_Var_GTF=Genesymbol, GTF_Chr_Var=chr,/*GTF uses numeric chr notation; ensure the type of chr is consistent with input gwas dsd*/ GTF_ST_Var=st, GTF_End_Var=end, ZscoreVars=zscore1 zscore2,/*Can be beta1 beat2 or other numberic vars indicating assoc or other +/- directions*/ gwas_labels_in_order=gwas1 gwas2,/*scatterplot headers*/ design_width=800, design_height=600, barthickness=15, /*gene track bar thinkness*/ dotsize=8, dist2sep_genes=1000,/*Distance to separate close genes into different rows in the gene track; provide negative value to have all genes in a single row in the final gene track*/ where_cndtn_for_gwasdsd=%str(pval<1), /*where condition to filter input gwas_dsd*/ shift_text_yval=-0.2, /*in terms of gene track labels, add positive or negative vale, ranging from 0 to 1, to liftup or lower text labels on the y axis; the default value is -0.2 to put gene lable under gene tracks; Change it with the macro var pct4neg_y!*/ fig_fmt=svg, /*output figure formats: svg, png, jpg, and others*/ pct4neg_y=2, /*the most often used value is 1; compacting the bed track y values by increasing the scatterplot scale, which can reduce the bed trace spaces; It seems that two-fold increasement leads to better ticks for different tracks! Use value >1 will increase the gene tract, while value < 1 will reduce it! Note: when there are only 1 or 2 scatterplots, it is better to provide value = 0.5; Modify this parameter with the parameter shift_text_yval to adjust gene label! Typically, when there are more scatterplots, it is necessary to increase the value of pct4neg_y accordingly; If there are only <4 scatterplots, the value would be usually set as 1 or 2; */ adjval4header=-0.5, /*In terms of header of each subscatterplot, provide postive value to move up scatter group header by the input value*/ makedotheatmap=0,/*use colormap to draw dots in scatterplot instead of the discretemap; Note: if makedotheatmap=1, the scatterplot will not use the discretemap mode based on the negative and postive values of lattice_subgrp_var to color dots in scatterplot*/ color_resp_var=,/*Use value of the var to draw colormap of dots in scatterplot if empty, the default var would be the same as that of yval_var;*/ makeheatmapdotintooneline=0,/*This will make all dots have the same yaxis value but have different colors based on its real value in the heatmap plot; To keep the original dot y axis value, assign 0 to the macro var This would be handy when there are multiple subgrps represented by different y-axis values! By modifying the y-axis values for these subgrps, the macro can plot them separately in each subtrack! */ var4label_scatterplot_dots= ,/*Make sure the variable name is not grp, which is a fixed var used by the macro for other purpose; the variable should contain values of target SNPs and other non-targets are asigned with empty values; Whenever makeheatmapdotintooneline=1 or 0, it is possible to use values of the var4label_scatterplot_dots to label specific scatterplot dots based on the customization of the variable predifined by users for the input data set; default is empty; provide a variable that include non-empty strings for specific dots in the scatterplots;*/ SNPs2label_scatterplot_dots= /*Add multiple SNP rsids to label dots within or at the top of scatterplot Note: if this parameter is provided, it will replace the parameter var4label_scatterplot_dots! */ );",ntokens
GetGenesExons4LatticeGscatter,COVID19_GWAS_Analyzer,retrieve exon bed regions from GTF file for making gene tracks along with association signals in a scatter plot.,"GetGenesExons4LatticeGscatter( gtf_dsd=FM.GTF_HG19, /*Need to use sas macro import gtf to save GTF_HG19; the data format for the gtf_dsd is fixed with the following vars: chr st end genesymbol type protein_coding */ chr=, min_st=, max_end=, dist2genes=100000 );",
GetGenesExons4LatticeGscatter,COVID19_GWAS_Analyzer,retrieve exon bed regions from GTF file for making gene tracks along with association signals in a scatter plot.,GetGenesExons4LatticeGscatter;,
HGI2GWASs_Zscore_Calculator,COVID19_GWAS_Analyzer,Perform differential effect size analysis for two downloaded HGI GWASs (release 7 or other older releases from HGI). The macro will export a sas dataset into a text file.,"HGI2GWASs_Zscore_Calculator( gwas1_txt_file=COVID19_HGI_B1_ALL_20201020.txt, gwas2_txt_file=COVID19_HGI_B2_ALL_leave_23andme_20201020.txt, dsdout=B1_vs_B2, HGI_release_num=7 /*before release 7, such as 4, 5, and 6, the input data format are same but different from 7*/ );",
HGI2PairwiseGWASPipeline,COVID19_GWAS_Analyzer,A wraper to conduct pairwise GWAS comparison between two GWASs by running the macro HGI2GWASs_Zscore_Calculator and generating forest plot for target SNPs. Note: it only works in Windows system.,"HGI2PairwiseGWASPipeline( gwasfile_dir=F:\360yunpan\SASCodesLibrary\SAS-Useful-Codes\Macros, gwas1gzfile=COVID19_HGI_B1_ALL_leave_23andme_20210107.b37.txt.gz, gwas2gzfile=COVID19_HGI_B2_ALL_leave_23andme_20210107.b37.txt.gz, EUR_AFR_frq_file=EUR_AFR_specific.txt, tgt_snps=12:113357193:G: 17:44219831:T:A 19:10427721:T:A rs10490770 rs10774671 rs11919389 rs13050728 rs1381109 rs1819040 rs1886814 rs2109069 rs2271616 rs4801778 rs67579710 rs72711165 rs74956615 rs77534576 rs912805253, /*snp rsids or chr:pos:ref:alt if no rsid*/ outfile_tag=HGI_release5_gws_hts.diff_zscore, HGI_release_num=7 /*before release 7, such as 4, 5, and 6, the input data format are same but different from 7*/ );",HGI2GWASs_Zscore_Calculator Run_7Zip chdir direxist rank4grps
Haplotype_Analysis4SNPs_in_GTEx,COVID19_GWAS_Analyzer,Extract SNPs numeric genotypes from GTEx database and its correponding eQTL association results. Note: the exported genotypic data can be phased using the macro happy in SAS Workbench 9.4 with the SAS genetic installed in Windows system. SAS OnDemand for Academics does not provide the SAS genetic module.,"Haplotype_Analysis4SNPs_in_GTEx( query_snps=rs7850484 rs17425819, gene=GAPDH, genoexp_outdsd=genos, eQTLSumOutdsd=AssocSummary, rgx4tissues=, /*optional regular expression to select specific tissues for haplotype association; such as (lung|liver) */ filter4geno= %str(where geno^=-1) /*put conditional filters for geno*/ );",QueryGTEx4GeneID ntokens long2wide4multigrpsSameTypeVars get_num_or_char_vars4dsd match_elements_in_macro_list
ImportCovidGWASFromZIP,COVID19_GWAS_Analyzer,Import HGI release 4 COVID-19 GWAS summary statistics of gz format as a sas dataset.,"ImportCovidGWASFromZIP(zip,filename_rgx,sasdsdout,deleteZIP);",GetZIPContents chr_format_exchanger del_file_with_fullpath
ImportFileHeadersFromZIP,COVID19_GWAS_Analyzer,Import partial or all contents of a compressed file in zip or gz format into a sas dataset. Note: it can be used to check the header lines in a compressed file like the linux function 'head'.,"ImportFileHeadersFromZIP( zip=,/*Only provide file with .gz, .zip, or common text file without comporession*/ filename_rgx=., obs=max, sasdsdout=x, deleteZIP=0, infile_command=%str(firstobs=1 obs=10;input;info=_infile_;), /*Better to use nrbquote to replace str and use unquote within the macro to get back the input infile_command;*/ use_zcat=0, var4endlinenum=adj_endlinenum /*make global var for the endline number but it is necessary to use syminputx in the infile_command to record the endline number; call symputx(""&var4endlinenum"",trim(left(put(_n_,8.))));",FileOrDirExist GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath
ImportGendcodeGTFFromZIP,COVID19_GWAS_Analyzer,"Import gencode GTF file from compressed gz file into a sas dataset, which is in a typical bed format.","ImportGendcodeGTFFromZIP( zip, filename_rgx, sasdsdout, deleteZIP, Use_zcat=0 /*if the gzip option is not availabe for old sas, use zcat in linux to replace it!*/ );",GetZIPContents chr_format_exchanger del_file_with_fullpath
ImportHGICovidGWASFromHGI_R7,COVID19_GWAS_Analyzer,This macro is only able to import HGI COViD-19 GWAS summary statistics of release 7.,"ImportHGICovidGWASFromHGI_R7( zip, filename_rgx, sasdsdout, deleteZIP, for_subpop=0 /*R7 GWAS for ALL and sub-populations are in different format*/ );",GetZIPContents del_file_with_fullpath
ImportHGICovidGWASFromZIP,COVID19_GWAS_Analyzer,This macro is only able to import HGI COVID-19 GWAS summary statistics from GRASP but not HGI database.,"ImportHGICovidGWASFromZIP(zip,filename_rgx,sasdsdout,deleteZIP);",GetZIPContents chr_format_exchanger del_file_with_fullpath
ImportTXTFromZIP,COVID19_GWAS_Analyzer,Import compressed file (such as zip or gz) into a sas dataset.,"ImportTXTFromZIP(zip,filename_rgx,sasdsdout,extra_proc_import_codes,deleteZIP);",GetZIPContents del_file_with_fullpath
Import_UKB_GWAS,COVID19_GWAS_Analyzer,Import UK Biobank GWAS summary statistics provided by Neale's lab.,"Import_UKB_GWAS( ukb_file=both_sexes.INFLUENZA_All_influenza_not_pneumonia_,/*for gz file, need to provide fullpath*/ dsdout=x, deleteZIP=0, print_top_hits=0 );",ImportFileHeadersFromZIP FileOrDirExist GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath chr_format_exchanger dwn_http_file
Lambda_From_P,COVID19_GWAS_Analyzer,Calculate genome-wide inflation labmda based on p values.,"Lambda_From_P(P_dsd,P_var,case_n,control_n,dsdout);",Import_Space_Separated_File
Lattice_gscatter_over_bed_track,COVID19_GWAS_Analyzer,Make gene-exon tracks with association signals included in the upper scatter plots in lattice format. Note: the macro also can change the upper scatter plots into heatmap.,"Lattice_gscatter_over_bed_track( bed_dsd, /*Too many bed regions (>1000) for the gene track will slow down the macro dramatically; Note: the macro will change the input bed_dsd when supplying xaxis_viewmin and xaxis_viewmax; */ chr_var, st_var, end_var, grp_var, scatter_grp_var, lattice_subgrp_var, yval_var, yaxis_label=Group, linethickness=20, track_width=800, track_height=400, dist2st_and_end=0, dotsize=10, debug=0, add_grp_anno=1, /*This will add group names, such as gene labels, to each member of grp_var*/ grp_font_size=8, grp_anno_font_type=italic, /*other type: normal*/ shift_text_yval=-0.2, /*in terms of gene track labels, add positive or negative vale, ranging from 0 to 1, to liftup or lower text labels on the y axis; the default value is -0.2 to put gene lable under gene tracks; Change it with the macro var pct4neg_y! Provide very large or small values, such as 9999 or -9999 to remove test labels for genes!*/ yaxis_offset4min=0.05, /*provide 0-1 value or auto to offset the min of the yaxis*/ yaxis_offset4max=0.05, /*provide 0-1 value or auto or to offset the max of the yaxis*/ yoffset4max_drawmarkersontop=0.2,/*If draw scatterplot marker labels on the top of track, this fixed value will be used instead of yaxis_offset4max!*/ xaxis_offset4min=0.02, /*provide 0-1 value or auto to offset the min of the xaxis*/ xaxis_offset4max=0.02, /*provide 0-1 value or auto to offset the max of the xaxis*/ fig_fmt=svg, /*output figure formats: svg, png, jpg, and others*/ refline_thickness=5,/*Use thick refline to separate different tracks*/ refline_color=lightgray,/*Color for reflines*/ pct4neg_y=2, /*the most often used value is 1; compacting the bed track y values by increasing the scatterplot scale, which can reduce the bed trace spaces; It seems that two-fold increasement leads to better ticks for different tracks! Use value >1 will increase the gene tract, while value < 1 will reduce it! Note: when there are only 1 or 2 scatterplots, it is better to provide value = 0.5; Modify this parameter with the parameter shift_text_yval to adjust gene label! Typically, when there are more scatterplots, it is necessary to increase the value of pct4neg_y accordingly; If there are only <4 scatterplots, the value would be usually set as 1 or 2; */ NotDrawScatterPlot=0,/*This filter will be useful when it is only wanted to draw the bottom bed track without of the scatterplot; this is the idea solution to draw gene track only!*/ offsety=0.05,/*If NotDrowScatterPlot=1, this value will be subtracted from negative gene group value; This enables the upper and lower part have enough blank space for gene track*/ makedotheatmap=0,/*use colormap to draw dots in scatterplot instead of the discretemap; Note: if makedotheatmap=1, the scatterplot will not use the discretemap mode based on the negative and postive values of lattice_subgrp_var to color dots in scatterplot*/ color_resp_var=,/*Use value of the var to draw colormap of dots in scatterplot if empty, the default var would be the same as that of yval_var;*/ makeheatmapdotintooneline=0,/*This will make all dots have the same yaxis value but have different colors based on its real value in the heatmap plot; To keep the original dot y axis value, assign 0 to the macro var This would be handy when there are multiple subgrps represented by different y-axis values! By modifying the y-axis values for these subgrps, the macro can plot them separately in each subtrack! */ var4label_scatterplot_dots=,/*Make sure the variable name is not grp, which is a fixed var used by the macro for other purpose; Whenever makeheatmapdotintooneline=1 or 0, it is possible to use values of the var4label_scatterplot_dots to label specific scatterplot dots based on the customization of the variable predifined by users for the input data set; default is empty; provide a variable that include non-empty strings for specific dots in the scatterplots;*/ label_dots_once_on_top=1,/*Put value 1 to label each unique label once on top of scatterplot; provide 0 for labeling selected dots in inside scatterplots; The script will enlarge the macro var yaxis_offset4max to be 0.1! */ dist_pct_to_cluster_pos=0.02,/*Use the input pct to calcuate dist based on the distance betweent the first label to the last label and define labels into cluster if they are too close to each other if their distance is less than pct_of_total_dist*/ fc2distant_close_labels=3,/*increase the distance among close labels by input fold change*/ reflinecolor4selecteddots=grey,/*asign color for the vertical reference lines for userselected dots*/ text_rotate_angle=90, /*Angle to rotate text labels for these selected dots by users*/ Yoffset4textlabels=2.5, /*Move up the text labels for target SNPs in specific fold; the default value 2.5 fold works for most cases*/ font_size4textlabels=10,/*Font size for these text labels*/ mk_fake_axis_with_updated_func=1, /*The new func make the xaxis more compacted between gene tracks and scatter plots;*/ sameyaxis4scatter=1,/*Make the same y-axis for scatterplots*/ maxyvalue4truncat=30,/*Asign yaxis_value >maxyvalue4trancat as the value of maxyvalue4trancat*/ adjval4header=-0.5, /*In terms of header of each subscatterplot, provide postive value to move up scatter group header by the input value*/ ordered_sc_grpnames= ,/*Labels for each scatter plot from down to up in order Use _ to replace blank space within each name and all _ will be changed into black space by the macro at the end*/ xaxis_label=%nrstr(Position (bp) on chromosome &chr_name), /*The macro var &chr_name will be unquoted after resolved*/ xaxis_viewmin=,/*arbitrary xaxis min value to show the figure, and it requires to work with thresholdmin=0*/ xaxis_viewmax=,/*arbitrary xaxis max vale to show the figure, and it requires to go along with thresholdmax=0*/ scatterdotcols=green orange, /*set colors for the beta directions (negative and positve values) in scatterplots*/ dataContrastCols=%str() /*Note: these colors will be used for the gene track but not the scatterplot; %str(lightblue lightgreen CXFFF000 CXFF7F00 CXFF00FF CXFF0000 CXEAADEA CXE6E8FA CXDB9370 CXDB70DB CXD9D919 CXD8D8BF CXCD7F32 CXC0C0C0 CXBC8F8F CXB87333 CXB5A642 CXADEAEA CXA67D3D CXA62A2A CX9F9F5F CX9F5F9F CX97694F CX8E236B CX8E2323 CX8C7853 CX8C1717 CX871F78 CX856363 CX855E42 CX70DB93 CX5F9F9F CX5C4033 CX545454 CX4F2F4F CX4E2F2F CX32CD32 CX2F4F2F CX238E23 CX236B8E CX23238E CX00FFFF CX00FF00 CX0000FF CX000000 )*/ /*Note: default is to use %str(), which will apply system colors automatically; add the following colors separated by blank space if desired, CXADD8E6 CX98FB98 CXF08080 CX0000FF CXFFF00 CX9F5F9F CXA62A2A CX5F9F9F CX871F78 lightblue lightgreen lightcoral and others for the above! https://support.sas.com/rnd/base/ods/templateFAQ/Template_colors.html BLACK #FFFFFF BLUE #0000FF YELLOW #FFF000 BLUE VIOLET #9F5F9F BROWN #A62A2A CADET BLUE #5F9F9F DARK BROWN #5C4033 DARK PURPLE #871F78 DUSTY ROSE #856363 GOLD #CD7F32 KHAKI #9F9F5F NAVY BLUE #23238E PINK #BC8F8F SILVER #E6E8FA TURQUOISE #ADEAEA RED #FF0000 MAGENTA #FF00FF BLACK #000000 BRASS #B5A642 BRONZE #8C7853 COPPER #B87333 DARK GREEN #2F4F2F DARK TAN #97694F FIREBRICK #8E2323 GREY #C0C0C0 LIME GREEN 32CD32 ORANGE #FF7F00 PLUM #EAADEA STEEL BLUE #236B8E VIOLET #4F2F4F GREEN #00FF00 CYAN #00FFFF AQUAMARINE #70DB93 BRIGHT GOLD #D9D919 BRONZE II #A67D3D CORAL #FF7F00 DARK WOOD #855E42 DIM GREY #545454 FOREST GREEN #238E23 INDIAN RED #4E2F2F MAROON #8E236B ORCHARD #DB70DB SCARLET #8C1717 TAN #DB9370 WHEAT #D8D8BF */ );",Check_VarnamesInDsd check_var_type delete_empty_dsd iscolallmissing make_fake_axis4NegPosVal_by_grps add_fake_pos_by_grp4nonnegvars totobsindsd make_fake_axis_values4grps ntokens number_rows_by_grp
Lattice_gscatter_over_bed_track0,COVID19_GWAS_Analyzer,old version of the important macro Lattice_gscatter_over_bed_track.,"Lattice_gscatter_over_bed_track0(/*Old without adding of gene annotation to tracks, which is for backup only*/ bed_dsd,/*Too many bed regions (>1000) for the gene track will slow down the macro dramatically*/ chr_var, st_var, end_var, grp_var, scatter_grp_var, lattice_subgrp_var, yval_var, yaxis_label=Group, linethickness=20, track_width=800, track_height=400, dist2st_and_end=0, dotsize=10, debug=0 );",check_var_type delete_empty_dsd iscolallmissing make_fake_axis_values4grps number_rows_by_grp
Lattice_gscatter_over_bed_track_,COVID19_GWAS_Analyzer,a backup of the important macro Lattice_gscatter_over_bed_track.,"Lattice_gscatter_over_bed_track_(/*Old without adding the textplot section for labeling selected dots in scatterplots*/ bed_dsd, /*Too many bed regions (>1000) for the gene track will slow down the macro dramatically; Note: the macro will change the input bed_dsd when supplying xaxis_viewmin and xaxis_viewmax; */ chr_var, st_var, end_var, grp_var, scatter_grp_var, lattice_subgrp_var, yval_var, yaxis_label=Group, linethickness=20, track_width=800, track_height=400, dist2st_and_end=0, dotsize=10, debug=0, add_grp_anno=1, /*This will add group names, such as gene labels, to each member of grp_var*/ grp_font_size=8, grp_anno_font_type=italic, /*other type: normal*/ shift_text_yval=0.1, /*add positive or negative vale, ranging from 0 to 1, to liftup or lower text labels on the y axis; Change it with the macro var pct4neg_y!*/ yaxis_offset4min=0.05, /*provide 0-1 value or auto to offset the min of the yaxis*/ yaxis_offset4max=0.05, /*provide 0-1 value or auto or to offset the max of the yaxis*/ xaxis_offset4min=0.02, /*provide 0-1 value or auto to offset the min of the xaxis*/ xaxis_offset4max=0.02, /*provide 0-1 value or auto to offset the max of the xaxis*/ fig_fmt=svg, /*output figure formats: svg, png, jpg, and others*/ refline_thickness=5,/*Use thick refline to separate different tracks*/ refline_color=lightgray,/*Color for reflines*/ pct4neg_y=1.5, /*the most often used value is 1; compacting the bed track y values by increasing the scatterplot scale, which can reduce the bed trace spaces; It seems that two-fold increasement leads to better ticks for different tracks! Use value >1 will increase the gene tract, while value < 1 will reduce it! Note: when there are only 1 or 2 scatterplots, it is better to provide value = 0.5; */ NotDrawScatterPlot=0,/*This filter will be useful when it is only wanted to draw the bottom bed track without of the scatterplot; this is the idea solution to draw gene track only!*/ offsety=0.05,/*If NotDrowScatterPlot=1, this value will be subtracted from negative gene group value; This enables the upper and lower part have enough blank space for gene track*/ makedotheatmap=1,/*use colormap to draw dots in scatterplot instead of the discretemap; Note: if makedotheatmap=1, the scatterplot will not use the discretemap mode based on the negative and postive values of lattice_subgrp_var to color dots in scatterplot*/ color_resp_var=,/*Use value of the var to draw colormap of dots in scatterplot if empty, the default var would be the same as that of yval_var;*/ makeheatmapdotintooneline=0,/*This will make all dots have the same yaxis value but have different colors based on its real value in the heatmap plot; To keep the original dot y axis value, assign 0 to the macro var This would be handy when there are multiple subgrps represented by different y-axis values! By modifying the y-axis values for these subgrps, the macro can plot them separately in each subtrack! */ mk_fake_axis_with_updated_func=1, /*The new func make the xaxis more compacted between gene tracks and scatter plots;*/ sameyaxis4scatter=1,/*Make the same y-axis for scatterplots*/ maxyvalue4truncat=30,/*Asign yaxis_value >maxyvalue4trancat as the value of maxyvalue4trancat*/ adjval4header=0.5, /*Move down scatter group header by value*/ ordered_sc_grpnames= ,/*Labels for each scatter plot from down to up in order Use _ to replace blank space within each name and all _ will be changed into black space by the macro at the end*/ xaxis_label=%nrstr(Position (bp) on chromosome &chr_name), /*The macro var &chr_name will be unquoted after resolved*/ xaxis_viewmin=,/*arbitrary xaxis min value to show the figure, and it requires to work with thresholdmin=0*/ xaxis_viewmax=,/*arbitrary xaxis max vale to show the figure, and it requires to go along with thresholdmax=0*/ scatterdotcols=green orange, /*set colors for the beta directions (negative and positve values) in scatterplots*/ dataContrastCols=%str() /*Note: these colors will be used for the gene track but not the scatterplot; %str(lightblue lightgreen CXFFF000 CXFF7F00 CXFF00FF CXFF0000 CXEAADEA CXE6E8FA CXDB9370 CXDB70DB CXD9D919 CXD8D8BF CXCD7F32 CXC0C0C0 CXBC8F8F CXB87333 CXB5A642 CXADEAEA CXA67D3D CXA62A2A CX9F9F5F CX9F5F9F CX97694F CX8E236B CX8E2323 CX8C7853 CX8C1717 CX871F78 CX856363 CX855E42 CX70DB93 CX5F9F9F CX5C4033 CX545454 CX4F2F4F CX4E2F2F CX32CD32 CX2F4F2F CX238E23 CX236B8E CX23238E CX00FFFF CX00FF00 CX0000FF CX000000 )*/ /*Note: default is to use %str(), which will apply system colors automatically; add the following colors separated by blank space if desired, CXADD8E6 CX98FB98 CXF08080 CX0000FF CXFFF00 CX9F5F9F CXA62A2A CX5F9F9F CX871F78 lightblue lightgreen lightcoral and others for the above! https://support.sas.com/rnd/base/ods/templateFAQ/Template_colors.html BLACK #FFFFFF BLUE #0000FF YELLOW #FFF000 BLUE VIOLET #9F5F9F BROWN #A62A2A CADET BLUE #5F9F9F DARK BROWN #5C4033 DARK PURPLE #871F78 DUSTY ROSE #856363 GOLD #CD7F32 KHAKI #9F9F5F NAVY BLUE #23238E PINK #BC8F8F SILVER #E6E8FA TURQUOISE #ADEAEA RED #FF0000 MAGENTA #FF00FF BLACK #000000 BRASS #B5A642 BRONZE #8C7853 COPPER #B87333 DARK GREEN #2F4F2F DARK TAN #97694F FIREBRICK #8E2323 GREY #C0C0C0 LIME GREEN 32CD32 ORANGE #FF7F00 PLUM #EAADEA STEEL BLUE #236B8E VIOLET #4F2F4F GREEN #00FF00 CYAN #00FFFF AQUAMARINE #70DB93 BRIGHT GOLD #D9D919 BRONZE II #A67D3D CORAL #FF7F00 DARK WOOD #855E42 DIM GREY #545454 FOREST GREEN #238E23 INDIAN RED #4E2F2F MAROON #8E236B ORCHARD #DB70DB SCARLET #8C1717 TAN #DB9370 WHEAT #D8D8BF */ );",Check_VarnamesInDsd check_var_type delete_empty_dsd iscolallmissing make_fake_axis4NegPosVal_by_grps add_fake_pos_by_grp4nonnegvars totobsindsd make_fake_axis_values4grps ntokens number_rows_by_grp
Lattice_heatmap_over_bed_track,COVID19_GWAS_Analyzer,Make gene-exon tracks with association signals included in the upper heatmap in the lattice format.,"Lattice_heatmap_over_bed_track( /*This function was included into the sas macro Lattice_gscatter_over_bed_track.sas; It is better to use Lattice_gscatter_over_bed_track.sas instead of this*/ bed_dsd,/*Too many bed regions (>1000) for the gene track will slow down the macro dramatically*/ chr_var, st_var, end_var, grp_var, heatmap_grp_var, lattice_subgrp_var, yval_var, yaxis_label=Group, linethickness=20, track_width=800, track_height=400, dist2st_and_end=0, dotsize=10, debug=0, add_grp_anno=1, /*This will add group names, such as gene labels, to each member of grp_var*/ grp_font_size=8, grp_anno_font_type=italic, /*other type: normal*/ shift_text_yval=0.15, /*add positive or negative vale, ranging from 0 to 1, to liftup or lower text labels on the y axis; Change it with the macro var pct4neg_y!*/ yaxis_offset4min=0.05, /*provide 0-1 value or auto to offset the min of the yaxis*/ yaxis_offset4max=0.05, /*provide 0-1 value or auto or to offset the max of the yaxis*/ xaxis_offset4min=0.02, /*provide 0-1 value or auto to offset the min of the xaxis*/ xaxis_offset4max=0.02, /*provide 0-1 value or auto to offset the max of the xaxis*/ fig_fmt=svg, /*output figure formats: svg, png, jpg, and others*/ refline_thickness=5,/*Use thick refline to separate different tracks*/ refline_color=lightgray,/*Color for reflines*/ pct4neg_y=1, /*compacting the bed track y values by increasing the scatterplot scale, which can reduce the bed trace spaces; It seems that two-fold increasement leads to better ticks for different tracks! Use value >1 will increase the gene tract, while value < 1 will reduce it! Note: when there are only 1 or 2 scatterplots, it is better to provide value = 0.5; */ NotDrawheatmapplot=0,/*This filter will be useful when it is only wanted to draw the bottom bed track without of the scatterplot; this is the idea solution to draw gene track only!*/ makeheatmapdotintooneline=1,/*This will make all dots have the same yaxis value but have different colors based on its real value in the heatmap plot; To keep the original dot y axis value, assign 0 to the macro var This would be handy when there are multiple subgrps represented by different y-axis values! By modifying the y-axis values for these subgrps, the macro can plot them separately in each subtrack! */ mk_fake_axis_with_updated_func=1, /*The new func make the xaxis more compacted between gene tracks and heatmap plots;*/ sameyaxis4heatmap=0,/*Make the same y-axis for scatterplots*/ maxyvalue4truncat=16,/*Asign yaxis_value >maxyvalue4trancat as the value of maxyvalue4trancat*/ adjval4header=0, /*Move down heatmap group header by value*/ ordered_sc_grpnames= ,/*Labels for each heatmap plot from down to up in order Use _ to replace blank space within each name and all _ will be changed into black space by the macro at the end*/ xaxis_label=%nrstr(Position (bp) on chromosome &chr_name (hg19)), /*The macro var &chr_name will be unquoted after resolved*/ heatmapdotcols=green orange, /*set colors for the beta directions (negative and positve values) in scatterplots*/ dataContrastCols=%str() /*Note: these colors will be used for the gene track but not the scatterplot; %str(lightblue lightgreen CXFFF000 CXFF7F00 CXFF00FF CXFF0000 CXEAADEA CXE6E8FA CXDB9370 CXDB70DB CXD9D919 CXD8D8BF CXCD7F32 CXC0C0C0 CXBC8F8F CXB87333 CXB5A642 CXADEAEA CXA67D3D CXA62A2A CX9F9F5F CX9F5F9F CX97694F CX8E236B CX8E2323 CX8C7853 CX8C1717 CX871F78 CX856363 CX855E42 CX70DB93 CX5F9F9F CX5C4033 CX545454 CX4F2F4F CX4E2F2F CX32CD32 CX2F4F2F CX238E23 CX236B8E CX23238E CX00FFFF CX00FF00 CX0000FF CX000000 )*/ /*Note: default is to use %str(), which will apply system colors automatically; add the following colors separated by blank space if desired, CXADD8E6 CX98FB98 CXF08080 CX0000FF CXFFF00 CX9F5F9F CXA62A2A CX5F9F9F CX871F78 lightblue lightgreen lightcoral and others for the above! https://support.sas.com/rnd/base/ods/templateFAQ/Template_colors.html BLACK #FFFFFF BLUE #0000FF YELLOW #FFF000 BLUE VIOLET #9F5F9F BROWN #A62A2A CADET BLUE #5F9F9F DARK BROWN #5C4033 DARK PURPLE #871F78 DUSTY ROSE #856363 GOLD #CD7F32 KHAKI #9F9F5F NAVY BLUE #23238E PINK #BC8F8F SILVER #E6E8FA TURQUOISE #ADEAEA RED #FF0000 MAGENTA #FF00FF BLACK #000000 BRASS #B5A642 BRONZE #8C7853 COPPER #B87333 DARK GREEN #2F4F2F DARK TAN #97694F FIREBRICK #8E2323 GREY #C0C0C0 LIME GREEN 32CD32 ORANGE #FF7F00 PLUM #EAADEA STEEL BLUE #236B8E VIOLET #4F2F4F GREEN #00FF00 CYAN #00FFFF AQUAMARINE #70DB93 BRIGHT GOLD #D9D919 BRONZE II #A67D3D CORAL #FF7F00 DARK WOOD #855E42 DIM GREY #545454 FOREST GREEN #238E23 INDIAN RED #4E2F2F MAROON #8E236B ORCHARD #DB70DB SCARLET #8C1717 TAN #DB9370 WHEAT #D8D8BF */ );",check_var_type delete_empty_dsd iscolallmissing make_fake_axis4NegPosVal_by_grps add_fake_pos_by_grp4nonnegvars totobsindsd make_fake_axis_values4grps number_rows_by_grp
LoadMacros,COVID19_GWAS_Analyzer,A wrapper to load all sas macro in linux or SAS OnDemand Academic environment by running the macro importallmacros_ue.,Probable confict between macro name and its sas filename,
LocalScatterplots4MultGWASs,COVID19_GWAS_Analyzer,"draw stack scatter plots by GWAS for a sas dataset with long format, which means combined association signals from multiple GWASs.","LocalScatterplots4MultGWASs( longformatgwasfile, Chr_var, Pos_var, GWAS_var, beta_var, rsid_var, P_var, subChr, subStPos, subEndPos, otherfilters4whereCondition, rsid_reflinepos, rsid_ref, log10pRef, pcutoff, FigHeight, FigWidth );",
MakeCMapSimilarityScoreBarplot,COVID19_GWAS_Analyzer,Create barplot for drug repositioning similarity scores generated by the online database Cmap. Note: upregulated genes and dowregulated genes can be input into the online Cmap database to determine known drugs' similarity scores based on gene expression profiles of these drugs across different cell lines.,MakeCMapSimilarityScoreBarplot(cmap_similarity_score_file);,
Manhattan,COVID19_GWAS_Analyzer,Generate a Manhattan plot for input GWAS dataset.,"manhattan(dsdin=,pos_var=,chr_var=,P_var=,logP=,gwas_thrsd=, dotsize=4,gwas_sortedby_numchrpos=0, use_uniq_colors=1 /*Draw scatter plots with different colors for chromosomes; provide value 0 to use SAS default color scheme;*/ );",Import_Space_Separated_File check_var_type format_xaxis_with_numeric_order ApplyFunc_rowwide Rename_Del_Rgx4All_Vars numargs char_grp_to_num_grp rows_in_sas_dsd
Manhattan4DiffGWASs,COVID19_GWAS_Analyzer,Generate stack Manhattan plots for an input GWAS dataset containing multiple GWAS summary statistics in wideformat.,"Manhattan4DiffGWASs( dsdin=,/*Input GWAS dataset with multiple GWAS p variables put in columns; it is ideal to have sorted GWAS by numeric chr and position*/ pos_var=,/*Position variable for markers, such as SNPs*/ chr_var=,/*Chromosome variable for markers, such as SNPs; it is better to have numberic chr var as input*/ P_var=,/*The P var for the 1st GWAS that is put at the bottom of the final manhattan plot*/ Other_P_vars=, /*Leave it empty or provide other GWAS P vars in order for making manhattan plots from botton to up*/ logP=1,/*Provide value 1 to indicate the need of performing -log10 caculation for input P_var; Make sure the P_var and Other_P_vars are in the same format!*/ gwas_thrsd=7.3,/*Use it to draw significance reference line in each GWAS track*/ dotsize=2,/*The dot size for scatter plots*/ _logP_topval=10, /*Top -log10P value to truncate GWAS signals and also restrict the max yaxis value of each GWAS track; Make sure to input EVEN number for the macro, as the macro separate ticks by step 2!*/ fig_width=1200, fig_height=500, fontsize=3, flip1stGWAS_signal=1, /*When providing value 1, which will draw the 1st GWAS at the bottom in reverse order for the yaxis, which means the most significant association will be put close to bottom; provide value 0 to draw the 1st GWAS in vertical mode!*/ refline_color_4zero=dark, /*Color the manhattan bottom line*/ rm_signals_with_logP_lt=0.5, /*To make the manhattan plot have reference line at association signal of zero, it is better to remove associaiton signal logP for all GWASs less than the cutoff*/ use_uniq_colors=1, /*Draw scatter plots with different colors for chromosomes; provide value 0 to use SAS default color scheme;*/ gwas_sortedby_numchrpos=0 /*Ideally the input GWAS dsdin should be sorted by numchr and pos; if the GWAS dsdin is not, the macro will sort it accordingly but will require more memory and disk space*/ );",Import_Space_Separated_File check_var_type format_xaxis_with_numeric_order ApplyFunc_rowwide Rename_Del_Rgx4All_Vars numargs char_grp_to_num_grp ntokens rows_in_sas_dsd
Multgscatter_with_gene_exons,COVID19_GWAS_Analyzer,A submacro to generate multiple scatterplots above gene-exon tracks is usually not for running along but used by the Gene_Local_Manhattan_With_GTF or SNP_Local_Manhattan_With_GTF macro.,"Multgscatter_with_gene_exons( bed_dsd=,/*This input dsd should contain association signals, but not for gene bed regions; the name of the var should not be misunderstood! It should contain the arbitrary vars: chr, st, and end If the bed_dsd is missing, the macro will use the min and max position from the gene_exon_bed_dsd as a fake data set to draw track without the scatterplot; The typical input format of bed_dsd would be: chr st end grp num_scattergrp num_lattice_scattergrp the var grp should be character; */ yval_var=, scatter_grp_var=, lattice_subgrp_var=, gene_exon_bed_dsd=, /* This input dsd is for exonic bed regions, which should contains the following vars: chr, st, end, and grp, and these varnames are fixed and used by the internal macro! Make sure there is only one unique chr included in the gene_exon_bed_dsd when the 1st data set bed_dsd is missing! The typical input format of gene_exon_bed_dsd would be: chr st end grp num_scattergrp grp would be character, such as gene or exon char_scattergrp would be y-axis values for these genes and it corresponding exons; */ dist2st_and_end=50000, design_width=1000, design_height=200, barthickness=20, dotsize=6, min_dist4genes_in_same_grps=0.3, /*this will ensure these genes close to each other to be separated in the final gene track; (1) give 0 to plot ALL genes in the same line; (2) give value between 0 and 1 to separate genes based on the pct distance to the whole region; (3) give value > 1 to use absolute distance to separate genes into different groups; Customize this for different gene exon track!*/ sc_labels_in_order= ,/*Provide scatter names matched with the numeric scatter_grp_var Use _ to represent blank space in each name, and these _ will be changed back into blank space!*/ /*Note: More parameters included in the sub-macro Lattice_gscatter_over_bed_track can be modified to obtain better figures; please just find the sub-macro and update the default setting for specific parameters to improve the final figure */ min_xaxis=,/*These two parameters will restrict the min and max position for xaxis*/ max_xaxis=, yaxis_offset4min=0.05, /*provide 0-1 value or auto to offset the min of the yaxis*/ yaxis_offset4max=0.05, /*provide 0-1 value or auto or to offset the max of the yaxis*/ xaxis_offset4min=0.02, /*provide 0-1 value or auto to offset the min of the xaxis*/ xaxis_offset4max=0.02, /*provide 0-1 value or auto to offset the max of the xaxis*/ shift_text_yval=-0.2, /*in terms of gene track labels, add positive or negative vale, ranging from 0 to 1, to liftup or lower text labels on the y axis; the default value is -0.2 to put gene lable under gene tracks; Change it with the macro var pct4neg_y!*/ fig_fmt=svg, /*output figure formats: svg, png, jpg, and others*/ pct4neg_y=2, /*the most often used value is 1; compacting the bed track y values by increasing the scatterplot scale, which can reduce the bed trace spaces; It seems that two-fold increasement leads to better ticks for different tracks! Use value >1 will increase the gene tract, while value < 1 will reduce it! Note: when there are only 1 or 2 scatterplots, it is better to provide value = 0.5; Modify this parameter with the parameter shift_text_yval to adjust gene label! Typically, when there are more scatterplots, it is necessary to increase the value of pct4neg_y accordingly; If there are only <4 scatterplots, the value would be usually set as 1 or 2; */ adjval4header=-0.5, /*In terms of header of each subscatterplot, provide postive value to move up scatter group header by the input value*/ makedotheatmap=1,/*use colormap to draw dots in scatterplot instead of the discretemap; Note: if makedotheatmap=1, the scatterplot will not use the discretemap mode based on the negative and postive values of lattice_subgrp_var to color dots in scatterplot*/ color_resp_var=,/*Use value of the var to draw colormap of dots in scatterplot if empty, the default var would be the same as that of yval_var;*/ makeheatmapdotintooneline=0,/*This will make all dots have the same yaxis value but have different colors based on its real value in the heatmap plot; To keep the original dot y axis value, assign 0 to the macro var This would be handy when there are multiple subgrps represented by different y-axis values! By modifying the y-axis values for these subgrps, the macro can plot them separately in each subtrack! */ var4label_scatterplot_dots= /*Make sure the variable name is not grp, which is a fixed var used by the macro for other purpose; Whenever makeheatmapdotintooneline=1 or 0, it is possible to use values of the var4label_scatterplot_dots to label specific scatterplot dots based on the customization of the variable predifined by users for the input data set; default is empty; provide a variable that include non-empty strings for specific dots in the scatterplots;*/ );",chr_format_exchanger
Multgscatter_with_gene_exons4dsd,COVID19_GWAS_Analyzer,This macro is replaced by the macro Multgscatter_with_gene_exons.,"Multgscatter_with_gene_exons4dsd( bed_dsd=, yval_var=, scatter_grp_var=, gene_exon_bed_dsd=, dist2st_and_end=50000, design_width=1000, design_height=200, barthickness=20, makedotheatmap=0,/*use colormap to draw dots in scatterplot instead of the discretemap; Note: if makedotheatmap=1, the scatterplot will not use the discretemap mode based on the negative and postive values of lattice_subgrp_var to color dots in scatterplot*/ color_resp_var=,/*Use value of the var to draw colormap of dots in scatterplot if empty, the default var would be the same as that of yval_var;*/ makeheatmapdotintooneline=0/*This will make all dots have the same yaxis value but have different colors based on its real value in the heatmap plot; To keep the original dot y axis value, assign 0 to the macro var This would be handy when there are multiple subgrps represented by different y-axis values! By modifying the y-axis values for these subgrps, the macro can plot them separately in each subtrack! */ );",chr_format_exchanger
Only4UKB_Female_vs_Male_GWAS_Pipeline_Old,COVID19_GWAS_Analyzer,Perform sex-biased association analysis for COVID-19 GWAS of UK Biobank data. The macro is deprecated. The updated macro is UKB_Female_vs_Male_GWAS_Pipeline.,Probable confict between macro name and its sas filename,DiffTwoGWAS Lambda_From_P Import_Space_Separated_File QQplot print_text_as_title zscroe2p UKB_Female_vs_Male_GWAS_Pipeline get_top_signal_within_dist local_multigwas_manhattan mkfmt4grps_by_var randombetween ntokens rank4grps map_grp_assoc2gene4covidsexgwas Multgscatter_with_gene_exons chr_format_exchanger needleplot4snpsdiffzscores quotelst needleplot4
OpenSVG_Printer,COVID19_GWAS_Analyzer,Open sas ods svg printer for drawing figures in svg format.,"OpenSVG_Printer( filename=mysvgfilename, svgfileref=out, other_paras4ods_graphics=%str( ), outdir=,/*output svg to the dir; if empty, it will save it into the dir %sysfunc(pathname(HOME));*/ );",
PlotGeneTrackWithoutScatterplot,COVID19_GWAS_Analyzer,Plot gene-exon track based on GTF without plotting scatter plots at the top of the gene-exon track. This would be useful when you only want to have the gene-exon track although the input dataset containing association records.,"PlotGeneTrackWithoutScatterplot( gtf_dsd=FM.GTF_HG19, /*demo for MAP3K19*/ chr=2, minst=135023787, maxend=137000000, dist2genes=0,/*use it get SNPs located beyound the regions with the dist*/ dist2st_and_end=50000,/*to make the gene track to extend the regions beyound the gene st and end*/ design_width=1000, design_height=400, barthickness=15, dotsize=6, min_dist4genes_in_same_grps=0.4, yaxis_offset4min=0.05, /*provide 0-1 value or auto to offset the min of the yaxis*/ yaxis_offset4max=0.05, /*provide 0-1 value or auto or to offset the max of the yaxis*/ xaxis_offset4min=0.02, /*provide 0-1 value or auto to offset the min of the xaxis*/ xaxis_offset4max=0.02 /*provide 0-1 value or auto to offset the max of the xaxis*/ );",
QQplot,COVID19_GWAS_Analyzer,Produce QQ-plot for input p values in a sas dataset.,"QQplot(dsdin,P_var);",
QueryGTEx4GeneID,COVID19_GWAS_Analyzer,Get ensembl gene names for input inquirying gene symbols and create a sas dataset containing these ensembl gene names.,"QueryGTEx4GeneID( geneids=Apobec3a Apobec3b,/*For Apobec3a*/ genomeBuild=hg38,/*hg38, but hg19 is not supported by GTEx*/ outdsd=gene_info );",ntokens
QueryGTExeQTLs4Genesymbol,COVID19_GWAS_Analyzer,"Query cis-eQTLs of a gene symbol in GTEx, which is replaced by more sophiscated macro QueryGTExeQTLs4MultEnsemblGenes, which can handle multiple gene inquires.","QueryGTExeQTLs4Genesymbol( geneids=Apobec3a Apobec3b,/*For Apobec3a*/ outdsd=gene_eqtls );",QueryGTExeQTLs4MultEnsemblGenes ntokens
QueryGTExeQTLs4MultEnsemblGenes,COVID19_GWAS_Analyzer,Query cis-eQTLs of multiple gene symbols in GTEx.,"QueryGTExeQTLs4MultEnsemblGenes( ensembl_gene_ids=ENSG00000128383.12,/*For Apobec3a Apobec3b and others, separated by blank space;*/ outdsd=gene_eqtls );",ntokens
Query_GTEx_eQTLs4Genesymbol,COVID19_GWAS_Analyzer,Query GTEx cis-eQTLs for a ensembl gene id.,"Query_GTEx_eQTLs4Genesymbol( ensembl_gene_id=ENSG00000128383.12,/*For Apobec3a*/ outdsd=gene_eqtls );",
SNP_Local_Manhattan_With_GTF,COVID19_GWAS_Analyzer,Generate a Manhattan plot for input SNP and GWAS.,"SNP_Local_Manhattan_With_GTF(/*As this use other subs, it is not uncommon that some global vars would be in the same name, such as macro vars chr and i, thus, to avoid of crash, chr_var is used instead of macro var chr in this macro*/ gwas_dsd=, chr_var=chr, AssocPVars=pval1 pval2, SNP_IDs=rs370604612 rs2070788 9:5114773, /*if providing chr:pos or chr:st:end, it will query by pos; Please also enlarge the dist2snp to extract the whole gene body and its exons, altought the final plots will be only restricted by the input st and end positions!*/ dist2snp=2000000, /*in bp; left or right size distant to each target SNP for the Manhattan plot*/ SNP_Var=snp, Pos_Var=pos, gtf_dsd=FM.GTF_HG19, ZscoreVars=zscore1 zscore2,/*Can be beta1 beat2 or other numberic vars indicating assoc or other +/- directions*/ gwas_labels_in_order=gwas1 gwas2,/*If providing _ for labeling each GWAS, the _ will be replaced with empty string, which is useful when wanting to remove gwas label if only one scatterplot or the label for a gwas containing spaces; The list will be used to label scatterplots by the sub-macro map_grp_assoc2gene4covidsexgwas*/ design_width=800, design_height=600, barthickness=10, /*gene track bar thinkness*/ dotsize=6, dist2sep_genes=100000,/*Distance to separate close genes into different rows in the gene track; provide negative value to have all genes in a single row in the final gene track*/ where_cndtn_for_gwasdsd=%str(), /*where condition to filter input gwas_dsd*/ shift_text_yval=0.1, /*in terms of gene track labels, add positive or negative vale, ranging from 0 to 1, to liftup or lower text labels on the y axis; the default value is -0.2 to put gene lable under gene tracks; Change it with the macro var pct4neg_y!*/ fig_fmt=png, /*output figure formats: svg, png, jpg, and others*/ pct4neg_y=2, /*the most often used value is 1; compacting the bed track y values by increasing the scatterplot scale, which can reduce the bed trace spaces; It seems that two-fold increasement leads to better ticks for different tracks! Use value >1 will increase the gene tract, while value < 1 will reduce it! Note: when there are only 1 or 2 scatterplots, it is better to provide value = 0.5; Modify this parameter with the parameter shift_text_yval to adjust gene label! Typically, when there are more scatterplots, it is necessary to increase the value of pct4neg_y accordingly; If there are only <4 scatterplots, the value would be usually set as 1 or 2; */ adjval4header=-0.2, /*In terms of header of each subscatterplot, provide postive value to move up scatter group header by the input value*/ makedotheatmap=0,/*use colormap to draw dots in scatterplot instead of the discretemap; Note: if makedotheatmap=1, the scatterplot will not use the discretemap mode based on the negative and postive values of lattice_subgrp_var to color dots in scatterplot*/ color_resp_var=,/*Use value of the var to draw colormap of dots in scatterplot if empty, the default var would be the same as that of yval_var;*/ makeheatmapdotintooneline=0,/*This will make all dots have the same yaxis value but have different colors based on its real value in the heatmap plot; To keep the original dot y axis value, assign 0 to the macro var This would be handy when there are multiple subgrps represented by different y-axis values! By modifying the y-axis values for these subgrps, the macro can plot them separately in each subtrack! */ var4label_scatterplot_dots= ,/*Make sure the variable name is not grp, which is a fixed var used by the macro for other purpose; the variable should contain values of target SNPs and other non-targets are asigned with empty values; Whenever makeheatmapdotintooneline=1 or 0, it is possible to use values of the var4label_scatterplot_dots to label specific scatterplot dots based on the customization of the variable predifined by users for the input data set; default is empty; provide a variable that include non-empty strings for specific dots in the scatterplots;*/ SNPs2label_scatterplot_dots= /*Add multiple SNP rsids to label dots within or at the top of scatterplot Note: if this parameter is provided, it will replace the parameter var4label_scatterplot_dots! */ );",ntokens
UKB_Female_vs_Male_GWAS_GRASP,COVID19_GWAS_Analyzer,"Compare female- and male-stratified UKB COVID-19 GWASs provided by GRASP database, conduct differential effect size, and make Manhattan and QQ plots. Note: this macros can be used to compare any two UKB GWASs from GRASP database.","UKB_Female_vs_Male_GWAS_GRASP( female_gwas_url, male_gwas_url, female_male_gwas_url, outdir=/home/cheng.zhong.shan/my_shared_file_links/cheng.zhong.shan/F_vs_M_Covid19_Hosp, forece=1, label4female_gwas=Female,/*this label will be used to name the first GWAS in the figure and output*/ label4male_gwas=Male,/*this label will be used to name the second GWAS in the figure and output*/ label4f_vs_m=Female_vs_Male, /*this label will be used to name diff_GWAS for the 1st and 2nd GWASs in the figure and output*/ draw_p_axis_by_z_direction=1 /*Draw the log10P value axis on the end-right by +/- direction of its corresponding z-scores*/ );",DiffTwoGWAS Lambda_From_P Import_Space_Separated_File QQplot print_text_as_title zscroe2p get_covid_gwas_from_grasp ImportCovidGWASFromZIP GetZIPContents chr_format_exchanger del_file_with_fullpath dwn_http_file get_top_signal_within_dist local_multigwas_manhattan mkfmt4grps_by_var randombetween ntokens rank4grps map_grp_assoc2gene4covidsexgwas Multgscatter_with_gene_exons needleplot4snpsdiffzscores quotelst
UKB_Female_vs_Male_GWAS_Pipeline,COVID19_GWAS_Analyzer,A wrapper macro to run the macro UKB_Female_vs_Male_GWAS_GRASP and generate local Manhattan plots and effect size needleplots for top hits. Note: this macro is also able to run any two UKB GWASs from GRASP.,"UKB_Female_vs_Male_GWAS_Pipeline( female_gwas_url, male_gwas_url, female_male_gwas_url, outdir=/home/cheng.zhong.shan/my_shared_file_links/cheng.zhong.shan/F_vs_M_Covid19_Hosp, forece=1, label4female_gwas=Female,/*this label will be used to name the first GWAS in the figure and output*/ label4male_gwas=Male,/*this label will be used to name the second GWAS in the figure and output*/ label4f_vs_m=Female_vs_Male, /*this label will be used to name diff_GWAS for the 1st and 2nd GWASs in the figure and output*/ draw_p_axis_by_z_direction=1, /*Draw the log10P value axis on the end-right by +/- direction of its corresponding z-scores*/ From_GRASP_DB=1 /*point out the GWAS urls are from GRASP database; otherwise, it would be from UKB GWAS from Neale lab: http://www.nealelab.is/uk-biobank*/ );",DiffTwoGWAS Lambda_From_P Import_Space_Separated_File QQplot print_text_as_title zscroe2p get_top_signal_within_dist local_multigwas_manhattan mkfmt4grps_by_var randombetween ntokens rank4grps map_grp_assoc2gene4covidsexgwas Multgscatter_with_gene_exons chr_format_exchanger needleplot4snpsdiffzscores quotelst
Zscore4matrix,COVID19_GWAS_Analyzer,Calculate row-wide or column-wide zscore by or not by group.,"Zscore4matrix(dsdin ,rowwide ,ByVar4rowwide ,dsdout );",longdsd2matlabmatrix
beta2OR_forest_plot,COVID19_GWAS_Analyzer,"Based on input beta and se, the macro draws a Odd Ratio forest plot for all records.","Beta2OR_forest_plot( dsdin=, beta_var=, se_var=, sig_p_var=,/*adjust the threshold of p in the extra_condition4updatedsd*/ marker_var=, marker_label=, svgoutname=, extra_condition4updatedsd=%nrstr( length sigtag $10.; if &marker_var=""rs16831827"" then do; grp=0;sigtag=''; end; else if &sig_p_var<5e-8 then do; grp=1;sigtag='*'; end; else do; grp=1;sigtag=""""; end; if &marker_var=""12:113357193:G:A"" then &marker_var=""rs10774671""; if &marker_var=""17:44219831:T:A"" then &marker_var=""rs1819040""; if &marker_var=""19:10427721:T:A"" then &marker_var=""rs74956615""; if &marker_var in ('rs2271616','rs11919389','rs912805253','rs4801778') then grp=0; else if &marker_var='rs16831827' then grp=1; else grp=2; ) );",
calc_pairwise_LD_among_1KG_pops,COVID19_GWAS_Analyzer,Caculate pairwise LD for two SNPs based on 1KG phase3 data of multiple populations provided by ensembl database.,"calc_pairwise_LD_among_1KG_pops( snp1=, snp2=, outdsd=out, pop=GBR /*Provide one population of the 1000 Genome phase 3 populations: CHB, CEU, ...; if empty, it will query all populations and calcuate pairwise LD;*/ );",
deseq_normalization,COVID19_GWAS_Analyzer,RNAseq read normation with DESeq method.,"deseq_normalization( dsdin,/*Note: to save space, the input dsd will be replace*/ read_vars, dsdout, readcutoff=3, cellcutoff=5 );",delete_sas_dsd deseq_normalization4longdsd rename_sas_dsd squeez_single_num_var_length
deseq_normalization4longdsd,COVID19_GWAS_Analyzer,"RNAseq read normation with DESeq method, specifically designed for a longform input sas dataset.","deseq_normalization4longdsd( indsd=a, outdsd=z, key4row=r, key4col=c, val_var=val );",
deseq_normalization_old,COVID19_GWAS_Analyzer,Another older version of the macro deseq normalization.,"deseq_normalization_old( dsdin, read_vars, dsdout, readcutoff=3, cellcutoff=5 );",
deseq_normalization_slow,COVID19_GWAS_Analyzer,A slower version of the macro deseq normalization using proc sql.,"deseq_normalization_slow( dsdin, read_vars, dsdout, readcutoff=3, cellcutoff=5 );",delmacrovars getnumorcharvars4dsd ntokens
get_HGI_R7_GWAS,COVID19_GWAS_Analyzer,"A wrapper to download and import compressed HGI release 7 GWAS summary statistics into sas by only providing the HGI_R7 GWAS names by phenotype and population. Note: it can process GWAS data across multiple populations for different COVID-19 phenotypes, such as B1_ALL, B2_ALL, C2_ALL, B2_AFR, B2_EAS, B2_SAS, B2_HIS; A2_HIS, C2_HIS and B2_HIS tar gz file were broken! No A1_ALL is from HGI_R7 GWAS.","get_HGI_R7_GWAS( gwas_name=, /*such as B1_ALL, B2_ALL, and C2_ALL; furthermore, except B1, all others have subpopulation GWASs, such as B2_AFR, B2_EAS, B2_SAS, B2_HIS; Note: A2_HIS, C2_HIS and B2_HIS tar gz file was broken! No A1_ALL */ hgi_gwas=hgi_gwas_out /*sas dsd output*/ );",ImportFileHeadersFromZIP FileOrDirExist GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath check_header_and_values delete_file_or_dir_with_fullpath dwn_http_file
get_HGI_covid_gwas_from_HGI,COVID19_GWAS_Analyzer,Get HGI COVID-19 GWAS summary statistics (release 7) from HGI based on GWAS download url.,"get_HGI_covid_gwas_from_HGI( gwas_url, outdsd, for_subpop=0 /*R7 GWAS for ALL and sub-populations are in different format*/ );",ImportHGICovidGWASFromHGI_R7 GetZIPContents del_file_with_fullpath dwn_http_file
get_HGI_covid_gwas_from_grasp,COVID19_GWAS_Analyzer,Get HGI COVID-19 GWAS summary statistics (release 7) from GRASP based on GWAS download url. Note: these HGI COVID GWAS summary statistics are the early release of HGI (release version < 5).,"get_HGI_covid_gwas_from_grasp(gwas_url,outdsd);",ImportHGICovidGWASFromZIP GetZIPContents chr_format_exchanger del_file_with_fullpath UncompressGZWith7ZInWindows Run_7Zip chdir direxist dwn_http_file
get_UKB_gwas_from_UKB,COVID19_GWAS_Analyzer,Get UKB GWASs released by Neale's lab based on GWAS url.,"get_UKB_gwas_from_UKB(gwas_url,outdsd);",Import_UKB_GWAS ImportFileHeadersFromZIP FileOrDirExist GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath chr_format_exchanger dwn_http_file
get_UKB_gwas_from_UKB_old,COVID19_GWAS_Analyzer,"This a older version of the macro get_UKB_gwas_from_UKB, just for backup purpose.","get_UKB_gwas_from_UKB_old(gwas_url,outdsd);",Import_UKB_GWAS ImportFileHeadersFromZIP FileOrDirExist GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath chr_format_exchanger dwn_http_file
get_covid_gwas_from_grasp,COVID19_GWAS_Analyzer,Imoort plain or compressed GRASP COVID-19 GWAS summary statistics via a web http link.,"get_covid_gwas_from_grasp(gwas_url,outdsd);",ImportCovidGWASFromZIP GetZIPContents chr_format_exchanger del_file_with_fullpath dwn_http_file
get_genecode_gtf_data,COVID19_GWAS_Analyzer,"Import gencode GTF file from compressed gz file into a sas dataset, which is in a typical bed format.","get_genecode_gtf_data(gtf_gz_url,outdsd);",ImportGendcodeGTFFromZIP GetZIPContents chr_format_exchanger del_file_with_fullpath dwn_http_file
get_sc_read_geomean_and_readsum,COVID19_GWAS_Analyzer,Read a single cell matrix filehandle generated by the filename statement and calculate read geomean and total reads for each single cell.,"get_sc_read_geomean_and_readsum( filename_ref_handle, /*filename handle, and all character columns should be put at the beginning of the table!*/ total_num_vars, /*total number of numeric vars in the opened file handle*/ macro_prefix4NumVarSum, /*macro prefix used to generate macro vars for var sums*/ firstobs=2, /*escape header or not*/ first_input4charvars=rownames tissue, /*provide all character vars located at the beginning of the table*/ macro_prefix4CharVarLen=CharVarLen, dlm='09'x /*if providing other non-SAS dlm, quote it*/ );",ntokens
get_sigs_from_hgi_r7_by_chrpos,COVID19_GWAS_Analyzer,Get association signals among selected HGI release 7 GWAS summary statistics based on a query genomic region.,"get_sigs_from_hgi_r7_by_chrpos( gwas_names=A1_ALL B1_ALL, chrpos_or_rsids=%str(chr1:10000-20000000), dsdout=combined_signals );",Union_Data_In_Lib_Rgx Make_NoQuote_Var_List_From_Dsd union_add_tags get_HGI_R7_GWAS ImportFileHeadersFromZIP FileOrDirExist GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath check_header_and_values delete_file_or_dir_with_fullpath dwn_http_file
get_top_signal_within_dist,COVID19_GWAS_Analyzer,Get the top association signal from a genomic region based on a GWAS dataset.,"get_top_signal_within_dist( dsdin=, grp_var=, signal_var=, select_smallest_signal=1, pos_var=, pos_dist_thrshd=, dsdout=, signal_thrshd=1e-4 /*filter the input dsdin by &signal_val <= &signal_thrshd*/ );",
gscatter_over_bed_track,COVID19_GWAS_Analyzer,Make scatter plots by group and add genomic region bed tracks at the bottom of scatter plots.,"gscatter_over_bed_track( bed_dsd, chr_var, st_var, end_var, grp_var, scatter_grp_var, yval_var, yaxis_label=Group, linethickness=20, track_width=800, track_height=400, dist2st_and_end=0, dotsize=10 );",delete_empty_dsd iscolallmissing number_rows_by_grp
gscatter_with_gene_exons4dsd,COVID19_GWAS_Analyzer,Make scatter plots for association signals and add gene-exon bed tracks at the bottom of these scatter plots.,"gscatter_with_gene_exons4dsd( bed_dsd=, yval_var=, scatter_grp_var=, gene_exon_bed_dsd=, dist2st_and_end=50000, design_width=1000, design_height=200, barthickness=20);",chr_format_exchanger
gwas_manhattan_pipeline,COVID19_GWAS_Analyzer,"Generate GWAS Manhattan plot and QQ-plot, and calculate inflation labmda.","gwas_manhattan_pipeline( GWAS_File, Marker_Col_Name, Marker_Pos_Col_Name, Xaxis_Col_Name, Yaxis_Col_Name, Marker_X_Xpos_Y_ColNums, GWAS_dsdout, gwas_thrsd, OutDir, Replace_Previous_Rst=1, Numeric_Xaxis_Col=1 );",list_files4dsd del_file_with_fullpath list_files number_rows_by_grp
gwas_top_hits_manhattan,COVID19_GWAS_Analyzer,Draw local Manhattan plots for all top hits in a GWAS.,"gwas_top_hits_manhattan( GWAS_File=, Marker_Col_Name=, Marker_Pos_Col_Name=, Xaxis_Col_Name=, Yaxis_Col_Name=, Marker_X_Xpos_Y_ColNums=, GWAS_dsdout=, gwas_thrsd=, Mb_SNPs_Nearby=,/*this Mb_factor will multiple 1,000,000 when running in the program*/ OutDir= );",
importallmacros_ue,COVID19_GWAS_Analyzer,Import all macros in SAS OnDemand for Academics.,"importals_ueDir=%sysfunc(pathname(HOME))s,fileRgx=.sas,verbose=0); %put Macro Dir is &MacroDir; %put Your system is &sysscp; %let ndirs=%sysfunc(countc(&MacroDir,' '))+1; %do di=1 %to &ndirs; %let _Macrodir=%scan(&MacroDir,&di,' ');",listfiles2dsdInUE del_file_with_fullpath list_files
include_macros_from_github,COVID19_GWAS_Analyzer,Import all macros from a github link that contains sas macros. This macro would be helpful when the sas macros are not saved locally but stored in a github directory.,includes_from_github( macros=importallmacros_ue /*supply multiple macro names separated by blank space*/ );,
listfiles2dsdInUE,COVID19_GWAS_Analyzer,Recursively search files included in a directory and its subdirectories and tailored for SAS OnDemand for Academics.,"listfiles2dsdInUE(dir,filergx,outdsd);",del_file_with_fullpath list_files
local_gwas_hits_and_nearby_sigs,COVID19_GWAS_Analyzer,Make local Manhattan plots for top GWAS SNPs or target SNPs in a single GWAS.,"local_gwas_hits_and_nearby_sigs( /*Note: this macro is only works for top GWAS hits with p < 1e-6, as it requires to have the top independent SNPs as input for the var snps; However, there are still bugs as the output figure is abnormal for the center marker of the topest snp; somethings are wrong with this macro! */ GWAS_SAS_DSD=, Marker_Col_Name=, Marker_Pos_Col_Name=, Xaxis_Col_Name=, Yaxis_Col_Name=, GWAS_dsdout=, gwas_thrsd=, /*-log10(P) threshold, such as 5*/ Mb_SNPs_Nearby=,/*this Mb_factor will multiple 1,000,000 when running in the program*/ snps=, /*Multiple top independent SNPs separated by space*/ design_width=1000, design_height=200, col_or_row_lattice=1, /*Plot each subplot in a single column or row: 1: columnlattice; 0: rowlattice*/ uniscale4lattice=ALL, /*Default is ALL to make all axis in the same format; Alternative values are as follows: column: make column-wide xaxis the same if set col_or_row_lattice=1; row: make row-wide yaxis the same, which is for col_or_row_lattice=0;*/ outputfmt=gif /*Output figure format, such as svg, jpg,gif, and others*/ );",ntokens totobsindsd
local_multigwas_manhattan,COVID19_GWAS_Analyzer,Make local Manhattan plots for SNPs across multiple GWASs. Note: this macro will not draw gene tracks along with local Manhattan plots.,"local_multigwas_manhattan( GWAS_SAS_DSD=, Marker_Col_Name=, Marker_Pos_Col_Name=, Xaxis_Col_Name=, Yaxis_Col_Names=, /*Support multiple p-val vars*/ GWAS_dsdout=, gwas_thrsd=, /*-log10(P) threshold, such as 5*/ Mb_SNPs_Nearby=,/*this Mb_factor will multiple 1,000,000 when running in the program*/ snps=, design_width=1000, design_height=200, Labels4gwas_grps=,/*Supply labels for the Yaxis_Col_Names in the final lattice plot, ensuring the same order and no blank spaces are allowed!*/ );",mkfmt4grps_by_var randombetween ntokens rank4grps
macroparas,COVID19_GWAS_Analyzer,Get macros matching with a regular expression and print the macro and its parameters.,"macroparas( macrorgx=., dir=%sysfunc(pathname(HOME))/Macros H:\F_Queens\360yunpan\SASCodesLibrary\SAS-Useful-Codes\Macros ~/shared/Macros /home/zcheng/SAS-Useful-Codes/Macros F:/360yunpan/SASCodesLibrary/SAS-Useful-Codes/Macros /home/zhongshan/SAS-Useful-Codes/Macros , verbose=0, IsSASOnDemand=0, numlines2print=10000, output_macropara_dsd=Macro_paras, print_outdsd=0 );",FileOrDirExist list_files4dsd del_file_with_fullpath list_files
make_fake_axis4NegPosVal_by_grps,COVID19_GWAS_Analyzer,"Adjust nagetive values (not including 0) and exclude positive values by creating fake positional values for them based on their group membership, resulting in these values were separated into different sections and can be applied for generating gene tracks at the bottom of scatter plots for positive values.","make_fake_axis4NegPosVal_by_grps( dsdin, axis_var,/*Both negative and positive values of axis var are allowed to use this macro, but in each group, only positve (>0) or negative (<0) values are allowed, and all 0 axis var values will be excluded from the dsdin, the above of which are the limitations of the macro!*/ axis_grp, new_fake_axis_var, dsdout, yaxis_macro_labels=ylabelsmacro_var, fc2scale_pos_vals=1 /*Use this fc to enlarge the proportion of positive values in the plots It seems that fc=2 is the best for the final ticks of different tracks;*/ );",add_fake_pos_by_grp4nonnegvars totobsindsd
make_fake_axis_values4grps,COVID19_GWAS_Analyzer,Make fake values by group for drawing stacked scatter plots.,"make_fake_axis_values4grps( dsdin, axis_var, axis_grp, new_fake_axis_var, dsdout, yaxis_macro_labels=ylabelsmacro_var, fc2scale_pos_vals=2 /*Use this fc to enlarge the proportion of positive values in the plots It seems that fc=2 is the best for the final ticks of different tracks; */ );",
make_fake_axis_values4grps1,COVID19_GWAS_Analyzer,A older version of the macro for making fake values by group for drawing stacked scatter plots.,"make_fake_axis_values4grps1( dsdin, axis_var, axis_grp, new_fake_axis_var, dsdout, yaxis_macro_labels=ylabelsmacro_var );",
make_fake_axis_values4grps_new,COVID19_GWAS_Analyzer,A newer version of the macro for making fake values by group for drawing stacked scatter plots. Note: this macro is just for learning purpose.,"make_fake_axis_values4grps_new( dsdin, axis_var, axis_grp, new_fake_axis_var, dsdout, yaxis_macro_labels=ylabelsmacro_var );",
make_fake_axis_values4grps_old,COVID19_GWAS_Analyzer,A older version of the macro for making fake values by group for drawing stacked scatter plots. Note: this macro is just for learning purpose.,"make_fake_axis_values4grps_old( dsdin, axis_var, axis_grp, new_fake_axis_var, dsdout, yaxis_macro_labels=ylabelsmacro_var );",
map_assoc2gene4covid19,COVID19_GWAS_Analyzer,An older internal macro used by other macros of COVID19_GWAS_Analyzer to map association singals with gene-exon bed regions for COVID-19 GWAS visualization. Just for backup and learning purpose.,"map_assoc2gene4covid19( gwas_dsd=FM.f_vs_m_mixedpop, gtf_dsd=FM.GTF_HG19, chr=, min_st=, max_end=, AssocP=pval );",plot_scatter_with_gene_exons4dsd chr_format_exchanger
map_assoc2gene4covidsexgwas,COVID19_GWAS_Analyzer,An updated internal macro used by other macros of COVID19_GWAS_Analyzer to map association singals with gene-exon bed regions for COVID-19 GWAS visualization.,"map_assoc2gene4covidsexgwas( gwas_dsd=FM.f_vs_m_mixedpop, gtf_dsd=FM.GTF_HG19, chr=, min_st=, max_end=, AssocPVars=pval gwas1_p gwas2_p, ZscoreVars=diff_zscore gwas1_z gwas2_z );",Multgscatter_with_gene_exons4dsd chr_format_exchanger
map_grp_assoc2gene4covid19,COVID19_GWAS_Analyzer,An older internal macro used by other macros of COVID19_GWAS_Analyzer to map association singals by group with gene-exon bed regions for COVID-19 GWAS visualization. Just for backup and learning purpose.,"map_grp_assoc2gene4covid19( gwas_dsd=FM.f_vs_m_mixedpop, gtf_dsd=FM.GTF_HG19, chr=, min_st=, max_end=, AssocP=pval, AssocGrp=, );",gscatter_with_gene_exons4dsd chr_format_exchanger
map_grp_assoc2gene4covidsexgwas,COVID19_GWAS_Analyzer,An updated internal macro used by other macros of COVID19_GWAS_Analyzer to map association singals by group with gene-exon bed regions for COVID-19 GWAS visualization.,"map_grp_assoc2gene4covidsexgwas( gwas_dsd=FM.f_vs_m_mixedpop,/*Requires to have the arbitary var chr in the input gwas dsd*/ gtf_dsd=FM.GTF_HG19,/*Need to use sas macro import gtf to save GTF_HG19; these vars are arbitrary, such as chr, st, end, protein_coding (1 or 0) and type of bed region (gene or exon);*/ chr=, min_st=, max_end=, dist2genes=100000, AssocPVars=pval gwas1_p gwas2_p, ZscoreVars=diff_zscore gwas1_z gwas2_z, design_width=800,/*Width*height=800*800 would be the best for publication*/ design_height=800, barthickness=8, dotsize=6, dist2sep_genes=0.3, /* this will ensure these genes close to each other to be separated in the final gene track; (1) give 0 to plot ALL genes in the same line; (2) give value between 0 and 1 to separate genes based on the pct distance to the whole region; (3) give value > 1 to use absolute distance to separate genes into different groups; Customize this for different gene exon track! */ where_cndtn_for_gwasdsd=%str() /*add filters to the input gwas_dsd; such as pval < 0.05 or gwas1_p < 0.05 or gwas2_p < 0.05*/, shift_text_yval=-0.2, /*in terms of gene track labels, add positive or negative vale, ranging from 0 to 1, to liftup or lower text labels on the y axis; the default value is -0.2 to put gene lable under gene tracks; Change it with the macro var pct4neg_y!*/ fig_fmt=svg, /*output figure formats: svg, png, jpg, and others*/ pct4neg_y=2, /*the most often used value is 1; compacting the bed track y values by increasing the scatterplot scale, which can reduce the bed trace spaces; It seems that two-fold increasement leads to better ticks for different tracks! Use value >1 will increase the gene tract, while value < 1 will reduce it! Note: when there are only 1 or 2 scatterplots, it is better to provide value = 0.5; Modify this parameter with the parameter shift_text_yval to adjust gene label! Typically, when there are more scatterplots, it is necessary to increase the value of pct4neg_y accordingly; If there are only <4 scatterplots, the value would be usually set as 1 or 2; */ adjval4header=-0.5, /*In terms of header of each subscatterplot, provide postive value to move up scatter group header by the input value*/ gwas_pos_var=pos, gwas_labels_in_order=gwas1_vs_gwas2 gwas1 gwas2, /*Provide gwas names matched with the numeric scatter_grp_var Use _ to represent blank space in each name, and these _ will be changed back into blank space!*/ makedotheatmap=0,/*use colormap to draw dots in scatterplot instead of the discretemap; Note: if makedotheatmap=1, the scatterplot will not use the discretemap mode based on the negative and postive values of lattice_subgrp_var to color dots in scatterplot*/ color_resp_var=,/*Use value of the var to draw colormap of dots in scatterplot if empty, the default var would be the same as that of yval_var;*/ makeheatmapdotintooneline=0,/*This will make all dots have the same yaxis value but have different colors based on its real value in the heatmap plot; To keep the original dot y axis value, assign 0 to the macro var This would be handy when there are multiple subgrps represented by different y-axis values! By modifying the y-axis values for these subgrps, the macro can plot them separately in each subtrack! */ var4label_scatterplot_dots= /*Make sure the variable name is not grp, which is a fixed var used by the macro for other purpose; Whenever makeheatmapdotintooneline=1 or 0, it is possible to use values of the var4label_scatterplot_dots to label specific scatterplot dots based on the customization of the variable predifined by users for the input data set; default is empty; provide a variable that include non-empty strings for specific dots in the scatterplots;*/ );",Multgscatter_with_gene_exons chr_format_exchanger ntokens
needleplot4snpsdiffzscores,COVID19_GWAS_Analyzer,"Customized needle plots for displaying effect sizes of SNPs from two studies, as well as its corresponding differential effect size.","needleplot4snpsdiffzscores( diffzscore_gwas, gwas1_z, gwas2_z, snp_var, snps, diffzscore_p_var, gwas1pvar, gwas2pvar, fig_height=400, fig_width=600, NotDrawBubbleBySize=0, /*Draw common bubble plot with the same size of bubbles*/ transparency4needles=0.6, keep_snp_order4xaxis=0, draw_p_axis_by_z_direction=1, /*Draw the log10P value axis on the end-right by +/- direction of its corresponding z-scores*/ bubble_transparency=0.1, xaxisfontsize=10, maxbublesize=10 /*restricted the largest size for -log10P in pixel*/ );",quotelst rank4grps
nums_in_range_adj_scale,COVID19_GWAS_Analyzer,"Similar to the macro nums_in_range, but is able to multiple each element by a scale factor.","nums_in_range_adj_scale( st, end, by, outmacrovar, filter4scaledvals=%str(>0), scale=2, quote=1 );",
nums_in_range_adj_scale,COVID19_GWAS_Analyzer,"Similar to the macro nums_in_range, but is able to multiple each element by a scale factor.","nums_in_range_adj_scale( st,/*start value that can be negative and position*/ end,/*end value*/ by,/*by value for each step; make sure it is matchable with st and end values*/ outmacrovar,/*created a global macro var containing linked nums by space for later access*/ filter4scaledvals=%str(>0),/*Only apply the scaling to specific numbers met the filter*/ scale=2,/*integer num to scale down the nums, i.e., num/scale, that will be in the final macro var*/ quote=1 /*quote the nums and separated by space in the final macro var*/ );",
plot_bed_regs_with_gene_exons,COVID19_GWAS_Analyzer,Plot bed regions with supplied gene-exon bed regions. Note: the gene_exon information is from a bed file.,"plot_bed_regs_with_gene_exons( bed_dsd=, gene_exon_bed_file=, dist2st_and_end=50000, design_width=1000, design_height=200, barthickness=20);",chr_format_exchanger
plot_bed_with_gene_exons4dsd,COVID19_GWAS_Analyzer,Plot bed regions with supplied gene-exon bed regions. Note: the gene_exon information is from a sas bed dataset.,"plot_bed_with_gene_exons4dsd( bed_dsd=, gene_exon_bed_dsd=, dist2st_and_end=50000, design_width=1000, design_height=200, barthickness=20);",chr_format_exchanger
plot_scatter_with_gene_exons4dsd,COVID19_GWAS_Analyzer,Plot scatter pltos upper of gene-exon tracks that are based on supplied gene-exon bed regions. Note: the gene_exon information is from a sas bed dataset.,"plot_scatter_with_gene_exons4dsd( bed_dsd=, yval_var=, gene_exon_bed_dsd=, dist2st_and_end=50000, design_width=1000, design_height=200, barthickness=20);",chr_format_exchanger
query_LD_SNPs_among_1KG_pops,COVID19_GWAS_Analyzer,Query SNPs linked with a query SNPs in the 1KG data stored in the ensembl database.,"query_LD_SNPs_among_1KG_pops( /*https://rest.ensembl.org/documentation/info/ld_id_get Computes and returns LD values between the given variant and all other variants in a window centered around the given variant. The window size is set to 500 kb.*/ snp=rs17425819, outdsd=out, pop=GBR /*Provide one population of the 1000 Genome phase 3 populations: CHB, CEU, ...; Can not be empty!*/ );",
random_subset_cols4dsd,COVID19_GWAS_Analyzer,"This macro aims to select random columns and several fixed columns in a table. Note: it can be used to sub-sampling single cell data, as the single cell level expression data is saved in column-wide and one column contains the genesymbol for these single cell expression data.","random_subset_cols4dsd( dsdin, rgx2matchcols, rgx2fixedcols, rnd_pct, dsdout );",
sc_freq_boxplot,COVID19_GWAS_Analyzer,Calcuate the percentages of different single cell types and draw boxplots for the descriptic summary statistics.,"sc_freq_boxplot( /*Note: the macro also perform gene expression differential expression analysis!;*/ longformdsd, cell_type_var= ,/*It will be used for lattice boxplot headernames*/ sample_grp_var= ,/*This will be used to generate sample level cell expression statistics*/ pheno_var= , /*Pheno var will be used as categories for boxplot*/ cust_pheno_order=, /*User supplied phenos in rank, and the order will be applied to boxplot categories*/ exp_var= , exp_cutoff=0, boxplot_height=300, boxplot_width=800, boxplot_nrows=4, where_cnd_for_sgplot=%quote( ), frqout=frqout, other_glm_classes=, aggre_sc_glm_pdiff_dsd=all_sc, /*provide a prefix to name the results generated by performing glm lsmean by single cell type for gene exp across different cell types*/ /*Perform sample level exp analysis: -1: no single cell level and sample level; 1: yes for sample leve only; 0: yes only for single cell level 2: both at single cell and sample level; Note: median will be used to calculate sample leve expression; */ sample_level_exp_analysis=2 );",mkfmt4grps_by_var randombetween ntokens rank4grps sc_scatter4gene mkfmt4grpsindsd
sc_glm4genes,COVID19_GWAS_Analyzer,"Perform single cell differential gene expression analysis based on the log2 normalized reads with a linear model, which is similar to the traditional T-Test.","sc_glm4genes( /*Note: sc_freq_boxplot also perform DEG analysis, which is better than this macro However, this macro can be used for GTEx DEG analysis between sex or ancestry, such as between AA and EA, if these grp information is added into the umap dataset manually! */ dsd, dsd_headers, dsd_umap, genes, GLMStatOutDsd, GLM_classes=sex medication severity, GLM_model=severity sex age medication, samplewide=1, sample_var=sample, pheno_var=severity, where_condition= );",quotelst rank4grps
sc_scatter4gene,COVID19_GWAS_Analyzer,Make single cell umap scatter plot for a gene.,"sc_scatter4gene( dsd=, dsd_headers=, dsd_umap=, gene=, cell_type_var=cluster, pheno_var=, pheno_categories=, grpvar4boxplot=,/*separate umap and boxplot by pheno_var and grpvar*/ samplewide=0, sample_var=sample, boxplot_width=1000, boxplot_height=600, umap_width=1000, umap_height=500, umap_lattice_nrows=1, boxplot_nrows=3, where_cnd4sgplot=, rgx2cells_not_matched_as_other= /*the rgx will be put inside: not prxmatch function*/ );",mkfmt4grpsindsd mkfmt4grps_by_var randombetween ntokens
sc_scatter4genebygrp,COVID19_GWAS_Analyzer,Make single cell umap scatter plots stached by group for a gene.,"sc_scatter4genebygrp( dsd=, dsd_headers=, dsd_umap=, gene=, pheno_var=, pheno_categories=, grpvar4boxplot=, samplewide=1, sample_var=sample, boxplot_width=1000, boxplot_height=600, boxplot_nrows=3 );",mkfmt4grpsindsd mkfmt4grps_by_var randombetween ntokens
sc_umap,COVID19_GWAS_Analyzer,Generate a scatter plot for illustrating single cell types for umap data.,"sc_umap( umap_ds=umap, xvar=x, yvar=y, cluster_var=cluster, sample_grp_var=, ordered_sample_grps=,/*Provide ordered group names here to generate subplots in the same order as in this macro var*/ down_sampling_num=1,/* Provide pct value ranging from 0 to 1 or number of cells to get random cells for down-sampling*/ fig_width=1400, fig_height=800, rowaxis_min=0, rowaxis_max=, colaxis_min=, colaxis_max=, where_condition4cells=%nrstr(), /*Add where condition to filter cell types*/ marker_size=2,/*scatter plot marker size; the smaller the better for large sc dataset*/ cell_label_size=12, /*text label font size for cell labels*/ fig_column_num4sample_grps=1 /*this value will be assigned to the columns in proc sgpanel; when columns=1, the umaps for different sample groups will be put into a single column; when columns=total_number_of_grps, the umaps will be put into a single row; when columns (1,total_nummber_of_grps), the umaps will be put by columns and rows one by one!*/ );",mkfmt4grpsindsd mkfmt4grps_by_var randombetween rank4grps
sexdiffgwaspipeline,COVID19_GWAS_Analyzer,"Perform sex-biased association analysis for UKB GWASs stratificed by sex. Note: the two GWAS files should be uncompressed files, and the macro will replace the X chromsome label as 23. Differential analysis for effect sizes of each SNP will be conducted, and GWAS Manhattan plot and QQ plot will be produced.","sexdiffgwaspipeline( male_gwas=, female_gwas=, snp_varname=SNP, chr_varname=chr, pos_varname=BP, beta_varname=beta, se_varname=se, p_varname=P, Allele1_varname=A1, Allele2_varname=A2, MAF_varname=AF_Allele2, MAFcutoff=0.05, gwasout=out);",ImportFilebyScan Lambda_From_P Import_Space_Separated_File QQplot char2num_dsd del_file_with_fullpath replacestrinfile zscroe2p
top_gwas_hits_and_nearby_sigs,COVID19_GWAS_Analyzer,Draw local Manhattan plots for all top hits in a GWAS.,"top_gwas_hits_and_nearby_sigs( GWAS_SAS_DSD=, Marker_Col_Name=, Marker_Pos_Col_Name=, Xaxis_Col_Name=, Yaxis_Col_Name=, GWAS_dsdout=, gwas_thrsd=, /*-log10(P) threshold, such as 5*/ Mb_SNPs_Nearby=,/*this Mb_factor will multiple 1,000,000 when running in the program*/ design_width=1000, design_height=200 );",
ucsc_cell_matrix2longdsdBAD,COVID19_GWAS_Analyzer,An older version of import ucsc cell browser provided single cell matrix data into a sas dataset. Just for backup and learning purpose.,"ucsc_cell_matrix2longdsdBAD( gzfile_or_url, dsdout );",ImportFileHeadersFromZIP FileOrDirExist GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath
ucsc_cell_matrix2longformatdsd,COVID19_GWAS_Analyzer,Import ucsc cell browser provided single cell matrix into a longformat sas dataset. Note: it can be applied to similar single cell matrix data.,"ucsc_cell_matrix2longformatdsd( gzfile_or_url, dsdout4headers, dsdout4data );",ImportFileHeadersFromZIP FileOrDirExist GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath get_numeric_table_vars_length ntokens
ucsc_cell_matrix2wideformatdsd,COVID19_GWAS_Analyzer,Import ucsc cell browser provided single cell matrix into a wideformat sas dataset. Note: it can be applied to similar single cell matrix data.,"ucsc_cell_matrix2wideformatdsd( /*Note: this macro can also import large table with 1st column is gene and others for sample exp!*/ gzfile_or_url, dsdout4headers, dsdout4data, extra_cmd4infile=,/*It is better to nrbquote it in cases of containing square or dobule/single quotes, as the macro importfileHeadersFromZIP will use unquote to get back its value!*/ dlm='09'x, guess_numeric_var_length=1 /*Scan whole file to guess the largest length of numberic var; if not guess numeric var length, the max length for numeric var will be set as 8.*/ );",ImportFileHeadersFromZIP FileOrDirExist GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath get_numeric_table_vars_length ntokens
ucsc_cell_mtx2iml,COVID19_GWAS_Analyzer,Import ucsc cell browser provided spare cell matrix in mtx format into sas iml.,"ucsc_cell_mtx2iml( /*This macro can import data from url, downloaded gz file, or even plain files*/ mtx_gzfile_or_url=matrix.mtx.gz,/*Important: Input fullpath or url for these 3 input files*/ feat_gzfile_or_url=features.tsv.gz, barcode_gzfile_or_url=barcodes.tsv.gz, dsdout4headers=header, dsdout4data=exp, startlinenum=4,/*First record that is not the header or other annotaitons in the mtx file*/ endlinenum=5000,/*The line position number to stop the reading of data; For testing, set it as 5000; please enlarge it for real large dataset; To prevent SAS out of space in SAS OnDemand for Academics, it will read 5000000 records; You can change the startlinenum by a step of 5,000,000 and update the endlinenum accordingly*/ output_adj_endlinenum_var=adj_endlinenum,/*The value is fixed, do not change it into other strings*/ OnSASOnDemand=1,/*if it is true, it will use gzip funciton but not the linux zcat*/ use_zcat=0, /*For HPC Linux system, asign value 1 indicating to use zcat; The macro will first check whether it is running with SAS OnDemand for Academics, if it is, it will change back the use_zcat as 0!*/ Readcutoff=3,/*It works with NumOfCells with expression reads greater or equal to this cutoff, i.e., Readcutoff >= 0*/ NumOfCells=500, /*Filter out cells with non-zeor values, i.e., NumOfCells >= 0*/ meancutoff=0.001, /*Filter out cells with too low expression, i.e., meancutoff >= 0*/ subset_by_genes= /*Provide gene symbols to only extract subset data for the dsdout4data; This would be helpful when the matrix is too large to be imported into SAS*/ );",QueryGTEx4GeneID ntokens UncompressGZWith7ZInWindows Run_7Zip chdir direxist
ucsc_cell_mtx2wideformatdsd,COVID19_GWAS_Analyzer,Import ucsc cell browser provided spare cell matrix in mtx format into a sas dataset. Note: simiar format matrix file can be imported into sas using the same macro.,"ucsc_cell_mtx2wideformatdsd( /*This macro can import data from url, downloaded gz file, or even plain files*/ mtx_gzfile_or_url=matrix.mtx.gz,/*Important: Input fullpath or url for these 3 input files*/ feat_gzfile_or_url=features.tsv.gz, barcode_gzfile_or_url=barcodes.tsv.gz, dsdout4headers=header, dsdout4data=exp, extra_cmd4infile=, OnSASOnDemand=1,/*if it is true, it will use gzip funciton but not the linux zcat*/ use_zcat=0, /*For HPC Linux system, asign value 1 indicating to use zcat; The macro will first check whether it is running with SAS OnDemand for Academics, if it is, it will change back the use_zcat as 0!*/ Readcutoff=0,/*It works with NumOfCells with expression reads greater or equal to this cutoff, i.e., Readcutoff >= 0*/ NumOfCells=0, /*Filter out cells with non-zeor values, i.e., NumOfCells >= 0*/ meancutoff=0, /*Filter out cells with too low expression, i.e., meancutoff >= 0*/ subset_by_genes= /*Provide gene symbols to only extract subset data for the dsdout4data; This would be helpful when the matrix is too large to be imported into SAS*/ );",QueryGTEx4GeneID ntokens UncompressGZWith7ZInWindows Run_7Zip chdir direxist
ucsc_sc_analysis_pipeline,COVID19_GWAS_Analyzer,A wrapper macro to analyze usce cell browser provided single cell matrix. This macro is not updated and only used for learning purpose.,"ucsc_sc_analysis_pipeline( remove_pre_sc_sas_dsds=0, /*provide 1 to remove all previous sc datasets, such as exp, headers, umap*/ sc_lib_path=/home/cheng.zhong.shan/data, umap_http_link=https://cells.ucsc.edu/covid-hypertension/Seurat_umap.coords.tsv.gz, exprMatrix_http_link=https://cells.ucsc.edu/covid-hypertension/exprMatrix.tsv.gz, meta_http_link=https://cells.ucsc.edu/covid-hypertension/meta.tsv, cellid_in_meta_tsv=cellid, /*this should be the first column name from the meta tsv; it is variable from difference sc meta tsv, such as cellid or cell;*/ pheno_var=disease, ordered_pheno_categories=healthy COVID19, cell_type_var=cluster, grpvar4boxplot=, tgt_genes_in_order=SPEG CD55, rgx4_not_matched_cells_as_others=cardiomyocyte, /*for umap scatterplot and aggregrated sc boxplot*/ samplewide=0, sample_var=, AllCellsboxplot_width=300, AllCellsboxplot_height=800, umap_width=1000, umap_height=400, umap_lattice_nrows=1, AllCellsboxplot_nrows=5, /*for sc percent visualization*/ frqboxplot_height=800, frqboxplot_width=300, frqboxplot_nrows=2, frqwhere_cnd_for_sgplot=%quote(), other_glm_classes=sex, /*UMAP by pheno with text label setting*/ alt_umap_cell_height=400, alt_umap_total_width=800, /*UMAP for all single cells setting*/ umap4all_cells_height=800, umap4all_cells_width=800, /*Perform sample level exp analysis: -1: no single cell level and sample level; 1: yes for sample leve only; 0: yes only for single cell level 2: both at single cell and sample level; Note: median will be used to calculate sample leve expression; */ sample_level_exp_analysis=1 );",FileOrDirExist ImportFileHeadersFromZIP GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath add_symbol4grp_in_dsd chk_sas_dsd deseq_normalization delete_sas_dsd deseq_normalization4longdsd rename_sas_dsd squeez_single_num_var_length groupsummary mkfmt4grpsindsd mkfmt4grps_by_var randombetween ntokens rank4grps sc_scatter4gene ucsc_cell_matrix2wideformatdsd ImportFileHeadersFromZI
umap_with_axes_restriction,COVID19_GWAS_Analyzer,Generate scatter plots with restricted axes for umap data.,"umap_with_axes_restriction( dsdin=new__tgt_dsd_,/*will generated by the macro sc_scatter4gene*/ umap_width=800, umap_height=400, lattice_or_not=0, raxis_max=20000, raxis_min=0, caxis_max=, caxis_min=45000, panel_row_num=1, /*The value will be assigned to rows in proc sgpanl for the panel statement; when value is 1, there would be 1 row for the final plot with subplots put into 1 row; when value is < total number of subplots, subplots will be put into specific rows one by one on column-wide; when value is equale to total number of subplots, all subplots will be put into a single column;*/ noheader=1 /*remove header for each subplot*/ );",
zscroe2p,COVID19_GWAS_Analyzer,Generate p values for a z-score variable in a dataset.,"zscroe2p(dsdin,Zscore_var,dsdout);",
import_sc_mtex_meta_umap_data,COVID19_GWAS_Analyzer,"Import single cell matrix data in the format of mtx, as well as import its meta and umap data.","import_sc_mtex_meta_umap_data( umap_file=https://cells.ucsc.edu/covid-hypertension/Seurat_umap.coords.tsv.gz, /*local uncompressed or compressed (.gz) umap file or http link for compressed umap gz file*/ meta_file=https://cells.ucsc.edu/covid-hypertension/meta.tsv, /*meta data for the single cells and samples*/ cell_id_in_meta=cell, /*need to ensure the column name for cells is cell, otherwise, please the real name used by the meta_file; this var will be important for merger of meta and umap files*/ exp_matrix_file=https://cells.ucsc.edu/covid-hypertension/exprMatrix.tsv.gz, /*local or remote uncompressed or compressed gz file*/ outdir=%sysfunc(pathname(HOME)), /*3 sas data sets will be created and put into the dir: exp (read matrix with column headers, and the last column is for genesymbol), umap (umap coordinates with sample meta data merged), headers (column headers for the exp matrix) */ target_genes= /*To save space in SAS On Demand for Academics, provide genesymbols separated by | without space to focus on specific genes; prxmatch will be use this list to match records; So do not add square to contain them!*/ );",ImportFileHeadersFromZIP FileOrDirExist GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath deseq_normalization delete_sas_dsd deseq_normalization4longdsd rename_sas_dsd squeez_single_num_var_length ucsc_cell_matrix2wideformatdsd g
AddNullData2SeparateDsd,Data manipulation,"Add missing data for variables by a specific group, which will enable the data of each group been separated with enough gap in a barplot or other graphic procedures by this group variable.","AddNullData2SeparateDsd(dsd,FrtSrtVar,SecSrtVar,Num4AddedNullLines,AddVar4output,Value4AddVar,dsdout);",
AddRowNumber4Com_Vars,Data manipulation,Add a numeric variable indicating the sorted order for a single group variable or multiple group variables in a input sas dsd,"AddRowNumber4Com_Vars(dsdin,Com_Vars,desending_or_not,dsdout);",
App_Dsd_Lbl_Fmt_To_Other_Dsd,Data manipulation,"Apply variable names, labels and formats from a input dataset indsd to the other new dataset dsdout.","App_Dsd_Lbl_Fmt_To_Other_Dsd(indsd,target_dsd);",
Append_All_Data_In_Lib,Data manipulation,Vertically append all sas datasets in a library as a single sas dataset.,"Append_All_Data_in_Lib(lib,excluded,dsdout); %let re=%sysfunc(prxparse(s/ /"" ""/oi));",get_filenames
Append_DataSets_In_Lib,Data manipulation,Selectively append sas datasets match or unmatch with specific regular expression into a single sas dataset in a input sas library or an excel table.,"Append_DataSets_In_Lib(lib,excel,excluded,add_dsd_name,dsd_not_contain_rgx,dsd_contain_rgx,dsdout);",
Append_Selected_Data_In_Lib,Data manipulation,"Selectively append sas datasets unmatch with specific regular expression into a single sas dataset in a input sas library or an excel table. Compared to the macro Append_DataSets_in_Lib, this macro does not include the parameter dsd_contain_rgx to further filter these sas datasets not match with specific regular expression.","Append_Selected_Data_In_Lib(lib,excel,excluded,add_dsd_name,dsd_not_contain_rgx,dsdout);",
Auto_char2num4dsd,Data manipulation,Automatically determine whether the character variable containing more than specific percentages of numeric elements and change the tested variable into a numeric variable with the same variable name.,"Auto_char2num4dsd( dsdin /* input dsd */ ,col_num_pct /*Percent of rows is numberic, used for selection of col to be change it into numeric*/ ,dsdout /* Output dsd */ ) ;",ImportPartialFilebyScan
BMI,Data manipulation,Calculate BMI in sas data step.,"BMI(WgtPd_Var,HgtIN_Var);",
Bed2SAS_DB,Data manipulation,Import all bed files match with specific regular expression in a directory into a sas dataset.,"Bed2SAS_DB(Bed_Dir,Regex4bed,Libname4out,outdsd);",ImportAllFilesInDirbyScan get_filenames
BedCount,Data manipulation,Count the total length of bed fragments in a input sas dataset,"BedCount(bed,st,end,out);",
Check_VarnamesInDsd,Data manipulation,Check whether any variable names in the sas dataset match with a input regular expression.,"Check_VarnamesInDsd(indsd=,Rgx=.,exist_tag=);",
ClearLib,Data manipulation,Clear all sas datasets in a sas library.,ClearLib(Libname);,
CompareGenoA1A2,Data manipulation,Determine whether two alleles of two SNPs are the same or not in sas data step.,"CompareGenoA1A2(dsdin,Avarname1,Avarname2,Bvarname1,Bvarname2,dsdout);",
DROPMISS,Data manipulation,To find both Character and Numeric the variables that have only missing values and drop them if they are not in variable list of &NONDROP.,"DROPMISS( DSNIN /* name of input SAS dataset */ , DSNOUT /* name of output SAS dataset */ , NODROP= /* [optional] variables to be omitted from dropping even if they have only missing values */ );",
DataReplacement,Data manipulation,Replace regular expression matched strings among all variables with specific replacement.,"DataReplacement dsd => target dsd subjects to replacement vars2replace => variables to be replace with specific data; if it is empty, will select all variables (either numeric or character) var_type => numeric or character filter4replace => regex to match word or number in variables to be replaced replacement => the final word or number used for replacement dsdout => sas output dataset name */ /*option mprint mlogic symbolgen;*/ /* %DataReplacement( dsd, vars2replace, var_type, filter4replace, replacement, dsdout);",
DataReplacement,Data manipulation,Replace regular expression matched strings among all variables with specific replacement.,"DataReplacement( dsd, vars2replace, var_type, filter4replace, replacement, dsdout );",
Del_Dir_Recursive,Data manipulation,Delete directories and its corresponding subdirectories recursively.,"Del_Dir_Recursive(upper_dir,lower_dir);",recursiveDelete
Delete_DataSets_In_Lib,Data manipulation,Delete sas datasets in a library.,"Delete_DataSets_In_Lib(lib,excel,excluded,dsd_not_contain_rgx,dsd_contain_rgx);",
ExpandVarList,Data manipulation,get variable names separated by space from a sas dataset and output the variable list.,"ExpandVarList(data=_LAST_, var=_ALL_);",
File_Head,Data manipulation,like the linux head function to print first number of lines in a file.,"File_Head(filename,n=10);",
FilterFile,Data manipulation,Automatically change file contents by applying regexpression to exclude BLANK lines and matched lines,"FilterFile( filefullpath /* input file fullpath */ ,ExcludedLineRegx /*Lines will be excluded if match the regexpression */ ,KeptLineRegx /*Lines will be kept if match the regexpression*/ ,system /* The system to run the macro: Linux or Windows */ ,fileoutfullpath /* Output data into a new file */ ) ;",
Find_duplicates,Data manipulation,get records with duplicated keys in a sas dataset.,"Find_duplicates(inputdsd,key,outputdsd);",
Full_Pvalue,Data manipulation,Change the sas p value format into best32 format in a sad dataset.,"Full_Pvalue(dsdin,dsdout);",
Get_All_Var_Info,Data manipulation,Get variable names of a sas dataset and save them into a new sas dataset.,"Get_All_Var_Info(indsd,outdsd);",
ImportAllFilesInDirbyScan,Data manipulation,Import all files match with file regular expression and combine all records into a single sas dataset.,"ImportAllFilesInDirbyScan( fileDir /*raw data file dir*/ ,fileRegexp /*regexp to match files*/ ,dsdout /*SAS output dataset name; N.B.: All variables are in character!*/ ,firstobs=0 /*The line number for header; if there is no header, firstobs=0*/ ,dlm='09'x /*Delemiter for raw data*/ ,ImportAllinChar=1 /*Imporat all data as char, otherwise import all as number*/ ,MissingSymb=NaN /*Specific missing data value in file*/ ,notverbose=1 ,debug=0 );",get_filenames
ImportDsd_via_Proc_Import,Data manipulation,Import file into SAS based on the proc import generated codes and further modify the codes when the proc import can not guess the right format of data in the target file for importing. Note: this macro uses the submacro Make_Proc_Import_Code.,"ImportDsd_via_Proc_Import(filepath, _kept_variables, _getnames_yes_no, _datarow, _dbms, _force2Num, dsdout);",Make_Proc_Import_Code File_Head
ImportFilebyScan,Data manipulation,Import a file by using the sas data step fucntion scan to forcely asigning variables as character or numeric variables into a sas dataset.,"ImportFilebyScan( file /*raw data file path*/ ,dsdout /*SAS output dataset name; N.B.: All variables are in character!*/ ,firstobs=0 /*The line number for header; if there is no header, firstobs=0*/ ,dlm='09'x /*Delemiter for raw data*/ ,ImportAllinChar=1 /*Imporat all data as char, otherwise import all as number*/ ,MissingSymb=NaN /*Specific missing data value in file*/ );",
ImportFilebyScanAtCol,Data manipulation,Simailar to the macro ImportFilebyScan but can be customized to select the start column in the file to be imported into a sas dataset.,"ImportFilebyScanAtCol( file /*raw data file path*/ ,dsdout /*SAS output dataset name; N.B.: All variables are in character!*/ ,firstobs=0 /*The line number for header; if there is no header, firstobs=0*/ ,dlm='09'x /*Delemiter for raw data*/ ,ImportAllinChar=1 /*Imporat all data as char, otherwise import all as number*/ ,MissingSymb=NaN /*Specific missing data value in file*/ ,FromColNum=1 );",
ImportFilebyScanAtSpecCols,Data manipulation,Simailar to the macro ImportFilebyScan but can be customized to select specific culumns in the file to be imported into a sas dataset.,"ImportFilebyScanAtSpecCols( file /*raw data file path*/ ,dsdout /*SAS output dataset name; N.B.: All variables are in character!*/ ,firstobs=0 /*The line number for header; if there is no header, firstobs=0*/ ,dlm='09'x /*Delemiter for raw data*/ ,ImportAllinChar=1 /*Imporat all data as char, otherwise import all as number*/ ,MissingSymb=NaN /*Specific missing data value in file*/ ,SpeColNums=1 );",numargs
ImportFilesInDSDbyScan,Data manipulation,Import all files match with regular expression in a directory with similar function as that of the macro ImportFileByScan.,"ImportFilesInDSDbyScan(filedsd /*sas dsd containing filenames*/ ,filename_var /*filename variable in the above dsd*/ ,fileDir/*raw data file dir; if using fullpath in dsd,let it empty*/ ,fileRegexp /*regexp to match files*/ ,dsdout/*SAS output dataset name; N.B.: All variables are in character!*/ ,firstobs=0 /*The line number for header; if there is no header, firstobs=0*/ ,dlm='09'x /*Delemiter for raw data*/ ,ImportAllinChar=1 /*Imporat all data as char, otherwise import all as number*/ ,MissingSymb=NaN /*Specific missing data value in file*/ ,notverbose=1 ,debug=0 );",RecSearchFiles2dsd FileOrDirExist get_filenames
ImportPartialFilebyScan,Data manipulation,Import only the first number of rows in a file into a new sas dataset.,"ImportPartialFilebyScan( file /*raw data file path*/ ,dsdout /*SAS output dataset name; N.B.: All variables are in character!*/ ,firstobs=0 /*The line number for header; if there is no header, firstobs=0*/ ,rows=1 /*How many rows will be imported after the header line*/ ,dlm='09'x /*Delemiter for raw data*/ ,ImportAllinChar=1 /*Imporat all data as char, otherwise import all as number*/ ,MissingSymb=NaN /*Specific missing data value in file*/ );",
ImportSpecCols4FilesInDirbyScan,Data manipulation,pull target columns by number from all files matched with regular expression in a directory and combine all records into a single sas dataset.,"ImportSpecCols4FilesInDirbyScan( fileDir /*raw data file dir*/ ,fileRegexp /*regexp to match files*/ ,dsdout /*SAS output dataset name; N.B.: All variables are in character!*/ ,firstobs=0 /*The line number for header; if there is no header, firstobs=0*/ /*if the header is at 3 rows, provde 3 to the macro var firstobs!*/ ,dlm='09'x /*Delemiter for raw data*/ ,ImportAllinChar=1 /*Imporat all data as char, otherwise import all as number*/ ,MissingSymb=NaN /*Specific missing data value in file*/ ,SpeColNums=1 ,notverbose=1 ,debug=0 );",get_filenames numargs
Import_Space_Separated_File,Data manipulation,"Import multiple space separated file, such as the old-school format dat file, into a new sas dataset.","Import_Space_Separated_File(abs_filename,firstobs,getnames,outdsd);",
KeepColMatchingRgx,Data manipulation,subset variables matched with regular expression and put them into a new sas dataset.,"KeepColMatchingRgx(indsd,Rgx,outdsd,insensitive);",
KeepColNotMatchingRgx,Data manipulation,subset variables NOT matched with regular expression and put them into a new sas dataset.,"KeepColNotMatchingRgx(indsd,Rgx,outdsd);",
LinkDupWithHash,Data manipulation,Link elelemts by key variables in a sas dataset. Note: the macro uses the hash feature of sas.,"LinkDupWithHash(dsd,keys,values,out_var_names,linker,outdsd,rmdups);",RepRegx2ValueInDsd numargs
Make_NoQuote_Var_List_From_Dsd,Data manipulation,Make a global macro variable noquote_var_list to contain the uniuqe elements without quotes of a variable in a sas dataset.,"Make_NoQuote_Var_List_From_Dsd(indsd,var,sep);",
Make_Proc_Import_Code,Data manipulation,Generate sas codes for importing a file by running the proc import to guess data formats and variables.,"Make_Proc_Import_Code(abs_data_file_name,sas_code_file,kept_variables,getnames_yes_no,datarow,dbms,Force2Num,dsdoutname);",File_Head
Make_Where_In_Item_List,Data manipulation,"Output a item list into sas script according to the requirement of where condition function in, such as 'where query_name in (""A"",""B"");'. Note: the sas script can be included into data step using %include.","Make_Where_In_Item_List(query_name,indsd,dsd_variable,out_item_list);",
MatlabMatrix4SAS,Data manipulation,"Import matlab matrix data, including matrix.tab, collabels.txt and rowlabels.txt, into a sas dataset.","MatlabMatrix4SAS(Matrix_File,Rowlabels_File,Collabels_File,dsd_out,Matrix2Num);",ImportDsd_via_Proc_Import Make_Proc_Import_Code File_Head ImportFilebyScan
Merge_Dsd_In_Lib_Rgx,Data manipulation,Merge sas datasets matched with regular expression in a library,"Merge_Dsd_In_Lib_Rgx(lib,excluded,dsd_contain_rgx,comm_vars_rgx,dsdout);",Make_NoQuote_Var_List_From_Dsd merge_dsd_by_comm_vars
Multfiles2Matrix,Data manipulation,Extract values from multiple files in a directory and generate a matrix dataset for these files.,"Multfiles2Matrix(file_dir,flrxp,tgt,value,value_type,value_cutoff_formula,matrix_dsd,debug);",ImportFilesInDSDbyScan RecSearchFiles2dsd FileOrDirExist get_filenames
MultiTranspose,Data manipulation,Transposing multiple variables in a data set (http://www.medicine.mcgill.ca/epidemiology/joseph/pbelisle/sas-macros.html),"MultiTranspose(out=, data=, vars=, by=, pivot=, copy=, dropMissingPivot=1, UseNumericExt=0, library=library);",
Only_Keep_noduplicates,Data manipulation,make a new sas dataset by removing duplicates of specific key variable in a sas dataset.,"Only_Keep_noduplicates(inputdsd,key,outputdsd);",
Order_Cols,Data manipulation,Order variables in a table in alphabetical order.,Order_Cols(indsd);,
QueryRangeDsd,Data manipulation,"Query positions included a query sas dataset in the other sas dataset that has bed regions that overlap with the query positions, resulting in subset sas dataset base on the latter sas dataset.","QueryRangeDsd(base_dsd, key4range_in_base, st4range_in_base, end4range_in_base, extra_vars_in_base2keep, query_dsd, key4range_in_query_dsd, Pos4lookup_in_query_dsd, outdsd);",
Query_LargeRangeDsd_With_Idx,Data manipulation,Query positions overlapped with bed regions in a large dataset already index by sas.,"Query_LargeRangeDsd_With_Idx(base_db, num_key4range_in_base, st4range_in_base, end4range_in_base, query_dsd, num_key4range_in_query_dsd, Pos4lookup_in_query_dsd, outdsd);",delete_empty_dsd
Query_LargeRangeDsd_With_Idx,Data manipulation,Query positions overlapped with bed regions in a large dataset already index by sas.,Query_LargeRangeDsd_With_Idx;,delete_empty_dsd
Query_Large_File_With_Idx,Data manipulation,Query names or ids in a large dataset already index by the a specific key.,"Query_Large_File_With_Idx(idx_var,rownames,dsdin,dsdout);",delete_empty_dsd
Quote_Varlist,Data manipulation,generate a macro variable called list to contain quoted element list using sas function prxchange to update the input list.,Quote_Varlist(list);,
Remove_dups_in_dsd,Data manipulation,Remove duplicate elements in a sas dataset by group. The macro is able to keep the 1st or last duplicate based on input parameters for the macro.,"Remove_dups_in_dsd(dsd,sort_var,key_var,first_or_last4dup,dsdout,sort_var_cutoff_func);",
Rename_Add_Prefix,Data manipulation,Generate rename commands for a data step to add prefix for input variable names.,"Rename_Add_Prefix(oldvarlist, prefix);",
Rename_Add_Prefix4All_Vars,Data manipulation,Rename all variables in a sas dataset with a specific prefix and update the dataset.,"Rename_Add_Prefix4All_Vars(indsd,prefix);",
Rename_Add_Prefix4Most_Vars,Data manipulation,Rename all variables but can exclude user input variables in a sas dataset with a specific prefix and update the dataset.,"Rename_Add_Prefix4Most_Vars(indsd,prefix,excluded);",
Rename_Add_Suffix,Data manipulation,Generate rename commands for a data step to add suffix for input variable names.,"Rename_Add_Suffix(oldvarlist, suffix);",
Rename_Del_Rgx4All_Vars,Data manipulation,Rename any variables by deleting elements matched with input regular expression in sas dataset.,"Rename_Del_Rgx4All_Vars(indsd,Rgx);",
Rename_OldPrefix2NewPrefix,Data manipulation,Generate rename commands for a data step to replace old prefix with new prefix among all variables. Note: these variables are named as prefix&num in the input dataset.,"Rename_OldPrefix2NewPrefix(oldprefix, newprefix, num);",
Rename_Oldvarlist2Newvarlist,Data manipulation,Generate rename commands for a data step to replace old variable names with new variable names in the same order.,"Rename_oldvarlist2newvarlist(oldvarlist, newvarlist); %let k=1; %let old = %scan(&oldvarlist, &k);",
Rename_vars_with_info_from_dsd,Data manipulation,Rename variable names in a sad dataset based on a lookup sas dataset containing old variable names and new variable names.,"Rename_vars_with_info_from_dsd( dsdin, var_info_dsd, old_var_info,/*a variable containing old variable names in the dsd var_info_dsd*/ new_var_info,/*a variable containing new variable names for renaming the old variable names in the dsd var_info_dsd*/ outdsd);",
RepRegx2ValueInDsd,Data manipulation,"Use regular expression to replace elements with new number or string in all numeric or character variables in a sas dataset. Note: the input for the parameter RegRegx is a typical regular expression for prxchange, such as 's/A/_A_/'. It can be used to replace all missing values as specific number among all numeric variables.","RepRegx2ValueInDsd(dsdin,dsdout,RepRegx,Num_or_Char);",
Run_7Zip,Data manipulation,Run 7zip to compress or uncompress file in Windows or Linux. Note: 7zip needs to be installed.,"Run_7Zip(Dir=, /* Windows path of directory to examine*/ filename=, /* Target for 7Z */ Zip_Cmd= x, /* add commands listed belowing, such as x to run with fullpath and e to extract with filename without fullpath */ Extra_Cmd=-y, /* add extra commands: assume Yes on all queries -so >x.txt output data into a new file */ outdir4file= /*output uncompressed file into a new dir under the 1st macro var &Dir*/ ) ;",chdir direxist
SASToExcel,Data manipulation,Export all sas datasets in a library to separated excel files.,"SASToExcel(ImportLibrary=, ExportLocation=);",
SQUEEZE,Data manipulation,Squeeze variable length to reduce dataset size.,"SQUEEZE( DSNIN /* name of input SAS dataset */ , DSNOUT /* name of output SAS dataset */ , NOCOMPRESS= /* [optional] variables to be omitted from the minimum-length computation process */ );",
SQUEEZE_wide_dsd,Data manipulation,Split large number of columns into subset dataset for a input dataset and sequeeze the length of variables in each smaller subset dataset. All subset dataset after sequeezing will be combined into a final single sas dataset.,"SQUEEZE_wide_dsd( dsdin, dsdout_prefix, split_num4vars, dsdout );",split_wide_dsd
SQ_DROPMISS,Data manipulation,Squeeze a data set to have minimum lengths required for the variables excluding the variables in &NOCOMPRESS applying %SQUEEZE_1 and then DROP the variables that have always missing values in a more efficient way.,"SQ_DROPMISS( DSNIN /* name of input SAS dataset */ , DSNOUT /* name of output SAS dataset */ , NOCOMPRESS= /* [optional] variables to be omitted from the minimum-length computation process */ , NODROP= /* [optional] variables to be omitted from droping even if they have only missing values */ );",
Sampling,Data manipulation,Randomly select samples n times for permutation purpose.,"Sampling(indsd,n,nperm,dsdout);",
Scaleup_nrow_ncol,Data manipulation,Generate all combinations for elements from two variables and fill a specific value conresponding to these combinations.,"Scaleup_nrow_ncol(dsdin,row_var4row,row_var4col,value_var,dsdout);",
SingleDsd2MergedDsd4DiffGrps,Data manipulation,"change a long format dataset into wide-format dataset by splitting the input dataset by a group variable, with elements for each group will be put column-wide without considering lookup relation even each group may have different number of elements. Missing values will be filled for group having less number of elements.","SingleDsd2MergedDsd4DiffGrps(singledsd,num_grp_var,mergeddsd);",
SortDsd4Plot,Data manipulation,"Sort count, sum, or mean of variable values by groups and make a format that can be used by sas plot procedures, such as proc sgplot.","SortDsd4Plot(dsd,ByFmtVar,OutFmtVar,OutDsd,GroupVars,SumByVar,CountByVar,MeanByVar);",
SplitDsdIntoMultiDsdsByNumGrp,Data manipulation,Split a dataset into multiple subsets by a numeric group variable.,"SplitDsdIntoMultiDsdsByNumGrp(dsd,numgrpvar,newdsd_prefix);",
SumOf,Data manipulation,a proc sql sum function for variables or newly calculated variables.,"SumOf(vars=, calculated=);",
Table4matlab_matrix,Data manipulation,"export a sas table into 3 files for matlab, including matrix.tab, rowlabels.txt and collabels.txt, which can be imported into matlab.","Table4matlab_matrix(dsdin,col4matrix_rowlabels,fixedmissingvalue,outdir);",
ThreeVarTable4Counting,Data manipulation,Make a two-way or three-way table displaying combined variable frequency.,"ThreeVarTable4Counting(dsd,firstvar,secondvar,thirdvar);",
UncompressGZWith7ZInWindows,Data manipulation,Uncompress gz or zip file using 7zip in Windows. Note: 7zip needs to be installed.,"UncompressGZWith7ZInWindows( gzfilepath=,/*fullfilepath for gz file*/ globalvar4finalfile=final_gz_file /*Provide a global macro var name to access the uncompressed file later by other macros*/ );",Run_7Zip chdir direxist
Union_Data_In_Lib_Rgx,Data manipulation,Vertically combine multiple sas datasets in a library that match with regular expression. Note: the macro will consider different lengths of same variables among these datasets.,"Union_Data_In_Lib_Rgx(lib,excluded,dsd_contain_rgx,dsdout);",Make_NoQuote_Var_List_From_Dsd union_add_tags
Union_Selected_Data_In_Lib,Data manipulation,Vertically combine multiple sas datasets in a library with extra functionality of excluding specific datasets using exact dataset names or regular expression.,"Union_Selected_Data_In_Lib(lib,excluded,dsd_not_contain_rgx,dsdout);",Make_NoQuote_Var_List_From_Dsd union_add_tags
VCF_Headers,Data manipulation,Parse the last line in VCF headers for evaluation.,"VCF_Headers(dir=,filename=,dsdout=);",
VarnamesInDsd,Data manipulation,"get variable names in a dataset, filter them by regular expression, and save these matched variable names into a new dataset.","VarnamesInDsd(indsd,Rgx,match_or_not_match,outdsd);",
_make_fake_axis_values4grps_,Data manipulation,"Old version of the important macro make_fake_axis_values4grps, for backup purpose.","_make_fake_axis_values4grps_( dsdin, axis_var, axis_grp, new_fake_axis_var, dsdout, yaxis_macro_labels=ylabelsmacro_var );",
add_fake_pos_by_grp4nonnegvars,Data manipulation,"Adjust positive values (including 0) and exclude negative values by creating fake positional values for them based on their group membership, resulting in these values were separated into different sections and can be applied for generating scatter plots.","add_fake_pos_by_grp4nonnegvars( dsdin, axis_var,/*No negative values are allowed for the target axis var*/ axis_grp, new_fake_axis_var, dsdout, /*Two new variables, tag var and tpos, can be used to draw a ref line to separe each group*/ axis_step=1 /*Add extra step to separate each group for the end value of axis_var*/ );",
add_symbol4grp_in_dsd,Data manipulation,"Add a variable with symbols from the input symbol list to match group elements. Note: the macro will get unique group elements and assign symbol for each group element, so the order of group elements is decided by proc sql. It is necessary to change the order of symbol list if wanting to assign specific symbol to a group element.","add_symbol4grp_in_dsd(dsdin,grp_var,symbols,dsdout);",
adj_grpnum4close_gene_bed_regs,Data manipulation,"Randomly separate bed regions that are too close to each other into different groups. Note: a numeric group variable will be created and can be used to draw tracks for closely related regions, enabling them to be eparated well in visualization.","adj_grpnum4close_gene_bed_regs( /*NOte: the macro can only separate most of the bed regions into for better labeling bed regions, and usually the 1st tract will be good, with genes included in other tracks may not be well separated!*/ gene_bed_dsd=a, st_var=st, end_var=end, reg_type=type,/*if empty, it will use the longest region as gene and other shorter region from the same group as exons*/ focused_reg_type4grouping=gene, gene_grp=grp, gene_dist_thrhd=0.1,/*(1) give 0 or negative value to incluce all genes into a single group; (2) given value in bp > 1 to separate genes by absolute distance in bp; (3) if given value ranging from 0 to 1, it will use the pct of the whole region to separate genes into different groups! This option would be most useful to enable enough space for adding text on each gene, as it will consider the length of gene as well as the distance between genes*/ dsdout=_gene_regions_,/*dsdout can be the same as gene_bed_dsd*/ outnumgrp=numgrp /*the var name for outnumgrp can not be same as other vars in gene_bed_dsd*/ );",
adjust_close_positions,Data manipulation,Generate fake position to separate closely related regions for better visualization or plotting.,"adjust_close_positions( indsd=, outdsd=, pos_var=pos, new_pos_var=newpos, dist_pct_to_cluster_pos=0.01,/*Use the pct of range of positions to cluster these positions*/ amplificaiton_fc=1.5, /*Increase the distance fold change among among these close records*/ make_even_pos=1, /*If provide value 1, which will ensure all position with the same distance between min ans max pos; This will replace previous setting of dist_pct_to_cluster_pos and amplificaiton_fc; Note: *Only when the total number of records is gt the number of distant cluster, the macro will generate even positions for all records */ fixed_min_pos=,/*Provide fixed minimum and maximum positions for generating even psotions; Default is empty to use the minimum and maximum positions from input dsd!*/ fixed_max_pos= );",
assign_str4missing,Data manipulation,Assign new value for a macro variable if it is with missing value.,"assign_str4missing(Inval,NewVal);",
char2num_dsd,Data manipulation,transform a character variable into a numeric variable and keep the same variable name in the sas dataset.,"char2num_dsd(dsdin,vars,dsdout);",
char_grp_to_num_grp,Data manipulation,"Add numeric group membership for multiple group variables, and keep only one record for each unique combination of input group variables if required.","char_grp_to_num_grp( dsdin=, grp_vars4sort=, descending_or_not=, dsdout=, num_grp_output_name=, keep_uniq_rows_by_grp=0 );",numargs
char_grp_to_num_grp4dups,Data manipulation,"This macro is similar to the macro char_grp_to_num_grp but does not have the functionality to remove duplicate records, which means that all records will be kept but adding a new numeric variable to indicate their group membership.","char_grp_to_num_grp4dups(dsdin,grp_vars4sort,descending_or_not,dsdout,num_grp_output_name);",numargs
check_col_orders,Data manipulation,"create a sas dataset containing variable names and its order, type, and length for a input sas dataset.","check_col_orders(dsd,colorder_info_out,print_colobs=10);",
check_header_DataRow,Data manipulation,"Check records in a file along with file header in a vertical mode, which means the header and the queired row will be transposed into longform data for easier view. This is extremely helpful if the file contains too many columns.","check_header_DataRow( file, dlm='09'x, header_rown=1, data_rown=2, dsdout=header );",
check_header_DataRow,Data manipulation,"Check records in a file along with file header in a vertical mode, which means the header and the queired row will be transposed into longform data for easier view. This is extremely helpful if the file contains too many columns.","check_header_DataRow will be terminated!; %abort 255; %end; proc sql; create table &dsdout as select * from &dsdout.2 natural join &dsdout.1; proc print data=&dsdout(obs=10);run; %mend; /*Demo: x cd ""J:\Coorperator_projects\ACE2_2019_nCOV\Covid_GWAS_Manuscrit_Related\MAP3K19_Manuscript\Figures_Tables\covid19_female_vs_male_gwas_results\GTEx_Sex_Diff_Analysis""; %File_Head(filename=""GTEx_Analysis_2017-06-05_v8_RNASeQCv1.1.9_gene_tpm.gct"",n=4);",
check_header_and_values,Data manipulation,"This macro is similar to the macro check_header_DataRow but is extended to accept input as a plain file, a compressed gz/zip file, or a sas dataset.","check_header_and_values( input_dsd_or_file_or_url=, tgt_var_from_dsd=info, linesep=\t, dsdout=x, column_len=500, header_line=1, value_line=10, use_zcat=0, deleteZIP=0 );",
check_var_type,Data manipulation,Create a global macro variable var_type to retain the type of variables matched with regular expression in a sas dataset.,"check_var_type(dsdin,var_rgx);",
checkvarname,Data manipulation,Check whether an input string can be used as a sas variable name.,checkvarname(value);,
chk_sas_dsd,Data manipulation,This is a sas function to return a value of 0 (No) or 1 (Yes) indicating the existense of a sas dataset. Note: its necessary to provide library and dataset name for the macro.,"chk_sas_dsd(lib=work,dsdname=_last_);",
chr_format_exchanger,Data manipulation,transform numeric chromosomic labels into character chromosomic labels and vice versa.,"chr_format_exchanger(dsdin,char2num,chr_var,dsdout);",
countm,Data manipulation,"Generate proc sql statements to count valid response for a variable, as well as the total number of missing, not valid response, or data entry of the variable. Note, the macro can be combined with other proc sql statement to generate quality control statistics for a variable. Note: it is necessary combine the command of ""proc sql; select "" with the macro.",countm(col);,
del_file_with_fullpath,Data manipulation,Delete a file in system.,del_file_with_fullpath(fullpath);,
del_files_in_dsd,Data manipulation,Delete files that are supplied in a sas dataset.,"del_files_in_dsd(dsd,filevar,indir,match_rgx);",
delete_all_Appdx_files_in_folder,Data manipulation,Delete all files matching with regular expression in a folder.,"delete_all_Appdx_files_in_folder(folder,Appendix);",
delete_all_files_in_folder,Data manipulation,Delete all files in a folder.,delete_all_files_in_folder(folder);,
delete_all_txt_files_in_folder,Data manipulation,Delete all files with the appendix of '.txt' in a folder.,delete_all_txt_files_in_folder(folder);,
delete_dir,Data manipulation,"Delete directory, especially useful for remove empty directory.",delete_dir(dir);,
delete_empty_dsd,Data manipulation,Delete a sas dataset if it is empty.,delete_empty_dsd(dsd_in);,
delete_file_or_dir_with_fullpath,Data manipulation,Delete a file or directory with its supplired fullpath.,delete_file_or_dir_with_fullpath( file_or_dir_fullpath= );,
delete_sas_dsd,Data manipulation,delete a sas dataset.,delete_sas_dsd(dsdin);,
dsd2matrix,Data manipulation,Transform a longformat sas dataset into a sas matrix.,"dsd2matrix(dsd,row_var,col_var,data_var,matrix_out);",
dsd_x_multiple_dsd_y,Data manipulation,"Get all combinations of variables from sas dataset x with all variables from the other sas dataset y. Note: to avoid variables with the same names in the two sas datasets, the 1st sas dataset will be modified for all variables by adding a specific prefix.","dsd_x_multiple_dsd_y(dsd_x,prefix_dsd_x,dsd_y,dsd_out);",Rename_Add_Prefix4All_Vars
dup_rows_by_grp,Data manipulation,"Add two variables, including grp and ord, to numerically label groups and its corresponding elements. Note: elements in each group will be labeled in ascending order but asigned with the same numeric group label. Note: the name of the macro is meaning of 'duplicating row numbers by grp'.","dup_rows_by_grp(dsdin,grp_var,num_var4sort,desending_or_not,dsdout);",
exportdsd2gz,Data manipulation,Export a sas dataset out as a compressed gz file.,Probable confict between macro name and its sas filename,
fasta2sas,Data manipulation,Import a fasta file into sas as a dataset. Note: fasta data can be in concatenated format or multiple line format in the final sas dataset. Note: It is able to read a fasta file containing multiple fasta records.,"fasta2sas(/*It is able to read a fasta file containing multiple fasta records*/ fasta, outdsd, fasta_one_line_mode=1 );",
fmt_char_with_num,Data manipulation,"Make a format for the character variable using numbers to represent them. This macro is not optimal, as if using it with proc sgplot to format the x-axis ticks, it will show the numeric variable for the x-axis ticks, which is not the final goal. Note: this macro is deprecated.","fmt_char_with_num(dsdin,var4fmt,var4sort,fmt_output_name,varname4fmtvar,dsdout);",
fmt_num_with_char,Data manipulation,"Make a format for the numeric variable using values from a character variable. The macro generate format with the function proc format cntlin, but the macro can not be successfully used to change the axes order if working with proc sgplot and other graphic procedure. The macro is deprecated.","fmt_num_with_char(dsdin,numvar4fmt,charvar4fmt,fmt_output_name);",
format_xaxis_with_numeric_order,Data manipulation,"Collapse multiple variables into a single numeric group and generate a format for the numeric group by sorting with proc sql functions, such as avg, median, and others. The output dataset can be used to draw plots with sorted order by a specific proc function, (avg, median, or others).","format_xaxis_with_numeric_order( dsdin, Xaxis_vars, new_Xaxis_var, Var4sorting_Xaxis, function4sorting, descending_or_not, dsdout, createdfmtname, KeyVar4Xaxis_vars=KeyVar4dsdout );",ApplyFunc_rowwide Rename_Del_Rgx4All_Vars numargs char_grp_to_num_grp
get_consecutive_num4linker,Data manipulation,"Get full numbers based on the input numbers with a specific linker, such as '-', of a range, and create a global macro variable containing all these separated numbers.","get_consecutive_num4linker(nums_with_linker,global_out,linker=-);",
get_file_header4infile,Data manipulation,"Get headers of a plain file or compressed gz file and put each column names into rowwide for further modificiation, which can be the input for infile statement.","get_file_header4infile(filename,rownum4header,dlm,dsdout);",
get_num_or_char_vars4dsd,Data manipulation,"Get all numeric or character variables from a sas dataset and create a new sas dataset to contain them, with its variable name as 'name'.","get_num_or_char_vars4dsd(indsd,outdsd,numeric);",
get_numeric_table_vars_length,Data manipulation,This macro is for a wide-format large file containing >10000 numeric variables and all character columns should be put at the beginning of the table. It will get numeric variables and its length base on a sas file filehandle generated by filename statement for the large file. All these numeric variables' length will be recorded by individual global macro variable with macro_prefix4CharVarLen. Also the maximum length of these numeric variables will be recorded by a global macro variable max_len.,"get_numeric_table_vars_length( filename_ref_handle, /*filename handle, and all character columns should be put at the beginning of the table!*/ total_num_vars, /*total number of numeric vars in the opened file handle*/ macro_prefix4NumVarLen, /*macro prefix used to generate macro vars for var lengths*/ firstobs=2, /*escape header or not*/ first_input4charvars=rownames tissue, /*provide all character vars*/ macro_prefix4CharVarLen=CharVarLen, dlm='09'x , /*if providing other non-SAS dlm, quote it*/ getmaxlen4allvars=1 /*Will creat a global macro var max_len recording the max length among all numeric vars, which is useful when there are too many numeric vars that would truncate the limitated string size of 32676*/ );",ntokens
getnumorcharvars4dsd,Data manipulation,"Get all numeric or character variables from a sas dataset and create a new sas dataset to contain them, with its variable name as 'name'.","getnumorcharvars4dsd(indsd,outdsd,numeric);",
gnomAD_snp_frq_analyzer,Data manipulation,A parser for gnomad snp frequency file downloaded from gnomad database.,"gnomAD_snp_frq_analyzer( gnomAD_file,/*copy gnomAD Population Frequencies table and save it into a txt file*/ gnomAD_snpid,/*such as 10-63699895-A-C for parsing ref and alt alleles*/ dsdout=gnomAD,/*Output sas dsd*/ csvout=gnomAD /*csv output name without appendix of .csv*/ );",
grep_keyword_in_gzfile,Data manipulation,"grep keyword in a gzfile, which is similar to linux grep function but works in sas. Note: the macro only return the 1st matched record!","grep_keyword_in_gzfile(/*Only return the 1st matched record*/ /*If no https in the url, the macro assumes that the input would be a local gz file; if the input file does not contain .zip or .gz, it still can grep it by treating the file as a plain text file!*/ gz_url=https://storage.googleapis.com/covid19-hg-public/20210415/results/20210607/COVID19_downloaded_file_ALL_leave_23andme_20210607.b37.txt.gz, keyword=rs7850484, /*regular expression for prxmatch*/ headerlinenum=1, /*The line number for the header, with default 1 asumming the 1st line is header*/ checkmatchedlinenum=100 /*Note: the linenum 1 is used to represent the header or the 1st line; When multiple lines matched with the searching keyword(s), apart from the 1st line, print the target line by number along with the header line in long format; also increase the linenum to all possible matched lines will keep all potential results in the output data set x for manual evaluation*/ );",ImportFileHeadersFromZIP FileOrDirExist GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath check_header_and_values
gsea_genesets2longfmt,Data manipulation,Import GSEA geneset file into sas in longformat.,"gsea_genesets2longfmt(file=,dsdout=,fileout=);",
head,Data manipulation,get the first number of records in a file and print it.,"head(file=,dbms=tab,getnames=yes,datarow=2,nobs=15,out=_tmp_);",
import_fasta_like_data,Data manipulation,Import fasta like data by generating data step codes with parmcards associated data in data step. This macro is very useful for data with header line put ahead with its members followed by it. The macro is updated to match different start strings or chars.,"import_fasta_like_data(/*Generate codes for running with parmcards in data step*/ header_start_char,/*It is defined to match more than one characters!*/ outdsd, onelinemode=1 );",
import_fasta_like_file,Data manipulation,Import fasta like file. This macro is very useful for file with header line put ahead with its members followed by it. The macro is updated to match different start strings or chars.,"import_fasta_like_file( fasta_like_file,/*A file contain data like that of fasta*/ header_start_char,/*regular expression to match the start chars*/ outdsd, onelinemode=1 );",
import_multi_xls,Data manipulation,"Import multiple excel files, of which its fullpaths are included in a sas dataset. The macro will run the macro xls2txt with dosubl to import excel file and export data into txt file for each excel.","import_multi_xls(xlsdsd,getnames);",RecSearchFiles2dsd FileOrDirExist
importfilewithlongheader,Data manipulation,Import a file that contains very long column names.,"importfilewithlongheader( filename, dlm4file, startrow4read, headerrow, outdsd, debug);",Rename_vars_with_info_from_dsd obsnvars
incr_value2div_by_num,Data manipulation,A sas function to enlarge the number to be dividable completely by a specific number. It will return the enlarged number or the fold for the denominator.,"incr_value2div_by_num( numerator=101, denominator=2, get_value_or_fold=0 /*default value is 0 to get the fold for the increased value that can be divided by the denominator*/ );",
infile_wide2long4sas,Data manipulation,Import a wide format plain file into sas as a longformat dataset. Note: the first column should be character and all other columns are in numeric.,"infile_wide2long4sas( file,/*The first column contain char value, with other columns are numeric*/ dlm, dsdout );",
isBlank,Data manipulation,"A sas function to determine whether the input macro variable is empty and its corresponding retured numeric value, including 1 or 0, can be assigned to a macro variable or used in data step.",isBlank(param) ;,
iscolallempty,Data manipulation,It will create a global macro variable to indicate whether a column in a dataset is all empty using the count function in proc sql.,"iscolallempty(dsd,colvar,ouvar);",
iscolallmissing,Data manipulation,It will create a global macro variable to indicate whether a column in a dataset is all missing using the nmissing function in proc sql.,"iscolallmissing(dsd,colvar,ouvar);",
long2wide4multigrpsSameTypeVars,Data manipulation,Transpose long format sas dataset into wide format based on multiple groups for the same type of numeric or character variables.,"long2wide4multigrpsSameTypeVars( long_dsd, outwide_dsd, grp_vars=,/*If grp_vars and SameTypeVars are overlapped, the macro will automatically only keep it in the grp_vars; grp_vars can be multi vars separated by space, which can be numeric and character*/ subgrpvar4wideheader=,/*This subgrpvar will be used to tag all transposed SameTypeVars in the wide table, and the max length of this var can not be >32!*/ dlm4subgrpvar=.,/*string used to split the subgrpvar if it is too long*/ ithelement4subgrpvar=2,/*Keep the nth splitted element of subgrpvar and use it for tag in the final wide table*/ SameTypeVars=_numeric_, /*These same type of vars will be added with subgrp tag in the final wide table; Make sure they are either numberic or character vars and not overlapped with grp_vars and subgrpvar!*/ debug=0 /*print the first 2 records for the final wide format dsd*/ );",get_num_or_char_vars4dsd
long_line_dsd_exporter,Data manipulation,Export a sas dataset with extremely large number of columns into a text file. It will export columnames first and use infile function mod to append data into the file separately.,"long_line_dsd_exporter(dsdin,outfile);",
longdsd2matlabmatrix,Data manipulation,"Export long format dataset into 3 text files that can be loaded into matlab, which are matrix.tab, rowlabels.txt and collabels.txt.","longdsd2matlabmatrix(dsd,var_row,var_col,data_var,value2asign4missing,dsdout,outdir4matrix);",
longdsd2struct_dsd,Data manipulation,"Change long format dataset into a dataset similar to the matlab structure matrix, in which keys, subkeys, and its corresponding elements are linked like a tree structure. This makes it easier to dissect the relationships between these keys, subkeys, and associated elements.","longdsd2struct_dsd( indsd, key1st_var, key2nd_var, structdsdout, max_iteration=100 /*the number of times to recursively perform proc sql to lookup these keys*/ );",
merge_dsd_by_comm_vars,Data manipulation,"This macro will use common variables met with a regular expression to generate sas codes for merging these datasets, and then run the sas codes to generate merged dataset. Note: the macro will use the largest length of the common key to import merge these datasets.","merge_dsd_by_comm_vars(dsds=, /*Name of the datasets, separated by space */ out=, /*Name of combined data set */ comm_vars_rgx= /*Common vars regulary expression among these datasets; no '()' is allowed!*/);",
mkfmt4grps_by_var,Data manipulation,"Make two formats, including numeric and character format for exchanging the newly created group number with its corresponding character group, and the group number is ordered by the value of a variable. Note: this is the best macro to make format for plotting.","mkfmt4grps_by_var( grpdsd, grp_var, by_var, outfmt4numgrps, outfmt4chargrps );",randombetween
mkfmt4grpsindsd,Data manipulation,This macro will use the macro mkfmt4grps_by_var to generate random format each time to avoid crash if the macro mkfmt4grps_by_var is used multiplte times without exiting sas environment.,"mkfmt4grpsindsd( targetdsd, grpvarintarget, name4newfmtvar, fmtdsd, grpvarinfmtdsd, byvarinfmtdsd, finaloutdsd );",mkfmt4grps_by_var randombetween
mult_columns_linker_by_grp_var,Data manipulation,Link multiple character columns with a linker by a common column group. Note: all elements from multiple variables with the same group key will be linked together as a single variable.,"mult_columns_linker_by_grp_var( indsd=_last_, outdsd=Linked_dsd, grp_var=,/*This var will be treated as key for linking all elements among var2link; Note: only unique element will be kept by the macro*/ vars2link= ,/*separate multiple CHAR vars by space or use var1-varn but not varA--varB to include multiple vars*/ linker=,/*can be , or a blank space; default is ,; provide alternative separator to link these vars*/ output_var4linked_vars=linked_vars /*Name for the var containing linked elements*/ );",
number_rows_by_grp,Data manipulation,Add numeric groups to a group variable and also assign a numeric variable for elements in the same group in the order that is sorted by the value of a variable.,"number_rows_by_grp( dsdin, grp_var, num_var4sort, descending_or_not, dsdout );",
nums_in_range,Data manipulation,Generate full numbers by a specific step in a numeric range and create a macro variable to contain these space separated elements. Note: these elements can be quoted or unquoted. The macro can be used to generate quoted numbers for label xaix of a plot.,"nums_in_range(st,end,by,ouvar,quote=1);",
obsnvars,Data manipulation,"Create two global variables, including nvars and nobs, to return the total number of variables and total number of observations in a dataset.",obsnvars(ds);,
opends,Data manipulation,A macro to open a sas dataset using %sysfunc and exist.,opends(name);,
prefixvars,Data manipulation,A sas macro to add a prefix to some or all variables in a data set.,"prefixvars(inpdsn,prefix,outdsn,excludevars=);",
print_head4dsd,Data manipulation,print the first number of records in a sad dataset.,"print_head4dsd(dsdin,n=10);",
pull_column,Data manipulation,A sql function to extract columns in a specific order.,"pull_column(dsd,dsdout,cols2pull);",check_col_orders get_consecutive_num4linker
quotelst,Data manipulation,add single or double quote to each elements in a list of macro variable.,"quotelst(str,quote=%str(%""),delim=%str( )); %local i quotelst; %let i=1; %do %while(%length(%scan(&str,&i,%str( ))) GT 0);",
randombetween,Data manipulation,A sas macro function to return a random number between a range for a new macro variable or used in a data step.,"randombetween(min, max);",
randomize_var,Data manipulation,Randomize the values of a variable in a sas dataset.,"randomize_var(dsdin,var,rand_fun,dsdout);",
range2consecutive_num,Data manipulation,A sas macro function to enerate full numbers by a specific step for a list of numeric ranges and return them as a macro variable or used in data step.,"range2consecutive_num(arg,step);",
rank4grps,Data manipulation,Make a sas dataset to represent the elements in a list with numeric groups in the same order as that in the input list.,"rank4grps(grps,dsdout);",
rename_files_in_dsd,Data manipulation,rename files based on information provided by a sas dataset.,"rename_files_in_dsd(dsd,filevar,indir,newfilevar);",
rename_sas_dsd,Data manipulation,rename a sas dataset with a new name or copy the dataset into a new library with the same or different dataset name.,"rename_sas_dsd( dsdin, dsdout );",
reorder_cols,Data manipulation,Sort variable names in alphabet order for a sas dataset.,reorder_cols(dsn);,
replacestrinfile,Data manipulation,Replace strings matching with a regular expression in a plain text file and save the data into a new plain text file.,"replacestrinfile(file,strrgx,newstr4rep,casesensitive=0,outdir=,outprefix=modified.,firstobs=1,obs=max);",
rows_in_sas_dsd,Data manipulation,"A sas function to return the total number of rows in a sas dataset, which can be assigned to a macro variable or used in sas data step.",rows_in_sas_dsd(test_dsd);,
sas2xls,Data manipulation,Export sas a dataset into an excel file.,"sas2xls ( file= , fileref= , sheet1=, sheet2=, sheet3=, sheet4=, sheet5= , sheet6=, sheet7=, sheet8=, sheet9=, sheet10= , sheet11=, sheet12=, sheet13=, sheet14=, sheet15= , sheet16=, sheet17=, sheet18=, sheet19=, sheet20= , sheet21=, sheet22=, sheet23=, sheet24=, sheet25= , sheet26=, sheet27=, sheet28=, sheet29=, sheet30= , sheet31=, sheet32=, sheet33=, sheet34=, sheet35= , sheet36=, sheet37=, sheet38=, sheet39=, sheet40= , sheet41=, sheet42=, sheet43=, sheet44=, sheet45= , sheet46=, sheet47=, sheet48=, sheet49=, sheet50= , perl= perl -w , deleteXML = 1 );",
scale4range,Data manipulation,Adjust values according to a new numeric range.,"scale4range(dsdin=, ids=, vars=, factor4mult=1, round_or_not=1, outdsd= );",
select_element_range_from_list,Data manipulation,Select elements in a list base on the query start and end positions.,"select_element_range_from_list(list,st,end,sublist,sep=\s);",
select_elems_range_from_dsd,Data manipulation,"This macro will generate a double quoted list within a specific numberic range for the function 'in' as a filtering in data step, and the final list will be saved into macro var(s) with specific prefix.","select_elems_range_from_dsd( dsdin=, keyvar=,/*var subjected for making list*/ split_by_fold=0,/*Provide value >1 to separate elements into different batches*/ st_num_in_list=,/*Provide start numeric position for the var to extract in the list*/ end_num_in_list=,/*Provide end numeric position to get the range of elements in the list*/ sort_var4key=,/*default is empty; supply a numberic or char var as the 2nd var along the macro var keyvar to get unique and sorted key elements to make the list for extraction*/ outmacrovarname_prefix=macro_sublist /*Prefix for making macro variables used later*/ );",incr_value2div_by_num select_element_range_from_list
shuffle_rows,Data manipulation,shuffle the row orders in proc sql using the rand function.,"shuffle_rows(dsdin,var,dsdout);",
split_wide_dsd,Data manipulation,Split a large wide dataset into small dataset containing a designed number of variables.,"split_wide_dsd( dsdin, dsdout_prefix, split_num4vars, dsdout4subdsd, delete_original_dsd=1);",
squeez_single_num_var_length,Data manipulation,"The target single variable in the dsdin will be squeezed, which means the output dsd would be the same as the dsdin","squeez_single_num_var_length( dsdin, /*Note: the var in the dsdin will be squeezed, which means the output dsd would be dsdin*/ var);",
startxl,Data manipulation,Start Microsoft Excel via DDE in Windows.,startxl;,
subset_bed,Data manipulation,"Retrive subset bed regions based on chr, start and end positions.","subset_bed(bed_dsd,bed_chr_var,bed_st_var,bed_end_var,query_chr,query_st,query_end,subbed_out,numeric_chr_in_bed_dsd);",
systran,Data manipulation,run StatTransfer to change a stat data into a sas dataset.,"systran(prog,pathin,pathout,dsname);",
tabulate4bins,Data manipulation,Generate frequency table using proc freq with bins created by proc format. Note: a group variable will be used to stratify the analysis.,"tabulate4bins(dsd,byids,target_var4bin,bins,dsdout);",numargs
tabulate4cutoff,Data manipulation,Generate frequency table using several value cutoff by a group variable. This macro can be used to estimate how many mutations passed a number of coverage cutoff.,"tabulate4cutoff(dsd,byids,target_var,target_cutoffs,step,dsdout,ge_or_le);",numargs
tolong,Data manipulation,Change wide format dataset to a long format dataset.,"tolong(widedata,longdata,id,suffix,suffixlo,suffixhi,vars,types=,lengths=,numprint=,quiet=);",
totobsindsd,Data manipulation,"A sas function to return the total number of rows in a sas dataset, which can be assigned to a macro variable or used in sas data step.",totobsindsd(mydata);,
towide,Data manipulation,Change a long format dataset into a wide-format dataset.,"towide(longdata,widedata,id,suffix,suffixlo,suffixhi,vars,types=,lengths=,numprint=,quiet=,sorted=);",
union,Data manipulation,Combine all dataset vertically by considering the different lengths of variables in multiple datasets.,"union(dsn1=, /*Name of the first data set */ dsn2=, /*Name of the second data set */ out= /*Name of combined data set */);",
union_add_tags,Data manipulation,Similar to the macro union but with an extra variable containing the dataset names added into the output dataset.,"union_add_tags(dsds=, /*Name of the datasets, separated by space */ out= /*Name of combined data set */);",
vars4where_in,Data manipulation,A sas function to generate where in condition for a list.,"vars4where_in(vars,sep);",
vars_length_dsd,Data manipulation,Get variable length and its total length,"vars_length_dsd(lib=work,dsd=,vars_rgx=,dsdout=,sum_vars_length=0,sum_vars_lengthoutvar=var_length_sum);",KeepColMatchingRgx
xl2sas,Data manipulation,Read excel file into a sas dataset.,"xl2sas(xlfile=, sheetname=, secswait=2, dsout=, compress=no, compbl=yes, left=yes, dropblanklines=yes, vpref=C, vlen=80, startrow=1, startcol=1, endrow=, endcol= );",
xls2txt,Data manipulation,Exchange a excel file into a text file.,"xls2txt(xlspath,getnames,txtoutpath);",
SQUEEZE_1,Data manipulation,Reduce variable lengths for saving disk space. Note: the macro is an updated version of macro SQUEEZE and used by other macro.,"SQUEEZE_1( DSNIN /* name of input SAS dataset */ , DSNOUT /* name of output SAS dataset */ , NOCOMPRESS= /* [optional] variables to be omitted from the minimum-length computation process */ );",
permute,Data manipulation,Get all combination by considering its order in the combinations of a list of elements and print it.,"permute(r) / parmbuff; /* the parmbuff option assigns */ %let i=2; /* the invocation parameter list to the */ %let things=; /* macro variable &syspbuff */ %do %while (%Qscan(&syspbuff,&i,%STR(,%))) ne ); /* scan the syspbuff */ %let p&i=""%Qscan(&syspbuff,&i,%STR(,%)))""; /* to determine r */ %if &i=2 %then %let things=&&p&i; /* and count the number */ %else %let things=&things,&&p&i; /* of elements, n */ %let i=%eval(&i+1);",
DEG4Microarray,Gene expression related functions,Perform differential gene expression using proc glm.,"DEG4Microarray( dsd=, /*Long format dsd for mixed procedure*/ class_vars2exld_eff=,/*vars for the 1st regression to exclude its as well as its interaction with other vars; so the list contains vars that are targeted for exclusion of effects and other vars may interact with it and the subsequent interaction effect need to be excluded! If it is empty, then the 1st regression model will not be run!*/ model_vars2exld_eff=, /*vars that included in the class_var22exld_eff but its main effect but not its interaction with other vars targeted for exclusion in the class_vars2exld_eff; this means that the main effect of the vars will NOT be excluded If it is empty, no need to run the 1st regression model to exclude these random effects!*/ resp_var=, /*response var, such as y*/ random_cmd=, /*NB: use random parameters with cautions, as it will complicted the model; provide the commands for the parameter random in the 1st regression model; it should include all the vars targeted for exclusion, as well as the interactions with other vars that are not subject to exclusion of main effects! It can be empty if class_vars2exld_eff is empty!*/ sort_vars4regdsd=, /*vars in order for sorting the outp dsd, which regressed out the effects of random vars ensure the 1st var is the one subject for differential expression analysis, such as gene id*/ class_vars4mixed=, /*vars for the class parameter in the mixed procedure*/ model_vars4mixed=, /*vars for testing fixed effects in the mixed model*/ random_vars4mixed=, /*Make sure the assumption of random vars are reasonable; it is not necessary to have complicated random parameters for the proc mixed procedure; vars as random and subject to exclusion of main effects; Other vars with interactions to these random vars should be included here but added into the fixed effect var list model_vars4mixed It can be empty if no random vars to be excluded for effects!*/ lsmeans_cmd=, /*provide the command for the parameter lsmeans to test the differential effect; It is usually the same as that of model_vars4mixed*/ outdsd4diff=diffs, /*dsd name for the output dsd containing differential expression statistics*/ outdsd4pred=rfir /*output dsd for predicted response values*/ );",
Barchart_color_template,Graphic function,Customize bar colors for different groups,"Barchart_color_template(colors,temp_out);",numargs
Bed4BlockGraph,Graphic function,"Merge bed fragments that overlapped with other by a group variable in a genomic region and plot final bed fragments in a block graph, which is similar to a gene track bar plot. Note: relative positions are used in the final block graph.","Bed4BlockGraph(dsdin,mindist,maxdist,chr,chr_var,st_var,end_var,dsdout,graph_wd,graph_ht,show_block_values);",MergerOverlappedRegInBed
Bed4BlockGraphByGrp,Graphic function,"Merge bed fragments that overlapped with other by a group variable in a genomic region and plot final bed fragments in different colors by the group variable in a block graph, which is similar to a gene track bar plot. Note: relative positions are used in the final block graph.","Bed4BlockGraphByGrp(dsdin,mindist,maxdist,chr,chr_var,st_var,end_var,dsdout,graph_wd,graph_ht,show_block_values,Grp);",Bed4BlockGraph MergerOverlappedRegInBed SingleDsd2MergedDsd4DiffGrps bed_block_complement4blockplot numargs
Biplot,Graphic function,"Biplots are two-dimensional plots that help to visualize relationships in high dimensional data.The biplot projects observations and variables onto the span of the first two principal components. The observations are plotted as markers; the variables are plotted as vectors. The observations and/or vectors are not usually on the same scale, so they need to be rescaled so that they fit on the same plot. There are four common scalings (GH, COV, JK, and SYM).","Biplot( data=_LAST_, /* Data set for Biplot */ var =_NUMERIC_, /* Variables for Biplot */ id =ID, /* Observation ID variable */ dim =2, /* Number of Biplot dimensions */ factype=SYM, /* Biplot factor type: GH, SYM, or JK */ scale=1, /* Scale factor for variable vectors */ out =BIPLOT, /* Output dataset: Biplot coordinates */ anno=BIANNO, /* Output dataset: annotate labels */ std=MEAN, /* How to standardize columns: NONE|MEAN|STD*/ pplot=YES); /* Produce printer plot? */ %let factype=%upcase(&factype);",
CloseSVG_Printer,Graphic function,"Close SVG printer in sas ods output system, which is supposed to be used after the executation of the macro OpenSVG_Printer.",CloseSVG_Printer;,
MergerOverlappedRegInBed,Graphic function,Merge overlapped regions in bed format sas datasets.,"MergerOverlappedRegInBed(bedin,chr_var,st_var,end_var,bedout);",
MutRegOverlappedBlock,Graphic function,"With the two sas datasets as input, including regulatory bed dataset and mutational region bed dataset, the macro makes regulatory region track at top and put mutation dot plots by sample at the bottom.","MutRegOverlappedBlock(block_dsdin ,block_chr_var ,block_st_var ,block_end_var ,chr ,mindist ,maxdist ,Mut_dsdin ,Mut_chr_var ,Mut_st_var ,mut_sample_var ,Final_dsdout ,block_filcolor ,block_filaltcolor ,dotsize ,dotcolor ,max_y ,add_sample_ref_line=0 ,graph_designwidth=400 ,sample_refline_pattern=solid ,ref_line_color=white );",AddRowNumber4Com_Vars Bed4BlockGraph MergerOverlappedRegInBed subset_bed
PrepareDsd4MutRegPlot,Graphic function,"Make mutation dot plots according to its correponding relative genomic positions, and group and color samples differentially in blocks.","PrepareDsd4MutRegPlot(dsd,pos_var,ID_var4yaxis,x_st4mut,x_end4mut,gr4color,pic_wd,pic_ht,dot_size,dsdout,seriesplot=0);",Barchart_color_template numargs ImportFilesInDSDbyScan RecSearchFiles2dsd FileOrDirExist get_filenames
SizeIt,Graphic function,Generates GOPTION HSIZE and VSIZE lengths given XMAX and YMAX from PROC GDEVICE. This macro corrects text and shape distortion that occurs when graphs are displayed through panels that do not conform to the aspect ratio defined by the relationship between XMAX and YMAX.,"SizeIt(Margin=0,ScaleX=1,ScaleY=1,NRows=,MaxNCol=,XMax=,YMax=);",
Tmplt,Graphic function,Generate a template for multiple plot displays. Also embed the TREPLAY macro so that it can be invoked as an option to replay plots lockstep through the newly generated template.,"Tmplt(Margin=0,ScaleX=1,ScaleY=1,XLateX=0,XLateY=0, R1= ,R2= ,R3= ,R4= ,R5= ,R6= ,R7= ,R8= , color=NONE,rotate=0,clip=OFF, igout=work.gseg,tc=tempcat,tname=TmpMac,Treplay=N);",
VennDiagram,Graphic function,Make two- or three-way Venn diagram.,"VennDiagram, OutDir=., title=Venn Diagram, set1label=, set2label=, set3label=, set1HoverText=, set2HoverText=, set3HoverText=, set12HoverText=, set13HoverText=, set23HoverText=, set123HoverText=, fontSize=4, setlabelFontSize=4, imgFmt=gif, valuesColor=white, bgColor=white, undef=0);",
_Lattice_gscatter_over_bed_track_,Graphic function,"Old version of the important macro Lattice_gscatter_over_bed_track, for backup purpose.",Probable confict between macro name and its sas filename,Lattice_gscatter_over_bed_track_ Check_VarnamesInDsd check_var_type delete_empty_dsd iscolallmissing make_fake_axis4NegPosVal_by_grps add_fake_pos_by_grp4nonnegvars totobsindsd make_fake_axis_values4grps ntokens number_rows_by_grp
axis_wall,Graphic function,"Make a new ods html style using proc template to modify background color, thickness of lines, linestyle, frameborder, contrastcolor, and others.",axis_wall;,
barplots_with_refline,Graphic function,Generate bar plots with standard error bars by putting bars with positive values upper and negative values under the reference line of 0. Note: the macro will use sas annotation function to draw bar plots.,"barplots_with_refline( dsdin, yaxis_var, errorbar_length=1, bar_width=5, errorbar_color=blue, bar_color=lightblue, grp_var=, sort_bar_var_by_mean=1,/*If value is 0, it will sort by grp_var alphabetically*/ yaxis_label=Mean of target variable );",
bed4seriesplot,Graphic function,Prepare bed format sas dataset for drawing bed tracks with proc sgplot statement series.,"bed4seriesplot(dsdin,chr_var,st_var,end_var,othervars4keep,dsdout);",
bed_block_complement4blockplot,Graphic function,Make a single bed track for bed regions and its complementary regions in different colors.,"bed_block_complement4blockplot( dsdin, chr_var, chr_value, st_var, end_var, dsdout, minst, maxend, generate_dsd_only, use_alternate_mode2fill_blocks=1 /*When the value is 1, it will use red and white color for bed regions and its complementary regions, respectively; Provide 0 to use multicolor to fill blocks*/ );",
bed_region_cnv_plot_sep_by_grp,Graphic function,"Draw each CNV region in a subtrack and stack plots vertically for all subtracks with different colors indicating the group memberships. Note: this macro is only for vasualization of CNVs less than 20, otherwise, the tracks would be too busy. Please use the macro bed_region_plot_by_grp to draw bed regions of the same group into a subtrack.","bed_region_cnv_plot_sep_by_grp(bed_dsd,chr_var,st_var,end_var,grp_var,cnv_var,linethickness=20);",
bed_region_plot_by_grp,Graphic function,"Draw bed regions in a sas dataset with its corresponding values by group in a vertical, stacked tracks.","bed_region_plot_by_grp( bed_dsd, chr_var, st_var, end_var, grp_var, yval_var, linethickness=20, track_width=800, track_height=400, dist2st_and_end=0 );",number_rows_by_grp
bed_region_plot_by_grp_splitted,Graphic function,This macro will make bed plot for each individual and color each bed region by group. It is similar to the macro bed_region_plot_by_grp but can draw multiple or single bed plot(s) for a sas dataset with or without individual level information.,"bed_region_plot_by_grp_splitted( bed_dsd, chr_var, st_var, end_var, grp_var,/*bed regions will be colored according to the group membership*/ val_var4bed_reg, indv_var,/*If empty, the macro will draw bed regions without considering individual information*/ inethickness=20 );",number_rows_by_grp
boxgrpdisplaysetting,Graphic function,"Generate optimized sas statements for drawing a prettier boxplot, which will be used by the plotting clause vbox of proc sgplot or sgpanl.",boxgrpdisplaysetting( boxwidth=0.8 );,
boxplot4gene,Graphic function,"Make boxplots by group, the colors of which are optimized for better visualization. Note: the 'gene' in the macro name is originally for drawing gene expression boxplot, but the macro can be used for any numeric data with group information.","boxplot4gene(dsdin,gene,grp=grp,genevar=gene);",
boxplotbygrp,Graphic function,"The updated macro from boxplot4gene, extending to draw boxplots for numeric data by group.","boxplotbygrp( dsdin=, grpvar=, valvar=, panelvars=, attrmap_dsd=, fig_height=600, fig_width=600, transparency=0.3, boxwidth=0.5, column_num=4 );",
circos,Graphic function,Create circos plots.,"CIRCOS will cease; %goto errhandl; %end; /**Convert starting degrees to radians**/ %let start=(&start/180)*constant(""pi"");",
circos,Graphic function,Create circos plots.,"CIRCOS will cease; %goto errhandl; %end; alter table _temp modify %if %sysevalf(%superq(before_group)^=,boolean) %then %do; _before_group_ char(&_grouplength) %end; %if %sysevalf(%superq(before_group)^=,boolean) and %sysevalf(%superq(after_group)^=,boolean) %then %do; , %end; %if %sysevalf(%superq(after_group)^=,boolean) %then %do; _after_group_ char(&_grouplength) %end;; %if %sysevalf(%superq(grouporder)^=,boolean) %then %do; update _temp set %if %sysevalf(%superq(before_group)^=,boolean) %then %do; _before_group_lvl=case(_before_group_) %do i = 1 %to %sysfunc(countw(%superq(_grouplvls),|,m));",
circos,Graphic function,Create circos plots.,"CIRCOS will cease; %goto errhandl; %end; update _temp set _before_lvl=case(_before_) %do i=1 %to &nlevels; %if %sysevalf(%superq(order)^=,boolean) %then %do; when ""%qscan(%superq(prelevels),%scan(%superq(order),&i,%str( )),|,m)"" then &i %end; %else %do; when ""%qscan(%superq(prelevels),&i,|,m)"" then &i %end; %end; else . end, _after_lvl=case(_after_) %do i=1 %to &nlevels; %if %sysevalf(%superq(order)^=,boolean) %then %do; when ""%qscan(%superq(prelevels),%scan(%superq(order),&i,%str( )),|,m)"" then &i %end; %else %do; when ""%qscan(%superq(prelevels),&i,|,m)"" then &i %end; %end; else . end; /**Sort by Group levels**/ %local i; %if %sysevalf(%superq(before_group)^=,boolean) or %sysevalf(%superq(after_group)^=,boolean) %then %do; /**Sort values**/ data _glevels; %if &_typematch1=1 %then %do; set %if %sysevalf(%superq(before_group)^=,boolean) %then %do; _temp (keep=_before_group_ _before_group_t rename=(_before_group_=_levels_ _before_group_t=_levels_t)) %end; %if %sysevalf(%superq(after_group)^=,boolean) %then %do; _temp (keep=_after_group_ _after_group_t rename=(_after_group_=_levels_ _after_group_t=_levels_t)) %end;; format _levels_t; %end; %else %do; set %if %sysevalf(%superq(before_group)^=,boolean) %then %do; _temp (keep=_before_group_ rename=(_before_group_=_levels_)) %end; %if %sysevalf(%superq(after_group)^=,boolean) %then %do; _temp (keep=_after_group_ rename=(_after_group_=_levels_)) %end;; %end; run; data blah;set _glevels;run; proc sort data=_glevels nodupkey; by _levels_; run; %if &_typematch1=1 %then %do; proc sort data=_glevels; by _levels_t; run; %end; proc sql; %local _grouplvls _ngroups _grouplength; select _levels_ into :_grouplvls separated by '|' from _glevels; %let _ngroups=%sysfunc(countw(%superq(_grouplvls),|));",
circos,Graphic function,Create circos plots.,"circos( /*1.0: Required Parameters*/ data=,before=,after=, /*2.0: Optional Parameters*/ /**2.1: Plot Options**/ /***2.1.1: Fill Color Options***/ color=,unique_group_colors=0,transparency=0.5, /***2.1.2: Title Options***/ title=,titlesize=12pt,titleweight=bold,titlealign=center, /***2.1.3: Label Options***/ labelsize=12pt,labelweight=normal, /***2.1.4: Outer Circle Options***/ groupgap=0.05,barwidth=0.05,innergap=0.025, start=270,direction=CW,points=10, order=,grouporder=, /**2.2: Subsetting Options**/ /***2.2.1: Subset Input Dataset***/ where=, /***2.2.2: Group Before/After Values***/ before_group=,after_group=, /**2.3: Image Options**/ antialias=100000,axiscolor=black,border=0,gpath=,background=white,dpi=200, plotname=_circos,plottype=png, height=6in,width=6in, fontcolor=black,svg=1,tiffdevice=TIFFP,transparent=0, /**2.4: Document Options**/ destination=PDF,outdoc=,orientation=portrait, /**2.5: Output Plot Data**/ out=);",
clustergram4longformatdsd,Graphic function,Generate clustergram heatmap for a input sas dataset in longformat.,"clustergram4longformatdsd( /*The limitation of clustergram4longformatdsd compared to clustergram4sas is that the orders of two axes of final heatmap is sorted by varnames if not clustered, as this macro will sort the long format data by rowname_var and colname_var, and then tranpose it for cluster if either one of them is subjected to clustering! Thus please use clustergram4sas whenever it is possible; see demos for clustergram4sas, which include all possible scenarios! */ dsdin=_last_,/*The input dataset is a matrix contains rownames and other numeric columns*/ rowname_var=,/*the elements of rowname_var will be used to label heatmap columns*/ colname_var=,/*These column-wide names will be used to label heatmap rowlabels*/ value_var=,/*numeric data for heatmap cells*/ height= ,/*figure height in cm, such as 20; if empty, it will use the number of rownames * 0.8 as height*/ width= ,/*figure width in cm, such as 24; if empty, it will use the number of colnames * 0.5 as width*/ columnweights=0.05 0.95, /*figure 2 column ratio*/ rowweights=0.15 0.85, /*figure 2 row ratio*/ cluster_type=3, /*values are 0, 1, 2, and 3 for not clustering heatmap, clustering heatmap by column, row, and both*/ colormodel=cxFAFBFE cx667FA2 cxD05B5B, /*Default is blue grey red heatmap; Use different color names here to draw heatmap, such as yellow blue green red */ fig_outputfmt=png /*output figure formats: svg, jpg, png, and other sas ods supported figure formats*/ );",
clustergram4sas,Graphic function,"Generate clustergram heatmap for a input sas dataset in wideformat. If requiring the rownames unclustered and in a specific order in the heatmap, the two macros, including check_col_orders and pull_column, can be used to presort the sas dataset for the rownames. Note: the final column names will be used as rownames in the heatmap and the columns indicating the rownames of the sas dataset will be used as labels for columns of the heatmap.",clustergram4sas with customized axis order; proc sort data=a;by a b;run; proc transpose data=a out=a_trans(drop=_name_);,
clustergram4sas,Graphic function,"Generate clustergram heatmap for a input sas dataset in wideformat. If requiring the rownames unclustered and in a specific order in the heatmap, the two macros, including check_col_orders and pull_column, can be used to presort the sas dataset for the rownames. Note: the final column names will be used as rownames in the heatmap and the columns indicating the rownames of the sas dataset will be used as labels for columns of the heatmap.","clustergram4sas( /*The final rowlabels of the heatmap can be customized when not clustering the final rowlabels by pre-sorting the numeric_var names with two macros: check_col_orders and pull_column */ dsdin=_last_,/*The input dataset is a matrix contains rownames and other numeric columns*/ rowname_var=,/*the elements of rowname_var will be used to label heatmap columns*/ numeric_vars=_numeric_,/*These column-wide numeric vars will become row-wide in the heatmap*/ height=20,/*figure height in cm*/ width=24,/*figure width in cm*/ columnweights=0.15 0.85, /*figure 2 column ratio*/ rowweights=0.15 0.85, /*figure 2 row ratio*/ cluster_type=3, /*values are 0, 1, 2, and 3 for not clustering heatmap, clustering heatmap by column, row, and both*/ outputfmt=png );",
delgcat,Graphic function,"Delete all entries from the graphics catalog specified, which is parts of the sas macro to simplify multiple-plot displays written by Perry Watts.",delgcat(CatName);,
dotplot,Graphic function,"Make dot plot for a input sas dataset, with y-axis displaying the character variable and x-axis showing the value of the character variable. It is customizable for adding lines to separate the character variables on y-axis into different categories. It can be used to draw forest-plot for GWAS effect size.","dotplot( data=_LAST_, /* input data set */ xvar=, /* horizontal variable (response) */ xorder=, /* plotting range of response */ xref=, /* reference lines for response variable */ yvar=, /* vertical variable (observation label) */ ysortby=&xvar, /* how to sort observations */ ylabel=, /* label for y variable */ group=, /* vertical grouping variable */ gpfmt=, /* format for printing group variable */ /* value (include the . at the end) */ connect=DOT, /* draw lines to ZERO, DOT, AXIS, or NONE */ dline=2, /* style of horizontal lines */ dcolor=BLACK, /* color of horizontal lines */ errbar=, /* variable giving length of error bar */ /* for each observation */ errbar_size=0.25, /*adjust the number to increase or reduce error bar size*/ dot_symbol=dot,/*Other symbols, including square, diamond, triangle, or other sas accept symbols; /*customized text with single or double quotes such as '+' is also applicable*/ dot_symbol_color=darkgreen, fig_width=600, /*Figure width in pixel*/ fig_height=600,/*Figure height in pixel*/ name=DOTPLOT); /* Name for graphic catalog entry */ %if &yvar= %str() %then %do; %put DOTPLOT: Must specify y variable; %goto ENDDOT; %end; %let connect=%upcase(&connect);",
figureit,Graphic function,"Add the two figures/numbers using different parameters of sysevalf, including default, boolean, ceil, floor, and integer. Note: no macro variables will be created but the results generated using different sysevalf parameters will be printed in the log window.","figureit(a,b);",
gnomad4proteinpaint,Graphic function,Transform gnomad variant file downloaded from gnomad database to draw these variants along with protein domains using the visualization software ProteinPaint.,"gnomad4proteinpaint(dir4gnomadcsv,gnomadcsv);",
heatmap4longformatdsd,Graphic function,Make heatmap for longformat sas dataset.,"heatmap4longformatdsd( /*Note: the easiest way to sort the x and y axis with customized order is to pre-sort the dsdin according to specific xgrpvar and ygrpvar in user customized order i.e.: proc sort data=dsdin;by xgrpvar ygrpvar;run; These two grp vars can be generated by proc sql with specific conditions;*/ dsdin, xvar, yvar, colorvar, fig_height, fig_width, outline_thickness=0,/*Provide number > 0 to add white outline to separate each cell in heatmap*/ user_yvarfmt=, /*default is to not use format*/ user_xvarfmt=, /*default is to not use format*/ colorbar_position=right,/*left, right, top, or bottom for gradlegend*/ colorrange=blue green red, /*color range used for heatmap*/ yfont_style=normal, /*normal or italic for yaxis font type*/ xfont_style=Italic, /*normal or italic for xaxis font type*/ NotDrawYaxisLabels=0, /*Remove Yaxis labels when there are too many groups for y axis*/ NotDrawXaxisLabels=0, /*Remove Xaxis labels when there are too many groups for x axis*/ heatmap_fmt=png /*generate svg or png heatmap*/ );",getdsdvarsfmt
histogram_in_svg,Graphic function,Make histogram and output figure in SVG format.,"histogram_in_svg(dsd,numvars,scale=1);",get_num_or_char_vars4dsd
longformdsd4heatmap,Graphic function,Draw heatmap for a longformat dataset.,"longformdsd4heatmap( /*Compared to the macro heatmap4longformatdsd, this macro may not be good enough! whenever possible, please use the heatmap4longformatdsd! The macro is kept for code reusing purpose!*/ dsdin, row_var, col_var, value_var, value_upperthres, Newvalue4upper, value_lowerthres, Newvalue4lower, cluster, srtbyrow, srtbycol, htmap_colwgt, htmap_rowwgt, dsdout );",Scaleup_nrow_ncol longdsd2matlabmatrix matrix4cluster
matrix4cluster,Graphic function,Prepare a sas dataset in matrix format into clustering analysis required input data.,"matrix4cluster(dsdin, distance_method, dist_matrix_out, dendrogram_out, cluster_method, id_var4cluster, numeric_vars );",
scatter_over_bed_track,Graphic function,Draw a scatter plot over a bed track.,"scatter_over_bed_track( bed_dsd, chr_var, st_var, end_var, grp_var, yval_var, yaxis_label=Group, linethickness=20, track_width=800, track_height=400, dist2st_and_end=0, dotsize=10 );",delete_empty_dsd iscolallmissing number_rows_by_grp
venn,Graphic function,Generate two- or three-way veen-diagram,"venn( data = ,venn_diagram = /* Select whether you want a 2 Way, 3 Way or 4 Way Venn Diagram EG for 2 way enter 2. Valid values are 2,3 and 4 */ ,cutoff = /* Set the P Value cut-off or any other appropriate cut off Valid values are the right hand side of an if statement */ ,GroupA = /* Define group name 1, mandatory */ ,GroupB = /* Define group name 2, mandatory */ ,GroupC = /* Define group name 3, mandatory for 3 and 4 way diagrams */ ,GroupD = /* Define group name 4, mandatory for 4 way diagrams */ ,out_location = /* Define the path for all output files e.g. C:/Venn Diagrams */ ,outputfilename = Venn diagram /* Define the filename for the graphic file */ ,drilldownfilename = Drilldown /* Define the filename for the drill down data file */ );",
violinPlot,Graphic function,Make violin plot.,"violinPlot (data = ,outcomeVar = ,groupVar = ,panelVar = ,byVar = ,outPath = . ,outName = violinPlot ,widthMultiplier = 1 ,jitterYN = Yes ,quartileYN = Yes ,quartileSymbolsYN = No ,meanYN = Yes ,trendLineYN = Yes ,trendStatistic = Median ) / minoperator; %if &data = %then %goto exit; %if &outcomeVar = %then %goto exit; %if &widthMultiplier = %then %let widthMuliplier = 1; /*--------------------------------------------------------------------------------------------\ Data manipulation \--------------------------------------------------------------------------------------------*/ data _inputData_; set &data ( keep = &byVar &panelVar &groupVar &outcomeVar where = (&outcomeVar gt .z));",
DIRLISTWIN,Other utilities,List files or directories in Windows sytem.,"DIRLISTWIN( PATH /* Windows path of directory to examine */ , MAXDATE= /* [optional] maximum date/time of file to report */ , MINDATE= /* [optional] minimum date/time of file to report */ , MAXSIZE= /* [optional] maximum size of file to report (bytes) */ , MINSIZE= /* [optional] minimum size of file to report (bytes) */ , OUT= /* [optional] name of output file containing results of %DIRLISTWIN */ , REPORT=Y /* [optional] flag controlling report creation */ , REPORT1=N /* [optional] flag controlling 1-line report creation */ , SUBDIR=Y /* [optional] include subdirectories in directory processing */ ) ;",
DirRecursiveSearch,Other utilities,Search files recursively under a directory.,"DirRecursiveSearch(/*It will use SAS internal functions to search dir recursively*/ root_path=_NONE_,/*All dirs under it will be searched recursively*/ lev=0, SR_Files_lev0=Y );",
FileAttribs,Other utilities,get file size in Mb.,FileAttribs(filename);,
FileOrDirExist,Other utilities,Determine the existence of a file or directory.,FileOrDirExist(dir) ;,
GetCWD,Other utilities,Get current running script's directory in Windows.,GetCWD;,
GetZIPContents,Other utilities,Import file contained in a zip file into sas as a dataset.,"GetZIPContents(zip,dsdout);",
Make_Quote_Var_List_From_Dsd,Other utilities,Make a global macro variable quoted_var_list to contain the uniuqe elements with quotes of a variable in a sas dataset.,"Make_Quote_Var_List_From_Dsd(indsd,var,sep);",
RecSearchFiles2dsd,Other utilities,"Recursively search files included in a directory and its subdirectories with a customized Perl script, thus the system needs to have Perl installed and x command of sas should be turned on. Note: this macro is not suitable for SAS OnDemand for Academics.","RecSearchFiles2dsd root_path => Searching directory path filter => perl rgx to match specific files; . will match all files perlfuncpath => perl script RecursiveSearchDir4SAS.pl path outdsd => sas output dataset name outputfullfilepath => 0: only filenames will be output, otherwise let it be 1 or missing; */ /*option mprint mlogic symbolgen;*/ /* %RecSearchFiles2dsd( root_path=F:/360yunpan/SASCodesLibrary/SAS-Useful-Codes, filter=.sas$, perlfuncpath=F:/360yunpan/SASCodesLibrary/SAS-Useful-Codes, outdsd=m, outputfullfilepath=1);",FileOrDirExist
RecSearchFiles2dsd,Other utilities,"Recursively search files included in a directory and its subdirectories with a customized Perl script, thus the system needs to have Perl installed and x command of sas should be turned on. Note: this macro is not suitable for SAS OnDemand for Academics.","RecSearchFiles2dsd(root_path,filter,perlfuncpath,outdsd,outputfullfilepath);",FileOrDirExist
RecSearchFilesPureSAS,Other utilities,Use pure sas language to search files recurvisely in a directory as well as its subdirectories.,"RecSearchFilesPureSAS( root_path=., filter=., outdsd=files );",
RetrieveCurrentProgramFileName,Other utilities,"Retrieve current program filename, working in both Linux and Windows systems.",Probable confict between macro name and its sas filename,
RetrieveCurrentProgramFilePathName,Other utilities,"Retrieve current program pathname, working in both Linux and Windows systems.",Probable confict between macro name and its sas filename,
RunMacrosRepeatedly,Other utilities,Run a specific macro repeatedly by supplying different macro parameters in a sas dataset.,"RusRepeatedly(Mvar_dsd,MvarFullCommand);",
Zip4Windows,Other utilities,Run Windows 7zip to compress a file or directory into a zip file.,"Zip4Windows(Dir_or_files,out7z);",
ZipFolder4AllFiles,Other utilities,Run Windows 7zip to compress all files in a folder into a zip file.,"ZipFolder4AllFiles(target_dir,outzip,outdir,rgx2keep_file=.);",list_files2globalvar
abort_when_file_not_exit,Other utilities,Check whether the expected file exists or not and stop the running macro when the file is not there or generated.,abort_when_file_not_exit(filepath);,FileOrDirExist
catx_macro_varlist,Other utilities,Generate a global macro variable 'list' to contain the concatenated variable list with specific separator. Note: the input variable list is separated by a blank space.,"catx_varlist(list,sep); %let re=%sysfunc(prxparse(s/ /&sep/oi));",
chdir,Other utilities,chdir in Windows or Linux sas.,chdir(dir);,
checkds,Other utilities,Check the existence of a sas dataset and return a global macro variable dsd_exist to indicate whether the sas datset is there (Yes=1 and No=0).,checkds(dsn);,
chg_cwd,Other utilities,"change directory and run an extra command in Windows or Linux. This macro can not be used in SAS OnDemand for Academics, as the x command feature is turned off.","chg_cwd(pwd,cmd);",file_list
combination,Other utilities,"Gereate a sas dataset containing all possible combination of n input items as sas macro parameters separated by comma, which is captaured by parabuff and saved into a sas internal macro variable sysbuff.",combination(r);,
combo,Other utilities,The backup version of the macro combination but with different name as combo.,combo(r);,
cp,Other utilities,copy files from a directory to a new directory and name it.,"cp(f,fdir,out,outdir);",
cp_files_in_dsd,Other utilities,copy files with its names supplied by a sas dataset into a new directory or into the same directory by adding a new file tag.,"cp_files_in_dsd(dsd,filevar,indir,outdir,newfiletag);",
curdir,Other utilities,"A sas function to return current physical directory, which can be assigned to a macro variable.",curdir;,
dbquote_vars,Other utilities,Modify macro variable by adding double quotes to each element separated by a blank space. The output can be directly used with squares for the where cluase in filtering data.,dbquote_vars(vars);,
debug_macro,Other utilities,Initiate macro debugging mode.,debug( undebug=0 /*give 1 to reset macro debugging parameters;*/ );,
delmacrovars,Other utilities,Delete all macro variables matching with a input regular expression.,devars_var_rgx); data vars; set sashelp.vmacro; run; data _null_; set vars; temp=lag(name);,
delvars,Other utilities,Delete all non-system macro variables,delvars;,
dircopy,Other utilities,Copy all files in a directory to a new directory.,"dircopy(inpath,outpath);",
direxist,Other utilities,A sas function to return numer 1 or 0 to indicate the existence of a directory (Yes=1 and No=0).,direxist /*---------------------------------------------------------------------- Test if directory exists ----------------------------------------------------------------------*/ (path /* Name of directory to test for existance */ );,
dwn_http_file,Other utilities,download plain or compressed file via a web http link.,"dwn_http_file(httpfile_url,outfile,outdir);",
file_list,Other utilities,"Return a file list for all files in a directory, which can be used by data step directory. Note: the fixed file separator is '|'.","file_list(iPath=, iFilter=, iFiles_only=0, iDelimiter=|);",
get_all_sas_macros,Other utilities,A wrapper to search for all macros and its corresponding submacros in a sas macro directory.,"get_all_sass( macro_dir=H:\F_Queens\360yunpan\SASCodesLibrary\SAS-Useful-Codes\Macros, outdsd=files );",RecSearchFilesPureSAS
get_filenames,Other utilities,"For a input directory, get filenames matching with a input regular expression using sas data step functions, including dopen, dnum, dread, and dclose. A sas dataset with these filenames will be created.","get_filenames(location=,dsd_out=filenames,match_rgx=);",
get_macros_used_by_macro,Other utilities,get macros used by other macros in a directory.,"gets_used_by(/*This may run endlessly when the include its name without the Demo tag*/ macrorgx=.,/*No need to include \.sas, as the macro will only keep sas script having prefix matching with the macrorgx!*/ dir=%sysfunc(pathname(HOME))/Macros ~/shared/Macros /home/zcheng/SAS-Useful-Codes/Macros F:/360yunpan/SASCodesLibrary/SAS-Useful-Codes/Macros /home/zhongshan/SAS-Useful-Codes/Macros , outdsd=macros, verbose=0, IsSASOnDemand=0 );",
get_macros_used_by_macro_old,Other utilities,a backup of the macro get_macros_used_by_macro.,"gets_used_by_old( macrorgx=., dir=%sysfunc(pathname(HOME))/Macros ~/shared/Macros /home/zcheng/SAS-Useful-Codes/Macros F:/360yunpan/SASCodesLibrary/SAS-Useful-Codes/Macros /home/zhongshan/SAS-Useful-Codes/Macros , outdsd=macros, verbose=0, IsSASOnDemand=0 );",FileOrDirExist list_files4dsd del_file_with_fullpath list_files
getdsdvarsfmt,Other utilities,Use proc contents to obtain variable format and output them into a new sas dataset.,"getdsdvarsfmt(dsdin,fmtdsdout);",
getsystemseparator,Other utilities,"A sas function to get system specific separator, such as '\' for Windows and '/' for Linux.",getsystemseparator;,
importallmacros,Other utilities,Import all macros in Linux system.,"importals(/*Note: multiple dirs can only be separated by blank space and put in a single line!*/ MacroDir=/zcheng/Macros ~/shared/Macros ~/SAS-Useful-Codes/Macros /LocalDisks/F/360yunpan/SASCodesLibrary/SAS-Useful-Codes/Macros, fileRgx=.sas, verbose=0);",
importmacroslinux,Other utilities,Import sas macros in Linux system.,"imporslinux; %let MacroDir=/project/fas/gelernter/zc254/SAS/SAS-Useful-Codes/Macros; %include ""&MacroDir/ImportAllMacros.sas""; %ImportAllMacros(MacroDir=&MacroDir,filergx=.*);",
initcaps,Other utilities,A sas function to make the initial alphabet in uppercase for all words in a list and return a new list that can be asigned to a macro variable or used in data step.,initcaps(title);,
isDir,Other utilities,"A sas function to check whether the directory exist or not and return a value 1 or 0, which can be assigned to a macro variable or used in data step.","isDir(iPath=,iQuiet=1);",
linuxtest,Other utilities,"A macro to test whether the macro has been included into sas environment. If it prints the first 10 records from the sashelp.cars dataset, it indicates that the computer system has load all users macros.",linuxtest;,
list_files,Other utilities,"Use proc printto to output listed files in a directory to a specific file, which can be used by the macro del_file_with_fullpath to delete all of these files. Note: the macro can only search files in a directory and its one-level subdirectory. For other deeper level subdirectories, the macro can not list files there.","list_files(dir,file_rgx);",del_file_with_fullpath
list_files2globalvar,Other utilities,Create a global macro variable to hold the values of files matching with specific regular expression in a directory.,"list_files2globalvar(dir,file_rgx,filelistvar);",
list_files4dsd,Other utilities,Create a sas dataset to contain the file names matching with a specific regular expression in a directory.,"list_files4dsd(dir,file_rgx,dsdout);",del_file_with_fullpath list_files
list_sasautos,Other utilities,Lists the .sas files and catalog source/macro objects found within directories surfaced in a sas library. This macro is very helpful to check these loaded macros in the sasautos.,"list_sasautos(help,work=Y);",
listautos,Other utilities,List all sas macro autos paths and print them in the log window.,listautos;,
makefile,Other utilities,"A macro to efficient exporting data into a file with specific parameters to customize the export, in terms of separator, quotation, and exclusion of variable labels. Note: this macro use data step file statement with a special function +(-1) to avoid of axtra spaces that is usually generated by file statment.","makefile ( dataset=_last_ , /* Dataset to write */ filename=print , /* File to write to */ dlmr="","" , /* Delimiter between values */ qtes=""no"" , /* Should SAS quote all character variables? */ header=""no"" , /* Do you want a header line w/ column names? */ label=""no"" /* Should labels be used instead of var names in header? */ );",
match_elements_in_macro_list,Other utilities,extract elememts from a macro variable matching or unmatching a regular expression and generate a new macro variable to contain these elements.,"match_elements_in_list( macro_list=,/*elements should be separated by blank space*/ rgx4match=,/*regular expression of prxmatch, such as (rgx1|rgx2)*/ reversematch=0,/*provide 0 to keep elements not matched with the rgx*/ output_idx=0, /*Instead of keeping matched or unmatched elements, keep the 1-based indices for these elements in the original macro_list, which would be useful to be transformed into a sas data set by the macro for further analysis!*/ new_macro_list_var=newlist /*a new global macro var containing the final output*/ );",
mk_dbquote_varlist,Other utilities,Make double quated variable list separated by a specific delimiter and create a new macro variable list.,"mk_dbquote_varlist(vars_list,sep,output_separator);",
mkdir,Other utilities,Make multiple level directories in Windows or Linux system.,mkdir(dir);,
multi_sysparm,Other utilities,"This macro enables other macros or sas scripts to accept parameters via the sysparm function when running these sas scripts in batch mode. Note: it will generate macro codes to assign input value to each macro variable, and then these macro variable can be used by these macros or sas script.",multi_sysparm;,
newdatasetname,Other utilities,"A macro function to generate noexist dataset name that can be used for naming a dataset, and return the name.",newdatasetname(proposalname);,
ntokens,Other utilities,Determine the number of elements in a macro variable.,ntokens(list);,
numargs,Other utilities,Similar to ntokens for calculating the total number of elements in a macro variable.,numargs(arg);,
pgmname,Other utilities,Create a global macro variable pgmname to hold the name of current running sas script.,pgmname;,
pgmpathname,Other utilities,Create a global macro variable pgmpathname to hold the directory containing the current running sas script.,pgmpathname;,
print_nicer,Other utilities,"A macro to enhance the output of proc print by adding optimized parameters, resulting in a prettier outlook of the output in the ods html.","print_nicer( fontsize=12, fontcol=dark );",
print_text_as_title,Other utilities,"Print test strings as a title, which can be used to arbitrarily separate results from different analyses.",print_text_as_title( text=%str(Put your text here to print.) );,
recursiveDelete,Other utilities,"Recursively delete files or directories in a system using a Perl script, thus the system need to have the Perl script and Perl is installed.","recursiveDelete(root_path=_NONE_,lev=0,rmFiles_lev0=Y);",
recursivesearchdirs,Other utilities,Recusively search files in a directory.,"recursivesearchdirs(/*It will run the perl script RecursiveSearchDir.pl in terminal!*/ dirs=~/shared/Macros ~/SAS-Useful-codes, filergx=., out=files );",
trunc_dsdname,Other utilities,A sas function to return a proposed sas dataset name with its length in the range of 1 to 32.,"trunc_dsdname(dsdname,st_substr=1); /*Make sas data name in the range of 1 to 32*/ /*dsdname can not contain more than 32 chracters;*/ /*Revised it accordingly;*/ %if &st_substr<%length(&dsdname) %then %do; %let dsdname=%sysfunc(prxchange(s/\W+/_/,-1,&dsdname));",
Proc Printto output log to sepecific file demo,Other utilities,Demo of proc printto.,Probable confict between macro name and its sas filename,Make_Proc_Import_Code File_Head
SASZip_Lite,Other utilities,Compress files in a directories.,"SASZip_Lite(zip=, sfdr=, fstyl=, tfdr=);",
get_anno4macro,Other utilities,Print sas macro annotations.,"get_anno( macro_rgx=., anno_rgx=, macro_dir=%sysfunc(pathname(HOME))/Macros/ );",
get_macros_used_by_macro_orig,Other utilities,"Get submacros used by macros, which is not updated, thus just for backup and learning purpose.","gets_used_by_orig(/*This may run endlessly when the include its name without the Demo tag*/ macrorgx=., dir=%sysfunc(pathname(HOME))/Macros ~/shared/Macros /home/zcheng/SAS-Useful-Codes/Macros F:/360yunpan/SASCodesLibrary/SAS-Useful-Codes/Macros /home/zhongshan/SAS-Useful-Codes/Macros , outdsd=macros, verbose=0, IsSASOnDemand=0 );",
parse_macro_paras,Other utilities,Get macro parameters for a macro.,"parse_paras_filepath,dsdout); data &dsdout; infile ""&macro_filepath"" lrecl=10000 obs=max; input; Macro_Info=_infile_; run; /**Print macro with specific style;*/ /*title ""Contents of first &numlines2print lines of SAS macro: &macro_filepath"";*/ /*proc print data=_macros_ noobs;*/ /*var Macro_Info/style =[width=15in] */ /* style(data)=[font_face=arial font_weight=bold foreground=darkblue background=cxedf2f9 font_size=10pt];*/ /**background=linen;*/ /*label Macro_Info=""SAS Macro information"";*/ /*run;*/ /*run;*/ *Output macro parameters as a sas data set; %let _macro_=%sysfunc(prxchange(s/.*[\/\\]([^\/\\]+).sas/$1/i,-1,&macro_filepath));",
parse_macro_used_macros,Other utilities,Parse macro used submacros.,"parse_useds_filepath,dsdout); data &dsdout; retain macro_i 0; length file $1000. Macro_Info $1000.; infile ""&macro_filepath"" lrecl=10000 obs=max; input; Macro_Info=_infile_; x=Macro_info; *It is important to stop the processing when encounter these Demo codes; if prxmatch(""/Demo/i"",Macro_Info) then stop; file=""&macro_filepath""; *Use regex to parse lines in macro for submacros used by the macro; if prxmatch(""/^(\s)?\%([^\(])+\(/i"",Macro_Info) then do; /* call symputx('_macrodir_',trim(left(prxchange(""s/(^.*[\/\\])[^\/\\]+.sas/$1/i"",-1,file))));*/ file=scan(file,-2,'/.\');",
unique,Other utilities,A macro function to get unique elements in a list.,unique;,
AdjDupsInBim,Plink related functions,Detect SNPs with the same chromosomal position and update SNP IDs in a plink BIM file. This will enable the plink bed data can be merged with other plink bed without errors.,"AdjDupsInBim(BimFullpath,BimSep);",
Bim2Annovar,Plink related functions,"Import plink bim file and annotate SNPs using ANNOVAR, which requires Perl installed in the system.","Bim2Annovar(bim_fullpath,dsdout,annovar_input,annovar_dir,annovar_outdir);",
DoseVCF2Plink,Plink related functions,Transform dosage VCF file for plink format data.,"DoseVCF2Plink(DoseVCF,GP,PlinkOut);",
Extract1KG_Genos,Plink related functions,"Extract 1KG genotype data based on filters, such as sample list and minor allele frequency. This macro is only works in Windows and requires to have 1KG plink format bed files available in a directory.","Extract1KG_Genos( OneKG_Path,/*Use forward slish and No slish at the end*/ maf, SubsetSamplesFile, Outdir /*Use forward slish and No slish at the end*/ );",FileOrDirExist get_filenames
GWAS_Merge_1KG,Plink related functions,Merge user's GWAS plink bed format data to be merged with the 1KG plink bed data. The 1KG plink bed data should be located in a directory and split by chromosome.,"GWAS_Merge_1KG( OneKG_Path, OneKG_Pop, PLINK_EXE, WorkDir, User_Imput_GWAS );",CompareGenoA1A2 Import_Space_Separated_File MergePlinkBeds AdjDupsInBim FileOrDirExist RmATGC4PlinkBed RmDups4PlinkBed delete_all_Appdx_files_in_folder OneKG_Assemble ImportAllFilesInDirbyScan get_filenames abort_when_file_not_exit del_files_in_dsd
GetMinorAllele,Plink related functions,Determine allele frequency and find the minor allele in a sas dataset of SNP genotype.,"GetMinorAllele(dsdin,geno_var,dsdout);",
ImportSinglePed,Plink related functions,Import plink Ped file into a sas dataset.,"ImportSinglePed(PedFile,outdsd,sep);",GetMinorAllele UniHetGeno char2num_dsd
MergePlinkBeds,Plink related functions,Merge multiple plink bed files into a single plink bed file.,"MergePlinkBeds(Plink_EXE,BaseBed,OtherBed2Merge,OutBed,DelTmpFiles);",AdjDupsInBim FileOrDirExist RmATGC4PlinkBed Import_Space_Separated_File RmDups4PlinkBed delete_all_Appdx_files_in_folder
OneKG_Assemble,Plink related functions,A pink wrapper to assemble 1KG plink bed files of 24 chromosomes into a single bed file. Note: only SNPs but not indel will be kept.,"OneKG_Assemble( PLINK_EXE, BED_dsd, OneKG_Path, WorkDir, SNP_File, KeepIDsFile, extra_plink_cmd, OutBed );",ImportAllFilesInDirbyScan get_filenames
RmATGC4PlinkBed,Plink related functions,"Remove SNPs with two alleles such as A->T or G->C or T->A or C->G, as these alleles can not be guessed by plink when merging two plink bed files for these SNPs. Note: the input file is a plink bed file prefix only, which means no appendix such as '.bim' is necessary.","RmATGC4PlinkBed(PlinkBed,NewPlinkBed,Plink_EXE=plink1.9.exe);",Import_Space_Separated_File
RmDups4PlinkBed,Plink related functions,Run plink to only keep unique SNPs in a plink bed file. Note: this macro requires to have X command turn on for sas.,"RmDups4PlinkBed(Plink_EXE,PlinkBed,OutBed);",
import_all_bims,Plink related functions,Import all plink bim files from a directory.,"import_all_bims( dir=., outdsd=all_bims, debug=0 );",get_filenames
import_fam,Plink related functions,Import a plink fam file into sas.,"import_fam(file,out);",
import_plink_ped,Plink related functions,Import plink format ped file.,"import_plink_ped( pedfile=, out=x );",
plink_chr_beds_merge,Plink related functions,Merge plink bed files of all chromosomes.,"plink_chr_beds_merge( PLINK_EXE, BED_dsd, plink_chr_beds_path, WorkDir, SNP_File, KeepIDsFile, extra_plink_cmd, OutBed );",
plink_qassoc_importer,Plink related functions,"Import plink command '-assoc' generated association file, which is typically named as '*qassoc'.","plink_qassoc_importer( zipfile= ,/*file with appendix or .txt, .tgz, .gz, or .zip can be read by the macro*/ outdsd=assoc );",ImportFileHeadersFromZIP FileOrDirExist GetZIPContents Run_7Zip chdir direxist del_file_with_fullpath
AnyOf,SQL function,"Check any of variables or newly calculated variables in the proc sql procedure meet the specific condition 'cond', such as 'eq 1', which will check that any of the listed variables is equal to one","AnyOf(vars=, calculated=, cond=eq 1);",
ApplyFunc_rowwide,SQL function,"Apply any existing sas sql functions for variables on rowwide or further on both rowwide and columnwide, such as min, max, median, sum, and others.","ApplyFunc_rowwide(dsdin ,row_keys ,KeyVar4dsdout ,Regex4col_vars2apply ,SQL_Fun4apply ,dsdout ,KeyVar4dsdout_length=200 ,AlsoAppFun4Cols=0);",Rename_Del_Rgx4All_Vars numargs
FisherTestGenomeWide,Statistical analysis related macro,"Perform Fisher test by sample, group on large scale.","FisherTestGenomeWide(/*Note: this will use unique sampleID and pheno_var to make all to all combinations, please make sure the input table contain all target sampleID and pheno_var*/ dsdin=_last_, vars4assoc=%str(chrom, Pos, ref), /*These vars will be concatenate into a single var, and the data of each will be subjected to fisher test by grp4fisher and phenotype var*/ grp4fisher=subtype, /*This var will be used to perform 2x2 fisher test, which will be included in the column names in the output table*/ SampleID=SampleID, /*Patient ID*/ pheno_var= , /*phenotype for fisher test with grp4fisher; in the output the pheno and grp4fisher will be put on row- and column-wide, respectively the default is to use &grp4fisher, and the macro will use &grp4fisher to make pheno, i.e., samples with records of the var vars4assoc in the long format data will be assigned as pheno=1, and samples without records for the vars4assoc will be defined as pheno=0*/ fisher_dsdout=fisherout, /*All fisher test results for vars4assoc; only when the pheno*grp is a 2x2 table, the OR table RelativeRisks will be generated!*/ value4misspheno=0, /*assign a specific value to samples without records of the vars4assoc*/ grp_condition4pheno_var= %str(subtype^=""""), /*use the value of &grp4fisher as group here! use the condition to separate pheno_var into two groups for fisher test The default condition is set when the pheno_var is empty*/ new_pheno=pheno, /*new pheno variable name for the fisher test, which will be used to label the fisher table*/ /*The following are optional parameters for the output of csv files for summary statistics; no appendix of .csv is required to added; Default output dir will be in current dir!*/ outcsvname4measures=Measures, outcsvname4OR=fisherout.OR, outcsvname4fisher=fisherout, outcsvname4crossfrqtb=CrossTabFreqs );",
GDC_MutIDs2Bed,Statistical analysis related macro,change mutational data downloaded from the GDC database into bed format.,"GDC_MutIDs2Bed(GDC_MutID_dsd, Tbl_or_File, VarName, dsdout, outbed_fullpath );",VarnamesInDsd
GEO_Pipeline,Statistical analysis related macro,Import GEO gene expression matrix and GPL annotation data into sas.,"GEO_Pipeline(/*As different GSE and GPL files use specific genesymbol and probe ids, it is better to run the macro without knowing these headers for them, If failed, it can be rescued by evaluating these genesymbol and probe ids in the SAS output dataset*/ GSE_matrix_file ,ProbVarInMatrix ,GPL_file ,ProbVarInAnno ,GeneVarInAnno ,SampleInfo_file /*No need to have header: GSM_ID and Sample_details*/ ,Avg4gene_exp ,outdir ,Outdsd );",ApplyFunc_rowwide Rename_Del_Rgx4All_Vars numargs FilterFile
Get_Tested_ASE_Muts,Statistical analysis related macro,"Extract tested mutations and gene allele-specific expression values from the output of our DriverASE software published in iScience, 2021.","Get_Tested_ASE_Muts(Cancer,normal_aaf,gene);",ImportFilebyScan StandardizeVarscanIDs char2num_dsd
HpmixArray,Statistical analysis related macro,"Perform microarray differential gene expression analysis for large scale datasets based on the published macro AnovArray, a set of SAS macros for the analysis of variance of gene expression data (BMC bioinforamtics, 2005).",Probable confict between macro name and its sas filename,
HpmixArray_Deprecated,Statistical analysis related macro,The is old version of AnovArray but not functional for larger datasets.,Probable confict between macro name and its sas filename,
IdentifyBedClusters,Statistical analysis related macro,Identify bed regions with overlapped regions in a input sas dataset with the typical bed format.,"IdentifyBedClusters(bedin,chr_var,st_var,end_var,bedout,dist=0);",
ImportGeneLevelASE,Statistical analysis related macro,Import the software DriverASE generated gene-level ASE results into a sas dataset.,"ImportGeneLevelASE(filenames,dsdout,Reads4AB);",ImportFilebyScan union
MeanOf,Statistical analysis related macro,A proc sql function to calcuate mean of multiple variables or newly calculated variables.,"MeanOf(vars=, calculated=);",
Mult_BED_Enrichment,Statistical analysis related macro,Determine enrichment score for bed regions from a query bed dataset in a bed region database by comparing with n randomly generated bed regions with the same number of bed regions in the query bed dataset.,"Mult_BED_Enrichment(bed_db, query_db, query_var_name, random_db, random_var_name, np, sampling_dsdout, fdr_dsd_out, by_var4bed_db, output_mut_summary, Uniq_match_only );",KeepColNotMatchingRgx QueryRangeDsd Sampling StandardizeVarscanIDs union_add_tags
NOf,Statistical analysis related macro,A proc sql function to count how many non-missing data among variables and calculated variables. Note: the function works on row-wide for a table.,"NOf(vars=, calculated=);",
ParseEnrichedGenesFromWebgestalt,Statistical analysis related macro,Parser genes enriched in pathways generated by performing over-representation analysis via the online server WEB-based GEne SeT AnaLysis Toolkit.,"ParseEnrichedGenesFromWebgestalt(enrichment_file,dsdout);",
Quantile_normalization,Statistical analysis related macro,Perform quantile normalization for gene expression microarray data.,"Quantile_normalization(data, var, out, ties=LOW);",
QureyMetaXcanTWAS4Genes,Statistical analysis related macro,"Query TWAS gene association results from two TWAS sources, including a pre-combined association results for published GWASs and the combined UKB TWAS files. Note: all the cominbed TWAS files are generated by MetaXcan.","QureyMetaXcanTWAS4Genes( metaxcan_twas_file, ukb_twas_file, genes, dsdout, rawp_cutoff=0.01 );",Lambda_From_P Import_Space_Separated_File QQplot longformdsd4heatmap Scaleup_nrow_ncol longdsd2matlabmatrix matrix4cluster
RiskFactorAnalysis,Statistical analysis related macro,A wrapper for commonly risk factor anssociation test using fisher or chisq test for a phenotype along with age range. Note: make sure all vars and phenotype be coded with 1 or 2 for the macro.,"RiskFactorAnalysis(dsd,pheno,age_var,tested_vars,fisher);",
findxy,Statistical analysis related macro,"Run proc univariate to get minimum and maximum values of two variables, xx and yy, in a sas dataset, and the default output dataset is outa. The final output dataset outa contains 4 variables, including minxx, minyy, maxxx and maxyy.","findxy(dataname,xx,yy,outdsd=outa);",
gamm1,Statistical analysis related macro,A macro to inference in generalized additive mixed models by using smoothing splines.,"gamm1(data=_last_, dep=, dist=, link=, dispers=, weight=, intinf1=, offset=, fixed=, smthvar=, fitmod=, smooth=, lintest=, vartest=, method=, random=, type=, process=, time=, gt=, g1t=, g2t=, id=, maxiter=, conv=, parm=, print=, outbeta=, outbstd=, outvar=, outvstd=, outran=, outprs=, outsmth=, outband=, outlscor=, outvscor=, keeplast=, symsize=1022976, worksize=1022976);",
glm_by_grps,Statistical analysis related macro,Perform linear regression analysis by group and output a significance table.,"glm_by_grps( dsd=tgt,/*Long format data for proc glm*/ grpvars=rownames cluster, yvar4glm=exp,/*var in the dsd for proc glm*/ GLMStatOutDsd=GLMStatOut, GLM_classes=sex medication severity, GLM_model=severity sex age medication, pheno_var=severity, /*var for lsmeans analysis in proc glm*/ where_condition=, exp_cutoff=0.5 /*lsmean expression cutoff for lowly expressed genes These genes should be excluded in the differential expression analysis!*/ );",ntokens
groupsummary,Statistical analysis related macro,"Calcuate group-based summary statistics, such as mean, median, sum, and n for input variables in a dataset by group.","groupsummary( dsdin, grps,/*grps for the by statement*/ vars4summary,/*Numeric vars subject to input functions by group*/ funcs4var, /*functions exclusively for the proc means*/ dsdout, include_org_dsd_in_output=1 /*add the input dsdin into the dsdout*/ );",
happy,Statistical analysis related macro,Haplotype phasing and case-control based association test.,"happy(id=id, indsn=in, keep=, style=SNP, outdsn1=happlotb, outdsn2=origfreq, outadd=addscre, outreces=null, outdomnant=null, outcodomnant=null, thresh=.0001, range=.01, dir=, stratum=, covar=, covar1=, formt=, caco=, cutoff=0.05);",numargs
hist4p,Statistical analysis related macro,Make histogram for an input dataset containg p values. Note: the macros is customized to make histograms by input bins or by group.,"hist4p(dsdin,pvarname=pval,pbins=0 1e-7 1e-5 1e-3 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1,pgrp=g,outdsd=summary);",make_bin_format
hpforest_demo,Statistical analysis related macro,demonstration codes for proc hpforest procedure.,Probable confict between macro name and its sas filename,
hpglimmix,Statistical analysis related macro,"A SAS macro to fit generalized linear mixed model with high dimensional fixed and/or random effects design matrix using PROC HPMIXED and the Output Delivery System (ODS). This macro is based on the %GLIMMIX macro (SAS v8.2) from SAS Institute, Inc with PROC MIXED computing core replaced by PROC HPMIXED, as well as many other modifications to comply with requirement of PROC HPMIXED and other performance considerations. Currently supported distributions include: BINARY, BINOMIAL, POISSON, GAMMA, INVERSE GAUSSIAN, GEOMETRIC, and NORMAL (for reference only).","hpglimmix(data=, procopt=, stmts=, weight=, freq=, error=BINOMIAL, errvar=, errdev=, link=, linku=, linkud=, linkui=, linkuid=, linkn=, linknd=, linkni=, numder=1e-5, cf=0.5, converge=1e-8, maxit=50, offset=0, zmult=, wadd=, out=, outalpha=0.05, tech=NRRIDG, options=);",
iml_PrintDescStats,Statistical analysis related macro,"Print describtive summary statistics, such as mean, median, std, and other, using proc iml procedure.",iml_PrintDescStats(table);,
lkm,Statistical analysis related macro,A SAS macro for estimating and testing for the effect of a genetic pathway on a disease outcome using logistic kernel machine regression via logistic mixed models.,"lkm(path_name, file_name, y, x, z);",
lskm,Statistical analysis related macro,"A SAS Macro for doing semiparametric regression of multi-dimensional genetic pathway data, using least squares kernel machines and linear mix","lskm(path_name, file_name, y, x, z);",
macro_hapreg,Statistical analysis related macro,"The SAS macro HapReg implements the haplotype-based genetic association analysis for case-control studies, using a flexible model for gene-environment association allowing haplotypes to be potentially related with environmental exposures.",Probable confict between macro name and its sas filename,
make_bin_format,Statistical analysis related macro,Make a bin format.,"make_bin_format(bins,out_format_name);",
makebinnum,Statistical analysis related macro,Make a bin format by equivalently separating a range into n segements with the same length. Note: a new format name will be generated for using with attrib in data step.,"makebinnum(Range,bin_size,frmatname);",
makebins,Statistical analysis related macro,"Make a bin format for a input bin size and the abosulate value for the largest value of a range [-num,num]. Note: the final bins will range from -num to num.","makebins(Range,bin_size,frmatname);",
metaanal,Statistical analysis related macro,This macro produces the Laird and DerSimonian weighted average of betas givens betas and their variances.,"metaanal( coeff = T, /* whether giving coeff or OR/RR. if OR/RR, no need for point est */ beta = beta, /* Input betas REQUIRED if COEFF=T */ se_or_var = v, /* whether you are giving the macro the standard error (s) or the variances (v) of the coefficients if COEFF = T */ varnamelcb =, /* variable name for lower confidence bound of OR/RR if COEFF = F */ varnameucb =, /* variable name for upper confidence bound of OR/RR if COEFF = F */ /* need to give either beta and var or se OR varnamelcb and varnameucb */ var = var, /* variable name for variances */ se =se, /* variable name for standard errors */ data = , /* Input data set REQUIRED */ studylab = studylab, /* labels for each study REQUIRED */ name =, /* Name of variable of interest REQUIRED */ explabel=, /* descriptive title of exposure REQUIRED */ outcomelabel=, /* descriptive title of outcome REQUIRED */ wt = 1, outdat =, /* Output data set */ pooltype=random, notes=nonotes, printcoeff=F, loglinear=t, /* whether the underlying analysis is log-linear (logistic, phreg, log-binomial, poisson) or not */ noprint =F, pvalueformat=pvalue6.4 );",
principal,Statistical analysis related macro,Reducing a set of variables (vars) using PCA by keeping fraction p (p<=1) of the variance. The output is stored in outdata and the model is stored in scoreout.,"principal(Input, vars, Method, p, scoreout, outdata);",
proc_r_codes4sas,Statistical analysis related macro,Run R codes in sas within a local computer that has R and related packages installed.,"proc_r_codes4sas(rcodes_dsd4sas=, rcode_var=, SAS2R=, R2SAS=, rpath=);",abort_when_file_not_exit FileOrDirExist
quantile4dsd,Statistical analysis related macro,Generate a variable to indicate the quantile of a specific variable in the same dataset.,quantile4dsdvar);,
regress_out_covar_effects,Statistical analysis related macro,"Regress out covariant effects and return a dataset containing the residue value of a variable, which can be used for further differential analysis.","regress_out_covar_effects( dsdin=,/*Input dsd*/ dsdout=,/*output dsd*/ varadjlist=,/*char covars used to adjust effects; these char covars are required to be put into the class statment*/ modeladjlist=,/*all covars, including char and numeric covars in a format for the model statment of proc glm; ensure the above varadjlist contain all required covars*/ signal_var=,/*The y variable subject to regress out covar effects*/ adjsignal_var= /*Final y variable name containing adjsted value of signal_var*/ );",
regression_estimator,Statistical analysis related macro,Use proc reg to estimate linear regression parameters and update the Pvalue format as in best32..,"regression_estimator(dsdin=_last_,xvar=,yvar=,outdsd=PE);",
METADAS,Statistical analysis related macro,"To automate fitting of bivariate and HSROC models for  meta-analysis of diagnostic accuracy studies using PROC NLMIXED. Explanatory variables (covariates) can be added to the models to produce separate effects on the summary measures of test accuracy. Also, distributional assumptions of the random effects can be checked and predicted values of sensitivity and specificity, based on empirical Bayes estimates of the random effects, can be obtained for each study in the meta-analysis. The output from the analysis is presented in a Word document. ","metadas(dtfile=, import=, dsname=, tech=, ident=, tp=, fp=, fn=, tn=, subject=, cialpha=, byvar=, covariate=, cvref=, sortcv=, cvtype=, cveffect=, cvsummorder=, formatlr=, test=, method=, mtitle=, tbpe=, p1=, p2=, p3=, p4=, p5=, cspa1=, cspa2=, cspa3=, cspa4=, cset1=, cset2=, cset3=, cset4=, cpb1=, cpb2=, cpb3=, cpb4=, randeffs=, predict=, checkmod=, debug=, logfile=, outfile=, keepds=, revman=, info=, bothmodels=, incbasic=, rfile=);",
deseq_normal_not_optimized,Statistical analysis related macro,"Normalization reads using deseq method, which is not optimized for SAS OnDemand for Academics. Note: it may be useful for local sas 9.4 workbench.","deseq_normal_not_optimized(/*for backup purpose*/ dsdin,/*Note: to save space, the input dsd will be replace*/ read_vars, dsdout, readcutoff=3, cellcutoff=5 );",rename_sas_dsd
CD2CWD,System function,Change the working directory into the directory where the current running script is included.,CD2CWD;,
Create_Dir,System function,Create directory under a specific path.,Create_Dir(dir=) ;,
Create_Dir,System function,Create directory under a specific path.,"Create_Dir(path,folder_name);",
ImportVarscanRst,Variant Annotation,Import mutational calling results called by Varscan.,"ImportVarscanRst(filenames,dsdout,Reads4tumor);",ImportFilebyScan union
Import_VCF,Variant Annotation,Import VCF file into a sas dataset.,"Import_VCF(dir=,filename=,dsdout=);",
RunKggseq,Variant Annotation,A wrapper to run the variant annotation software Kggseq.,"RunKggseq( java_bin= /* Only single comma; when just run java with 'java -jar', it does not work, as sas use its inernal java */ , Kggseq_dir= /* Windows path of directory to Kggseq jar */ , dir= /* variant file directory */ , var_file_name= /* file contains variants to be processed by Kggseq */ , input_file_cmd= /* --vcf-file filepath or annovar-file filepath */ , pheno_cmd= /* --ped--file filename N.B.: 1:unaff,2:aff,0:unknown */ , other_params= /* Kggseq parameters for filters (make excel as output) */ ) ;",
StandardizeVarscanIDs,Variant Annotation,"Extract chr, pos, ref and alternative alleles from different formats of variant ids and generate a standard format of Varscan variant id, such as chr1:180949131:T:C.","StandardizeVarscanIDs(VarscanID_dsd,VarName,outdsd);",
UniHetGeno,Variant Annotation,"Change the heterzygous genotypes 'AB' and 'BA' into one of the consistent genotype, such as 'AB', in a sas dataset","UniHetGeno(dsdin,geno,dsdout);",
VCF2KggPED,Variant Annotation,Modify VCF into the variant annotation software Kggseq required PED file.,"VCF2KggPED( dir= /* Windows path of directory to vcf files */ , filename= /* Single VCF file name */ , dsdout= /* file name used for sas dataset and Kggseq PED file name (under &dir)*/ /*file will be in directory &dir and non-word will be changed into '_' */ , unaff= /*perl rgex: specific characters or words contained by unaffacted samples */ , aff= /*perl regex: specfic characters or words contained by affected samples */ ) ;",
Varscan2Annovar,Variant Annotation,Prepare Varscan tumor/normal match mutation calling output and annotate these mutations using ANNOVAR in Windows. Note: ANNOVAR and Perl need to be installed.,"Varscan2Annovar(VarscanTable_fullpath,dsdout,annovar_input,annovar_dir,annovar_outdir,Anno_dsd_out);",ImportFilebyScan del_file_with_fullpath
VarscanIDs2Annovar,Variant Annotation,"Annotate variants based on its standard varscan id, i.e., chr:pos:ref:alt, using ANNOVAR.","VarscanIDs2Annovar(VarscanID_dsd, Tbl_or_File, VarName, dsdout, annovar_input, annovar_dir, annovar_outdir, Anno_dsd_out);",ImportFilebyScan del_file_with_fullpath
VarscanIDs2Bed,Variant Annotation,"Change standard Varscan variant id, such as chr:pos:ref:alt, into a bed format sas dataset.","VarscanIDs2Bed(VarscanID_dsd, Tbl_or_File, VarName, dsdout, outbed_fullpath );",VarnamesInDsd
make_dbsnp_db,Variant Annotation,Import dbsnp file into a sas dataset and index it by chr and position.,"make_dbsnp_db( dbsnp_fullpath, outlib_path, outdsd );",File_Head ImportFilebyScanAtSpecCols numargs char2num_dsd
trans2tranv_fmt,Variant Annotation,"Make a format to categorize mutations into two types of mutations, including transversion and transition.","trans2tranv_fmt(dsd,mut_var,new_mut_var,mult_types);",
in,Data manipulation,A sas function recursively determine whether the string is include in a list of strings.,"in ( var , list )",
macroparas4hpc,Other utilities,Older macro to print macro contents for high-performance computing cluster using the linux function cat.,"macroparas4hpc( macrorgx=., dir=%sysfunc(pathname(HOME))/Macros ~/shared/Macros /home/zcheng/SAS-Useful-Codes/Macros F:/360yunpan/SASCodesLibrary/SAS-Useful-Codes/Macros /home/zhongshan/SAS-Useful-Codes/Macros H:\F_Queens\360yunpan\SASCodesLibrary\SAS-Useful-Codes\Macros , verbose=0, IsSASOnDemand=0, numlines2print=10000 );",FileOrDirExist list_files4dsd del_file_with_fullpath list_files
